<!-- FILE: demo/index.html  |  3-view carousel → Connect ◀︎ Chat ▶︎ Feed -->
<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>BI Magics • Demo</title>

  <!-- external libs -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"              defer></script>
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@3.4.0/tsparticles.bundle.min.js"
          defer></script>

  <!-- local stylesheet -->
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <!-- background particles -->
  <canvas id="tsparticles"></canvas>

  <!-- ───── Top nav: only 3 buttons ───── -->
  <nav class="top-nav">
    <button data-view-id="connect" data-index="0">Connect</button>
    <button data-view-id="chat"    data-index="1" class="active">Chat</button>
    <button data-view-id="feed"    data-index="2">Feed</button>
  </nav>

  <!-- ───── Swipeable carousel wrapper ───── -->
  <div id="views-wrapper">
    <div id="views-carousel" class="views"></div>
  </div>

  <script type="module">
    /* ------------- import views ------------- */
    import { renderConnectView } from './connectors.js';
    import { renderChatView    } from './chat.js';
    import { renderFeedView    } from './feed.js';

    const viewsCarousel = document.getElementById('views-carousel');
    const viewsWrapper  = document.getElementById('views-wrapper');
    const navButtons    = [...document.querySelectorAll('.top-nav button')];
    const numViews      = navButtons.length;        // === 3

    const viewRenderers = { connect: renderConnectView, chat: renderChatView, feed: renderFeedView };

    /* ------- build views inside carousel ------- */
    navButtons.forEach(btn => {
      const id = btn.dataset.viewId;
      const view = viewRenderers[id]?.();
      if (view) {
        view.style.width = `${100 / numViews}%`;    // => 33.33%
        viewsCarousel.appendChild(view);
      }
    });
    viewsCarousel.style.width = `${numViews * 100}%`; // 300%

    /* ------- navigation helpers ------- */
    let current = 1;                                // default → Chat
    const vw    = () => window.innerWidth;

    function switchView(i, animate = true) {
      current = i;
      viewsCarousel.style.transition = animate ? 'transform .45s cubic-bezier(.25,1,.5,1)' : 'none';
      viewsCarousel.style.transform  = `translateX(${-i * (100 / numViews)}%)`;
      navButtons.forEach(b => b.classList.toggle('active', +b.dataset.index === i));
      window.AOS && setTimeout(() => AOS.refreshHard(), animate ? 450 : 50);
    }
    navButtons.forEach(b => b.onclick = () => switchView(+b.dataset.index));

    /* ------- swipe gestures ------- */
    let sx = 0, cx = 0, dragging = false;
    viewsWrapper.addEventListener('pointerdown', e => {
      if (e.target.closest('button,a,input,select,textarea,.modal')) return;
      dragging = true;
      sx = cx = e.pageX ?? e.touches?.[0].pageX;
      viewsCarousel.style.transition = 'none';
      document.body.classList.add('swiping');
    }, { passive: true });

    const move = e => {
      if (!dragging) return;
      cx = e.pageX ?? e.touches?.[0].pageX;
      viewsCarousel.style.transform = `translateX(${ -current * vw() + (cx - sx) }px)`;
    };
    const end = () => {
      if (!dragging) return; dragging = false; document.body.classList.remove('swiping');
      const dx = cx - sx, thr = vw() * 0.2;
      if      (dx < -thr && current < numViews - 1) switchView(current + 1);
      else if (dx >  thr && current > 0)            switchView(current - 1);
      else                                          switchView(current);
    };
    window.addEventListener('pointermove',   move, { passive: true });
    window.addEventListener('pointerup',     end);
    window.addEventListener('pointercancel', end);

    window.addEventListener('resize', () => switchView(current, false));

    /* ------- particles + AOS ------- */
    tsParticles?.load('tsparticles', {
      particles:{number:{value:30,density:{enable:true,value_area:800}},
                 color:{value:'#fff'},shape:{type:'circle'},
                 opacity:{value:.2,random:true},size:{value:2,random:true},
                 links:{enable:true,color:'#00e6e6',distance:150,opacity:.15,width:1},
                 move:{enable:true,speed:.5}},
      retina_detect:true,fullScreen:{enable:false}
    });
    AOS?.init({ once:false, duration:550, offset:50, easing:'ease-out-quad' });

    /* ------- land on Chat (center) ------- */
    switchView(1, false);
  </script>
</body>
</html>