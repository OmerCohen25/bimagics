<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>BI Magics â€¢ Enhanced Magic Feed</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.1/tsparticles.bundle.min.js"></script>

<style>
/* ---- Dark theme ---- */
:root{
  --card-bg:#1e1e28; --card-border:#2f2f42; --accent:#6eee9e;
  --text:#e9e9f1; --kpi:#ffffff; --shadow:0 8px 20px rgba(0,0,0,.45); --radius:14px;
  font-family:"Inter","Segoe UI",Arial,sans-serif;
}
body{margin:0;background:radial-gradient(ellipse at top,#13131d 0%,#0e0e14 55%);color:var(--text);overflow-x:hidden}

/* Particles */
#tsparticles{position:fixed;inset:0;z-index:-2}

/* ----- Header ----- */
header{
  position:sticky;top:0;z-index:5;background:#0d0d14cc;
  backdrop-filter:blur(6px);display:flex;justify-content:center;align-items:center;
  gap:12px;padding:14px 0;border-bottom:1px solid #23232f;
}
header h1{font-size:22px;margin:0;font-weight:700;letter-spacing:.5px}
header span{font-size:15px;font-weight:400;opacity:.75}

/* ----- Feed container ----- */
.feed{width:100%;max-width:900px;margin:0 auto;padding:110px 16px 160px;display:flex;flex-direction:column;gap:48px}

/* ----- Card ----- */
.bi-card{
  position:relative;overflow:hidden;background:var(--card-bg);border:1px solid var(--card-border);
  border-radius:var(--radius);box-shadow:var(--shadow);padding:24px 28px 70px 28px; /* bottom room for toolbar */
  backdrop-filter:blur(4px);
}
.bi-card::before{
  content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;
  background:linear-gradient(135deg,transparent 0%,var(--accent)22%,transparent 52%,transparent 100%);
  background-size:400% 400%;opacity:.12;animation:hologlow 8s linear infinite
}
@keyframes hologlow{0%{background-position:0 0}100%{background-position:200% 200%}}

/* KPI */
.kpi-value{font-size:clamp(36px,7vw,64px);font-weight:700;color:var(--kpi);margin:0}
.kpi-label{font-size:18px;opacity:.7;margin-top:4px}

/* Table */
.table-wrapper{overflow-x:auto;margin-top:12px}
table{width:100%;border-collapse:collapse;font-size:15px}
th,td{padding:8px 10px;text-align:left;border-bottom:1px solid #2d2d38}
th{color:var(--accent);font-weight:600}

/* SQL */
pre.sql{background:#0d0d14;color:#9cf3ce;border:1px solid #28323b;padding:16px;border-radius:10px;overflow:auto;font-size:14px}

/* ---- Social toolbar ---- */
.card-actions{
  position:absolute;left:0;right:0;bottom:0;display:flex;justify-content:space-between;align-items:center;
  padding:10px 18px;border-top:1px solid #292935;font-size:14px;background:#15151dcc
}
.icon-btn{background:transparent;border:none;color:inherit;cursor:pointer;display:flex;align-items:center;gap:6px;transition:color .2s;font-size:15px}
.icon-btn:hover{color:var(--accent)}
.icon-btn.like.liked i{color:#ff6b81}
.views{display:flex;align-items:center;gap:6px;opacity:.75;font-size:14px}

/* Fade-in fallback */
.aos-init:not(.aos-animate){opacity:0}
</style>
</head>
<body>

<canvas id="tsparticles"></canvas>

<header data-aos="fade-down">
  <h1>BI&nbsp;Magics</h1>
  <span>Enhanced Magic Feed</span>
</header>

<main class="feed">

  <section class="bi-card" data-aos="fade-up">
    <p class="kpi-value">$ 12,473,920</p><p class="kpi-label">Total Revenue (Last 12 M)</p>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="100">
    <h3>Revenue Trend (L12M)</h3><canvas id="revenueLine"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="200">
    <h3>Sales by Region</h3><canvas id="regionPie"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="300">
    <h3>Top Selling Products</h3><canvas id="productBar"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="400">
    <h3>Top Customers by Spend</h3>
    <div class="table-wrapper"><table><thead><tr><th>Customer</th><th>Country</th><th>Spend ($)</th></tr></thead><tbody>
      <tr><td>Acme Corp</td><td>USA</td><td>1,200,000</td></tr><tr><td>Globex</td><td>Canada</td><td>985,500</td></tr>
      <tr><td>Initech</td><td>UK</td><td>873,000</td></tr><tr><td>Umbrella</td><td>Germany</td><td>712,400</td></tr>
      <tr><td>Stark Industries</td><td>USA</td><td>598,900</td></tr><tr><td>Wayne Enterprises</td><td>Israel</td><td>547,100</td></tr>
    </tbody></table></div>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="500">
    <p class="kpi-value">157,332</p><p class="kpi-label">Monthly Active Users (MAU)</p>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="600">
    <h3>Query: Monthly Revenue</h3>
<pre class="sql">SELECT DATE_TRUNC(order_date, MONTH) AS month,
       SUM(total_amount)             AS revenue
FROM   bigquery_project.orders
WHERE  order_date &gt;= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)
GROUP  BY month
ORDER  BY month;</pre>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="700">
    <h3>User Device Distribution</h3><canvas id="deviceDoughnut"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="800">
    <h3>Website Traffic Sources</h3><canvas id="trafficBar"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="900">
    <p class="kpi-value">3.8 %</p><p class="kpi-label">Monthly Customer Churn</p>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="1000">
    <h3>Data Quality Alerts (Last 3 Days)</h3>
    <div class="table-wrapper"><table><thead><tr><th>Timestamp</th><th>Source</th><th>Anomaly Detected</th></tr></thead><tbody>
      <tr><td>2025-05-03 04:12</td><td>bq.orders</td><td>Spike in refunds (>$50k)</td></tr>
      <tr><td>2025-05-02 14:55</td><td>sf.opportunities</td><td>Missing owner_id (15 records)</td></tr>
      <tr><td>2025-05-01 21:30</td><td>sheet.marketing</td><td>Negative campaign spend</td></tr>
    </tbody></table></div>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="1100">
    <h3>Key Performance Indicators vs Target</h3><canvas id="kpiRadar"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="1200">
    <p class="kpi-value">72</p><p class="kpi-label">Net Promoter Score (NPS)</p>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="1300">
    <h3>Revenue Forecast (Next 6 Months)</h3><canvas id="forecastLine"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="1400">
    <h3>Marketing Spend Allocation</h3><canvas id="marketingPie"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="1500">
    <p class="kpi-value">$ 1,628</p><p class="kpi-label">Avg. Customer Lifetime Value (LTV)</p>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="1600">
    <h3>Daily New Sign-ups (Last 30 Days)</h3><canvas id="signupsLine"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="1700">
    <h3>Department Expenses vs Budget (YTD)</h3><canvas id="expenseBar"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="1800">
    <h3>Support Ticket Categories</h3><canvas id="ticketsPie"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="1900">
    <h3>Engineering Team Performance Metrics</h3><canvas id="teamRadar"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="2000">
    <h3>Upcoming Company Events</h3>
    <div class="table-wrapper"><table><thead><tr><th>Date</th><th>Event</th><th>Owner Department</th></tr></thead><tbody>
      <tr><td>2025-05-07</td><td>Product Launch V2</td><td>Marketing</td></tr>
      <tr><td>2025-05-15</td><td>Quarterly All-Hands Meeting</td><td>HR</td></tr>
      <tr><td>2025-05-22</td><td>Core Database Migration</td><td>Engineering</td></tr>
       <tr><td>2025-06-01</td><td>Summer Sales Kick-off</td><td>Sales</td></tr>
    </tbody></table></div>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="2100">
    <h3>Active Subscription Plan Mix</h3><canvas id="planDoughnut"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="2200">
    <p class="kpi-value">1.32 s</p><p class="kpi-label">Average Page Load Time (Website)</p>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="2300">
    <h3>Open Bug Distribution by Severity</h3><canvas id="bugsBar"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="2400">
    <p class="kpi-value">$ 78.50</p><p class="kpi-label">Average Order Value (AOV)</p>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="2500">
    <h3>Website Bounce Rate Trend (Last 6 Months)</h3>
    <canvas id="bounceRateArea"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="2600">
    <h3>Lead Source Performance (Last Qtr)</h3>
    <canvas id="leadSourceStackedBar"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="2700">
    <h3>Recent User Activity Stream</h3>
    <div class="table-wrapper"><table><thead><tr><th>Time</th><th>User ID</th><th>Action</th><th>Platform</th></tr></thead><tbody>
      <tr><td>03:52:11</td><td>user_8ab2</td><td>Logged In</td><td>Mobile App</td></tr>
      <tr><td>03:50:58</td><td>user_c7e0</td><td>Completed Purchase ($45)</td><td>Web</td></tr>
      <tr><td>03:48:30</td><td>user_f119</td><td>Viewed Pricing Page</td><td>Web</td></tr>
      <tr><td>03:45:05</td><td>user_3d9a</td><td>Added Item to Cart</td><td>Mobile App</td></tr>
      <tr><td>03:42:19</td><td>user_8ab2</td><td>Updated Profile</td><td>Mobile App</td></tr>
    </tbody></table></div>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="2800">
    <p class="kpi-value">$ 115</p><p class="kpi-label">Customer Acquisition Cost (CAC)</p>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="2900">
    <h3>Customer Spend vs. Purchase Frequency</h3>
    <canvas id="spendFrequencyScatter"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="3000">
    <h3>Smart Insight: Marketing Focus</h3>
    <p style="font-size: 16px; line-height: 1.6;">Analysis of Traffic Sources (Card #9) and CAC (Card #29) suggests that <strong style="color:var(--accent)">Organic Search</strong> yields the highest ROI. <br/><strong>Recommendation:</strong> Consider increasing SEO investment and content marketing efforts.</p>
  </section>

    <section class="bi-card" data-aos="fade-up" data-aos-delay="3100">
    <h3>Simple Sign-up Funnel (Last 30d)</h3>
    <canvas id="signupFunnelBar"></canvas>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="3200">
    <h3>Query: High-Value Customer Segment</h3>
<pre class="sql">WITH CustomerSpending AS (
  SELECT customer_id,
         SUM(total_amount) AS total_spend,
         COUNT(DISTINCT order_id) AS num_orders
  FROM   bigquery_project.orders
  WHERE  order_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)
  GROUP BY customer_id
)
SELECT c.customer_name, cs.total_spend, cs.num_orders
FROM   bigquery_project.customers c
JOIN   CustomerSpending cs ON c.id = cs.customer_id
WHERE  cs.total_spend > 10000 AND cs.num_orders > 5
ORDER BY cs.total_spend DESC;</pre>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="3300">
    <p class="kpi-value">2.7 %</p><p class="kpi-label">Website Conversion Rate (Visits to Purchase)</p>
  </section>

   <section class="bi-card" data-aos="fade-up" data-aos-delay="3400">
      <h3>Product Portfolio Analysis (Market Share vs Growth)</h3>
      <canvas id="marketBubbleChart"></canvas>
      <p style="font-size: 12px; opacity: 0.7; text-align: center; margin-top: 10px;">Bubble size represents revenue</p>
  </section>

  <section class="bi-card" data-aos="fade-up" data-aos-delay="3500">
      <h3>Top Blog Posts (Last 30 Days)</h3>
      <div class="table-wrapper"><table><thead><tr><th>Title</th><th>Category</th><th>Pageviews</th><th>Avg. Time</th></tr></thead><tbody>
          <tr><td>Ultimate Guide to BI Dashboards</td><td>Analytics</td><td>15,820</td><td>5:12 min</td></tr>
          <tr><td>Decoding Customer Churn</td><td>Strategy</td><td>11,345</td><td>4:30 min</td></tr>
          <tr><td>Top 5 Data Viz Trends 2025</td><td>Trends</td><td>9,980</td><td>3:55 min</td></tr>
          <tr><td>Getting Started with SQL</td><td>Tutorial</td><td>7,610</td><td>6:40 min</td></tr>
      </tbody></table></div>
  </section>


</main>

<script>
/* ---------- Utils ---------- */
const rnd=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
const rndFloat=(min,max,decimals=1)=>parseFloat((Math.random()*(max-min)+min).toFixed(decimals));
const ctx=id=>document.getElementById(id).getContext("2d");
const months=["May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","Jan","Feb","Mar","Apr"]; // Last 12 M ending Apr 2025
const shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun"]; // For forecasts etc.
const days30 = Array.from({length:30},(_,i)=>`Day ${i+1}`);

// Consistent color palette for charts
const chartColors = {
  primary: '#6eee9e', // Accent
  secondary: '#3b82f6', // Blue
  tertiary: '#f59e0b', // Amber
  quaternary: '#ef4444', // Red
  quinary: '#a855f7', // Purple
  bgTransparent: 'transparent',
  gridColor: '#2c2c38',
  textColor: '#e9e9f1',
  borderColor: '#2f2f42'
};

Chart.defaults.color = chartColors.textColor;
Chart.defaults.borderColor = chartColors.gridColor;


/* ---------- Particles ---------- */
tsParticles.load("tsparticles",{
  particles:{number:{value:80,density:{enable:true,area:800}},
    color:{value: chartColors.primary }, links:{enable:true,color: chartColors.primary ,opacity:.14},
    move:{enable:true,speed:1.1},opacity:{value:.25}},fullScreen:{enable:false}
});

/* ---------- AOS ---------- */
AOS.init({once:true,duration:700,offset:120});

/* ---------- Charts ---------- */

// ---- Original Charts (1-24) ----

// 2 Line: Revenue Trend
new Chart(ctx("revenueLine"),{type:"line",data:{labels:months,datasets:[{
    label: 'Revenue', data:months.map(()=>rnd(800000,1700000)),tension:.35,fill:true,
    backgroundColor: 'rgba(110, 238, 158, 0.1)', borderColor: chartColors.primary, pointBackgroundColor: chartColors.primary
    }]},
  options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true, ticks: {callback: (value) => `$${(value/1000000).toFixed(1)}M`}}}}});

// 3 Pie: Sales by Region
new Chart(ctx("regionPie"),{type:"pie",data:{labels:["North America","EMEA","APAC","LATAM"],datasets:[{
    label: 'Sales by Region', data:[38,26,22,14],
    backgroundColor: [chartColors.primary, chartColors.secondary, chartColors.tertiary, chartColors.quaternary]
    }]},
  options:{responsive: true, maintainAspectRatio: false, plugins:{legend:{position:"bottom"}}}});

// 4 Bar: Top Products
new Chart(ctx("productBar"),{type:"bar",data:{labels:["Gizmo X","Widget Pro","Bolt Mini","Nano S","Giga Pack"],
  datasets:[{
    label: 'Units Sold', data:[rnd(600,1200),rnd(600,1200),rnd(600,1200),rnd(600,1200),rnd(600,1200)],
    backgroundColor: chartColors.primary
    }]},
  options:{plugins:{legend:{display:false}},indexAxis:"y", scales:{x:{beginAtZero:true}}}});

// 8 Doughnut: Device Distribution
new Chart(ctx("deviceDoughnut"),{type:"doughnut",data:{labels:["Mobile","Desktop","Tablet"],datasets:[{
    label: 'Device Usage', data:[62,29,9],
    backgroundColor: [chartColors.primary, chartColors.secondary, chartColors.tertiary]
    }]},
  options:{responsive: true, maintainAspectRatio: false, cutout: '60%', plugins:{legend:{position:"bottom"}}}});

// 9 Horizontal Bar: Traffic Sources
new Chart(ctx("trafficBar"),{type:"bar",data:{labels:["Organic","Paid","Referral","Social","Email"],
  datasets:[{
    label: 'Traffic Volume', data:[rnd(150,400),rnd(150,400),rnd(150,400),rnd(150,400),rnd(150,400)],
    backgroundColor: chartColors.secondary
    }]},
  options:{plugins:{legend:{display:false}}, indexAxis: 'y', scales:{x:{beginAtZero:true}}}}); // Changed to indexAxis: 'y' for horizontal

// 12 Radar: KPIs vs Target
new Chart(ctx("kpiRadar"),{type:"radar",data:{labels:["Revenue","Users","Conversion","Retention","NPS"],
  datasets:[
      {label:"Actual",data:[88,75,64,71,72],fill:true, backgroundColor:'rgba(110, 238, 158, 0.2)', borderColor: chartColors.primary, pointBackgroundColor: chartColors.primary},
      {label:"Target",data:[100,80,70,75,80], borderDash:[6,3], borderColor: chartColors.tertiary, pointBackgroundColor: chartColors.tertiary}
      ]},
  options:{responsive: true, maintainAspectRatio: false, plugins:{legend:{position:"bottom"}}, scales: { r: { beginAtZero: true, max: 100 }}}});

// 14 Forecast Line: Revenue Forecast
new Chart(ctx("forecastLine"),{type:"line",data:{labels:shortMonths,
  datasets:[{
      label: 'Forecasted Revenue', data:[1.24,1.32,1.38,1.45,1.51,1.58].map(v=>v*1e6),borderDash:[4,4],tension:.3,
      borderColor: chartColors.secondary, pointBackgroundColor: chartColors.secondary
      }]},
  options:{plugins:{legend:{display:false}}, scales:{y:{beginAtZero:false, ticks: {callback: (value) => `$${(value/1000000).toFixed(1)}M`}}}}});

// 15 Marketing Pie: Spend
new Chart(ctx("marketingPie"),{type:"pie",data:{labels:["Search Ads","Social Media","Influencer","Email Mktg","Display Ads"],
  datasets:[{
      label: 'Marketing Spend %', data:[34,27,18,13,8],
      backgroundColor: [chartColors.primary, chartColors.secondary, chartColors.tertiary, chartColors.quaternary, chartColors.quinary]
      }]},
  options:{responsive: true, maintainAspectRatio: false, plugins:{legend:{position:"bottom"}}}});

// 17 Line: Daily Sign-ups
new Chart(ctx("signupsLine"),{type:"line",data:{labels:days30,
  datasets:[{
      label:"Sign-ups",data:Array.from({length:30},()=>rnd(120,430)),fill:true,tension:.25,
      backgroundColor: 'rgba(59, 130, 246, 0.1)', borderColor: chartColors.secondary, pointBackgroundColor: chartColors.secondary, pointRadius: 0
      }]},
  options:{plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}});

// 18 Bar: Expenses vs Budget
new Chart(ctx("expenseBar"),{type:"bar",data:{labels:["R&D","Marketing","Sales","Ops","HR"],
  datasets:[
      {label:"Budget",data:[200,180,150,120,80], backgroundColor: chartColors.tertiary},
      {label:"Actual",data:[210,195,137,128,95], backgroundColor: chartColors.primary}
      ]},
  options:{plugins:{legend:{position:"bottom"}}, scales:{y:{beginAtZero:true, ticks: {callback: (value) => `$${value}k`}}}}});

// 19 Pie: Ticket Categories
new Chart(ctx("ticketsPie"),{type:"pie",data:{labels:["Bug Report","Feature Request","Question","Incident"],
  datasets:[{
      label: 'Ticket Types', data:[48,24,18,10],
      backgroundColor: [chartColors.quaternary, chartColors.secondary, chartColors.tertiary, chartColors.primary]
      }]},
  options:{responsive: true, maintainAspectRatio: false, plugins:{legend:{position:"bottom"}}}});

// 20 Radar: Team Performance
new Chart(ctx("teamRadar"),{type:"radar",data:{labels:["Delivery","Quality","Velocity","Collaboration","Innovation"],
  datasets:[
      {label:"Team Alpha",data:[80,85,72,88,70],fill:true, backgroundColor:'rgba(110, 238, 158, 0.2)', borderColor: chartColors.primary, pointBackgroundColor: chartColors.primary},
      {label:"Team Bravo",data:[68,78,75,70,66], fill: true, backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: chartColors.secondary, pointBackgroundColor: chartColors.secondary}
      ]},
  options:{responsive: true, maintainAspectRatio: false, plugins:{legend:{position:"bottom"}}, scales: { r: { beginAtZero: true, max: 100 }}}});

// 22 Doughnut: Subscription Mix
new Chart(ctx("planDoughnut"),{type:"doughnut",data:{labels:["Pro Plan","Growth Plan","Enterprise Plan"],datasets:[{
    label: 'Subscription Mix', data:[56,31,13],
    backgroundColor: [chartColors.primary, chartColors.secondary, chartColors.tertiary]
    }]},
  options:{responsive: true, maintainAspectRatio: false, cutout: '60%', plugins:{legend:{position:"bottom"}}}});

// 24 Bar: Bug Severity
new Chart(ctx("bugsBar"),{type:"bar",data:{labels:["Critical","High","Medium","Low"],
  datasets:[{
      label: 'Open Bugs', data:[12,28,46,38],
      backgroundColor: [chartColors.quaternary, chartColors.tertiary, chartColors.secondary, chartColors.primary]
      }]},
  options:{plugins:{legend:{display:false}},indexAxis:"y", scales:{x:{beginAtZero:true}}}});


// ---- Newly Added Charts (25+) ----

// 26 Area: Bounce Rate
const bounceMonths = ["Nov", "Dec", "Jan", "Feb", "Mar", "Apr"];
new Chart(ctx("bounceRateArea"), {type: 'line', data: {labels: bounceMonths, datasets: [{
      label: 'Bounce Rate %', data: [48, 52, 50, 45, 43, 41], fill: true, tension: 0.3,
      backgroundColor: 'rgba(239, 68, 68, 0.1)', borderColor: chartColors.quaternary, pointBackgroundColor: chartColors.quaternary
      }]},
  options: {plugins: {legend: {display: false}}, scales: {y: {beginAtZero: false, ticks: {callback: (value) => `${value}%`}}}}
});

// 27 Stacked Bar: Lead Sources
new Chart(ctx("leadSourceStackedBar"), {type: 'bar', data: {labels: ["Organic", "Paid Search", "Social", "Referral", "Events"], datasets: [
    {label: 'Leads Generated', data: [1200, 950, 700, 450, 300], backgroundColor: chartColors.secondary},
    {label: 'Converted Customers', data: [80, 75, 40, 50, 35], backgroundColor: chartColors.primary}
    ]},
  options: {plugins: {legend: {position: "bottom"}}, scales: {x: {stacked: true}, y: {stacked: true, beginAtZero: true}}}
});

// 30 Scatter: Spend vs Frequency
const customerData = Array.from({length: 50}, () => ({
    x: rnd(1, 15), // Purchase Frequency (last 12m)
    y: rnd(50, 5000) // Total Spend ($)
}));
new Chart(ctx("spendFrequencyScatter"), { type: 'scatter', data: { datasets: [{
        label: 'Customer Segment', data: customerData,
        backgroundColor: chartColors.primary, pointRadius: 5, pointHoverRadius: 7
      }]},
  options: { plugins: { legend: { display: false }, tooltip: { callbacks: { label: (ctx) => `Freq: ${ctx.raw.x}, Spend: $${ctx.raw.y}` }}},
    scales: { x: { title: { display: true, text: 'Purchase Frequency (L12M)'}}, y: { title: { display: true, text: 'Total Spend ($)'}, ticks: {callback: (value) => `$${value}`}} }
  }
});

// 32 Funnel Chart (Simulated with Bar)
new Chart(ctx("signupFunnelBar"), { type: 'bar', data: { labels: ['Website Visit', 'Sign-up Start', 'Sign-up Complete', 'First Action'], datasets: [{
        label: 'Users', data: [15000, 3000, 2200, 1800], // Example funnel numbers
        backgroundColor: [chartColors.primary, chartColors.secondary, chartColors.tertiary, chartColors.quaternary]
      }]},
  options: { indexAxis: 'y', plugins: { legend: { display: false } },
    scales: { x: { beginAtZero: true } }
  }
});

// 35 Bubble Chart: Market Share vs Growth
new Chart(ctx('marketBubbleChart'), { type: 'bubble', data: { datasets: [
      { label: 'Gizmo X', data: [{ x: 15, y: 8, r: 25 }], backgroundColor: chartColors.primary }, // x=Market Share %, y=Growth %, r=Revenue ($M)
      { label: 'Widget Pro', data: [{ x: 10, y: 12, r: 18 }], backgroundColor: chartColors.secondary },
      { label: 'Bolt Mini', data: [{ x: 25, y: 3, r: 15 }], backgroundColor: chartColors.tertiary },
      { label: 'Nano S', data: [{ x: 8, y: 18, r: 8 }], backgroundColor: chartColors.quaternary },
      { label: 'Giga Pack', data: [{ x: 5, y: 5, r: 12 }], backgroundColor: chartColors.quinary }
    ]},
  options: { plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { label: function(context) {
            let label = context.dataset.label || ''; if (label) { label += ': '; }
            const data = context.raw; label += `(Share: ${data.x}%, Growth: ${data.y}%, Revenue: $${data.r}M)`; return label; }}}},
    scales: { x: { title: { display: true, text: 'Market Share (%)' }, min: 0, max: 30 },
              y: { title: { display: true, text: 'Market Growth (%)' }, min: 0, max: 20 } }
  }
});


/* ---------- Social toolbar logic ---------- */
document.querySelectorAll(".bi-card").forEach(card=>{
  // Skip if toolbar already exists
  if(card.querySelector(".card-actions")) return;
  const actions=document.createElement("div");
  actions.className="card-actions";
  // Give slightly higher random numbers for newer cards maybe? Or keep simple.
  const initialLikes = rnd(0, 150);
  const initialViews = rnd(100, 2000);
  actions.innerHTML=`
    <div style="display:flex;gap:18px">
      <button class="icon-btn like" title="Like"><i class="fa-regular fa-heart"></i><span class="like-count">${initialLikes}</span></button>
      <button class="icon-btn share" title="Share"><i class="fa-solid fa-share-nodes"></i></button>
      <button class="icon-btn edit" title="Edit (Placeholder)"><i class="fa-regular fa-pen-to-square"></i></button>
    </div>
    <span class="views"><i class="fa-regular fa-eye"></i><span class="view-count">${initialViews}</span></span>`;
  card.appendChild(actions);
});

/* Like toggle */
document.addEventListener("click",e=>{
  const likeBtn = e.target.closest(".icon-btn.like");
  if(likeBtn){
    likeBtn.classList.toggle("liked");
    const cnt=likeBtn.querySelector(".like-count");
    let n=parseInt(cnt.textContent)||0;
    n+=likeBtn.classList.contains("liked")?1:-1;
    cnt.textContent=n;
    // Optional: Update icon class for filled/regular heart
    const heartIcon = likeBtn.querySelector('i');
    if (heartIcon) {
        heartIcon.classList.toggle('fa-regular', !likeBtn.classList.contains('liked'));
        heartIcon.classList.toggle('fa-solid', likeBtn.classList.contains('liked'));
    }
  }
});

/* Share (Web Share API fallback copy-link) */
document.addEventListener("click",e=>{
    const shareBtn = e.target.closest(".icon-btn.share");
  if(shareBtn){
    const cardElement = shareBtn.closest('.bi-card');
    // Example: Create a unique URL fragment for the card if needed
    const cardId = cardElement.getAttribute('data-aos-delay') || 'card'; // Simple ID based on delay
    const shareUrl = `${location.href.split('#')[0]}#${cardId}`;
    const shareTitle = cardElement.querySelector('h3')?.textContent || document.title;

    if(navigator.share){
        navigator.share({
            title: `BI Magics: ${shareTitle}`,
            text: `Check out this insight: ${shareTitle}`,
            url: shareUrl
        }).catch(error => console.log('Error sharing:', error));
    }
    else{
        navigator.clipboard.writeText(shareUrl).then(() => {
            alert("Link to insight copied!"); // Simple feedback
        }).catch(err => {
            console.error('Failed to copy link: ', err);
            alert("Failed to copy link.");
        });
    }
  }
});

// Optional: Edit button placeholder action
document.addEventListener("click",e=>{
    const editBtn = e.target.closest(".icon-btn.edit");
    if (editBtn) {
        alert("Edit functionality not implemented in this demo.");
    }
});

</script>
</body>
</html>
