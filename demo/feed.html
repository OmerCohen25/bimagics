<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>BI Magics â€¢ Magic Feed</title>

<!-- ===== 3rd-party libs ===== -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/tsparticles@2.11.1/tsparticles.bundle.min.js" defer></script>

<!-- ===== Styles ===== -->
<style>
:root{
  --card-bg:#1e1e28; --card-border:#2f2f42; --accent:#6eee9e;
  --text:#e9e9f1; --kpi:#ffffff; --shadow:0 8px 20px rgba(0,0,0,.45);
  --radius:14px; font-family:"Inter","Segoe UI",Arial,sans-serif;
}
body{margin:0;background:radial-gradient(ellipse at top,#13131d 0%,#0e0e14 55%);color:var(--text);overflow-x:hidden}

#tsparticles{position:fixed;inset:0;z-index:-2}

/* ----- Header ----- */
header{position:sticky;top:0;z-index:5;background:#0d0d14cc;
  backdrop-filter:blur(6px);display:flex;justify-content:center;align-items:center;
  gap:12px;padding:14px 0;border-bottom:1px solid #23232f;}
header h1{font-size:22px;margin:0;font-weight:700;letter-spacing:.5px}
header span{font-size:15px;font-weight:400;opacity:.75}

/* ----- Feed ----- */
.feed{width:100%;max-width:900px;margin:0 auto;padding:110px 16px 160px;
  display:flex;flex-direction:column;gap:48px}

/* ----- Card ----- */
.bi-card{position:relative;overflow:hidden;background:var(--card-bg);
  border:1px solid var(--card-border);border-radius:var(--radius);
  box-shadow:var(--shadow);padding:24px 28px 84px 28px; /* room for toolbar */
  backdrop-filter:blur(4px);}
.bi-card::before{content:"";position:absolute;inset:0;border-radius:inherit;
  pointer-events:none;background:linear-gradient(135deg,transparent 0%,var(--accent)22%,transparent 52%,transparent 100%);
  background-size:400% 400%;opacity:.12;animation:hologlow 8s linear infinite}
@keyframes hologlow{0%{background-position:0 0}100%{background-position:200% 200%}}

/* KPI */
.kpi-value{font-size:clamp(36px,7vw,64px);font-weight:700;color:var(--kpi);margin:0}
.kpi-label{font-size:18px;opacity:.7;margin-top:4px}

/* Table */
.table-wrapper{overflow-x:auto;margin-top:12px}
table{width:100%;border-collapse:collapse;font-size:15px}
th,td{padding:8px 10px;text-align:left;border-bottom:1px solid #2d2d38}
th{color:var(--accent);font-weight:600}

/* Hidden code block */
.code-block{display:none;margin-top:18px;background:#0d0d14;
  border:1px solid #28323b;border-radius:10px;overflow:auto;padding:16px;
  font-size:14px;color:#9cf3ce}

/* Toolbar */
.card-actions{position:absolute;left:0;right:0;bottom:0;height:60px;
  display:flex;justify-content:space-between;align-items:center;
  padding:0 18px;border-top:1px solid #292935;font-size:14px;
  background:#15151dcc;backdrop-filter:blur(6px);}
.icon-btn{background:none;border:none;color:inherit;cursor:pointer;display:flex;
  align-items:center;gap:6px;transition:color .2s;font-size:15px}
.icon-btn:hover{color:var(--accent)}
.icon-btn.like.liked i{color:#ff6b81}
.views{display:flex;align-items:center;gap:6px;opacity:.75;font-size:14px}

/* Saved highlight */
.saved{box-shadow:0 0 0 2px var(--accent), var(--shadow)}

/* Fade-in fallback */
.aos-init:not(.aos-animate){opacity:0}
</style>
</head>
<body>

<canvas id="tsparticles"></canvas>

<!-- ===== Header ===== -->
<header data-aos="fade-down"><h1>BI&nbsp;Magics</h1><span>Magic Feed</span></header>

<!-- ===== Feed ===== -->
<main class="feed">

<!-- ---------- CARDS (22) ---------- -->

<!-- Each card has data-chart="<functionName>" if it contains a Chart.js canvas;
     load happens lazily when card enters viewport                -->

<section class="bi-card" data-aos="fade-up">
  <p class="kpi-value">$ 12,473,920</p><p class="kpi-label">Total Revenue (Last 12 M)</p>
  <pre class="code-block">// Aggregated from BigQuery.orders partitioned by month
SELECT SUM(total_amount) AS revenue_12m
FROM   bigquery.orders
WHERE  order_date &gt;= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH);</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-chart="revenueLine">
  <h3>Revenue Trend</h3><canvas id="revenueLine"></canvas>
  <pre class="code-block">// Monthly revenue trend â€“ same query as KPI but GROUP BY month
SELECT DATE_TRUNC(order_date, MONTH) AS month,
       SUM(total_amount)             AS revenue
FROM   bigquery.orders
WHERE  order_date &gt;= DATE_SUB(CURRENT_DATE(), INTERVAL 12 MONTH)
GROUP  BY month ORDER BY month;</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="100" data-chart="regionPie">
  <h3>Sales by Region</h3><canvas id="regionPie"></canvas>
  <pre class="code-block">// Salesforce.Opportunity.amount rolled-up by billing_country_region</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="200" data-chart="productBar">
  <h3>Top Products</h3><canvas id="productBar"></canvas>
  <pre class="code-block">// BigQuery.products_sales_last_q â€“ top 5 by units_sold DESC</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="300">
  <h3>Top Customers</h3>
  <div class="table-wrapper"><table><thead><tr><th>Customer</th><th>Country</th><th>Spend ($)</th></tr></thead><tbody>
    <tr><td>Acme Corp</td><td>USA</td><td>1,200,000</td></tr><tr><td>Globex</td><td>Canada</td><td>985,500</td></tr>
    <tr><td>Initech</td><td>UK</td><td>873,000</td></tr><tr><td>Umbrella</td><td>Germany</td><td>712,400</td></tr>
    <tr><td>Stark Industries</td><td>USA</td><td>598,900</td></tr><tr><td>Wayne Enterprises</td><td>Israel</td><td>547,100</td></tr>
  </tbody></table></div>
  <pre class="code-block">// Materialized view: customer_revenue_last_12m ordered by spend DESC</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="400">
  <p class="kpi-value">157,332</p><p class="kpi-label">Monthly Active Users</p>
  <pre class="code-block">// Mixpanel.users_active_30d COUNT(DISTINCT user_id)</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="500" data-chart="deviceDoughnut">
  <h3>Device Distribution</h3><canvas id="deviceDoughnut"></canvas>
  <pre class="code-block">// GA4.devices last 30 days â€“ sessions grouped by device_category</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="600" data-chart="trafficBar">
  <h3>Traffic Sources</h3><canvas id="trafficBar"></canvas>
  <pre class="code-block">// GA4.traffic_source (organic/paid/referral/social/email)</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="700">
  <p class="kpi-value">3.8 %</p><p class="kpi-label">Monthly Churn</p>
  <pre class="code-block">// Stripe MRR retention cohort model â€“ logo churn / total customers</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="800">
  <h3>Data Quality Alerts</h3>
  <div class="table-wrapper"><table><thead><tr><th>Timestamp</th><th>Source</th><th>Anomaly</th></tr></thead><tbody>
    <tr><td>2025-05-03 04:12</td><td>bq.orders</td><td>Spike in refunds</td></tr>
    <tr><td>2025-05-02 14:55</td><td>sf.opportunities</td><td>Missing owner_id</td></tr>
    <tr><td>2025-05-01 21:30</td><td>sheet.marketing</td><td>Negative amount</td></tr>
  </tbody></table></div>
  <pre class="code-block">// Real-time anomaly detector using BigQuery ML + Dataform tests</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="900" data-chart="kpiRadar">
  <h3>KPIs vs Target</h3><canvas id="kpiRadar"></canvas>
  <pre class="code-block">// Comparison table kpi_actual_vs_plan for OKRs Q2</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="1000">
  <p class="kpi-value">72</p><p class="kpi-label">Net Promoter Score</p>
  <pre class="code-block">// Delighted NPS daily sync â€“ last 30d average score</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="1100" data-chart="forecastLine">
  <h3>Revenue Forecast</h3><canvas id="forecastLine"></canvas>
  <pre class="code-block">// Prophet forecast from revenue_trend (90 days horizon)</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="1200" data-chart="marketingPie">
  <h3>Marketing Spend</h3><canvas id="marketingPie"></canvas>
  <pre class="code-block">// Google Sheets marketing_spend 2025-Q1 by channel</pre>
</section>

<!-- --- Extra Magic (6) --- -->

<section class="bi-card" data-aos="fade-up" data-aos-delay="1300">
  <p class="kpi-value">$ 1,628</p><p class="kpi-label">Customer LTV</p>
  <pre class="code-block">// LTV = ARPU Ã— Avg Customer Lifetime (cohort analysis)</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="1400" data-chart="signupsLine">
  <h3>Daily Sign-ups</h3><canvas id="signupsLine"></canvas>
  <pre class="code-block">// Auth.users CREATED_DATE grouped daily</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="1500" data-chart="expenseBar">
  <h3>Expenses vs Budget</h3><canvas id="expenseBar"></canvas>
  <pre class="code-block">// Finance.erp_expenses vs budget_2025plan by department</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="1600" data-chart="ticketsPie">
  <h3>Ticket Categories</h3><canvas id="ticketsPie"></canvas>
  <pre class="code-block">// Zendesk.tickets last 30d grouped by type</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="1700" data-chart="teamRadar">
  <h3>Team Performance</h3><canvas id="teamRadar"></canvas>
  <pre class="code-block">// JIRA velocity + QA pass-rate + subjective peer reviews</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="1800" data-chart="planDoughnut">
  <h3>Subscription Mix</h3><canvas id="planDoughnut"></canvas>
  <pre class="code-block">// Billing.subscriptions grouped by plan_tier</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="1900">
  <p class="kpi-value">1.32 s</p><p class="kpi-label">Page Load Avg</p>
  <pre class="code-block">// New Relic Web VITALS â€“ average page_load_95p</pre>
</section>

<section class="bi-card" data-aos="fade-up" data-aos-delay="2000" data-chart="bugsBar">
  <h3>Bug Severity</h3><canvas id="bugsBar"></canvas>
  <pre class="code-block">// JIRA issues grouped by priority WHERE status='Open'</pre>
</section>

</main>

<!-- ===== Scripts ===== -->
<script>
/* ============ Utils ============ */
const rnd=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
const ctx=id=>document.getElementById(id)?.getContext("2d");
const months=["May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","Jan","Feb","Mar","Apr"];

/* ============ Charts Generators ============ */
const chartLoaders={
  revenueLine(){return new Chart(ctx("revenueLine"),{type:"line",
    data:{labels:months,datasets:[{data:months.map(()=>rnd(800,1700)),tension:.35,fill:true}]},
    options:{plugins:{legend:{display:false}},scales:{y:{grid:{color:"#2c2c38"}}}}})},
  regionPie(){return new Chart(ctx("regionPie"),{type:"pie",
    data:{labels:["N-America","EMEA","APAC","LATAM"],datasets:[{data:[38,26,22,14]}]},
    options:{plugins:{legend:{position:"bottom"}}}})},
  productBar(){return new Chart(ctx("productBar"),{type:"bar",
    data:{labels:["Gizmo X","Widget Pro","Bolt Mini","Nano S","Giga Pack"],
      datasets:[{data:Array.from({length:5},()=>rnd(600,1200))}]},
    options:{plugins:{legend:{display:false}},indexAxis:"y"}})},
  deviceDoughnut(){return new Chart(ctx("deviceDoughnut"),{type:"doughnut",
    data:{labels:["Mobile","Desktop","Tablet"],datasets:[{data:[62,29,9]}]},
    options:{plugins:{legend:{position:"bottom"}}}})},
  trafficBar(){return new Chart(ctx("trafficBar"),{type:"bar",
    data:{labels:["Organic","Paid","Referral","Social","Email"],
      datasets:[{data:Array.from({length:5},()=>rnd(150,400))}]},
    options:{plugins:{legend:{display:false}}}})},
  kpiRadar(){return new Chart(ctx("kpiRadar"),{type:"radar",
    data:{labels:["Revenue","Users","Conversion","Retention","NPS"],
      datasets:[{label:"Actual",data:[88,75,64,71,72],fill:true},
                {label:"Target",data:[100,80,70,75,80],borderDash:[6,3]}]},
    options:{plugins:{legend:{position:"bottom"}}}})},
  forecastLine(){return new Chart(ctx("forecastLine"),{type:"line",
    data:{labels:["May","Jun","Jul","Aug","Sep","Oct"],
      datasets:[{data:[1.24,1.32,1.38,1.45,1.51,1.58].map(v=>v*1e6),
                borderDash:[4,4],tension:.35}]},
    options:{plugins:{legend:{display:false}}}})},
  marketingPie(){return new Chart(ctx("marketingPie"),{type:"pie",
    data:{labels:["Search","Social","Influencer","Email","Display"],
      datasets:[{data:[34,27,18,13,8]}]},
    options:{plugins:{legend:{position:"bottom"}}}})},
  signupsLine(){return new Chart(ctx("signupsLine"),{type:"line",
    data:{labels:Array.from({length:30},(_,i)=>i+1),
      datasets:[{data:Array.from({length:30},()=>rnd(120,430)),fill:true,tension:.25}]},
    options:{plugins:{legend:{display:false}}}})},
  expenseBar(){return new Chart(ctx("expenseBar"),{type:"bar",
    data:{labels:["R&D","Marketing","Sales","Ops","HR"],
      datasets:[{label:"Budget",data:[200,180,150,120,80]},
                {label:"Actual",data:[210,195,137,128,95]}]},
    options:{plugins:{legend:{position:"bottom"}}}})},
  ticketsPie(){return new Chart(ctx("ticketsPie"),{type:"pie",
    data:{labels:["Bug","Feature","Question","Incident"],
      datasets:[{data:[48,24,18,10]}]},
    options:{plugins:{legend:{position:"bottom"}}}})},
  teamRadar(){return new Chart(ctx("teamRadar"),{type:"radar",
    data:{labels:["Delivery","Quality","Velocity","Collab","Innovation"],
      datasets:[{label:"Team A",data:[80,85,72,88,70],fill:true},
                {label:"Team B",data:[68,78,75,70,66]}]},
    options:{plugins:{legend:{position:"bottom"}}}})},
  planDoughnut(){return new Chart(ctx("planDoughnut"),{type:"doughnut",
    data:{labels:["Pro","Growth","Enterprise"],datasets:[{data:[56,31,13]}]},
    options:{plugins:{legend:{position:"bottom"}}}})},
  bugsBar(){return new Chart(ctx("bugsBar"),{type:"bar",
    data:{labels:["Critical","High","Medium","Low"],
      datasets:[{data:[12,28,46,38]}]},
    options:{plugins:{legend:{display:false}},indexAxis:"y"}})}
};

/* ============ Particles + AOS ============ */
window.addEventListener("load",()=>{
  tsParticles.load("tsparticles",{
    particles:{number:{value:80,density:{enable:true,area:800}},
      color:{value:"#6eee9e"},links:{enable:true,color:"#6eee9e",opacity:.14},
      move:{enable:true,speed:1.1},opacity:{value:.25}},fullScreen:{enable:false}});
  AOS.init({once:true,duration:700,offset:120});
});

/* ============ Toolbar builder ============ */
function buildToolbar(card){
  if(card.querySelector(".card-actions")) return;
  const views=rnd(100,2000), likes=rnd(0,150);
  const actions=document.createElement("div");
  actions.className="card-actions";
  actions.innerHTML=`
   <div style="display:flex;gap:14px">
     <button class="icon-btn like" title="Like"><i class="fa-regular fa-heart"></i><span class="like-count">${likes}</span></button>
     <button class="icon-btn share" title="Share"><i class="fa-solid fa-share-nodes"></i></button>
     <button class="icon-btn edit" title="Edit"><i class="fa-regular fa-pen-to-square"></i></button>
     <button class="icon-btn code" title="View Code"><i class="fa-solid fa-code"></i></button>
     <button class="icon-btn explore" title="Deep Dive"><i class="fa-solid fa-magnifying-glass-chart"></i></button>
   </div>
   <span class="views"><i class="fa-regular fa-eye"></i><span class="view-count">${views}</span></span>`;
  card.appendChild(actions);
}

/* ============ Lazy Chart Loader ============ */
const observer=new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    if(!entry.isIntersecting) return;
    const card=entry.target;
    if(card.dataset.loaded) return;
    card.dataset.loaded="true";

    // Build toolbar on first load
    buildToolbar(card);

    // Load chart if needed
    const loader=card.dataset.chart;
    if(loader && chartLoaders[loader]) chartLoaders[loader]();
  });
},{rootMargin:"0px 0px 200px 0px",threshold:0.15});

document.querySelectorAll(".bi-card").forEach(card=>observer.observe(card));

/* ============ Like / Code / Share / Explore ============ */
document.addEventListener("click",e=>{
  const likeBtn=e.target.closest(".icon-btn.like");
  if(likeBtn){
    likeBtn.classList.toggle("liked");
    const cnt=likeBtn.querySelector(".like-count");
    cnt.textContent=parseInt(cnt.textContent)+(likeBtn.classList.contains("liked")?1:-1);
  }

  const codeBtn=e.target.closest(".icon-btn.code");
  if(codeBtn){
    const code=codeBtn.closest(".bi-card").querySelector(".code-block");
    if(code) code.style.display=code.style.display==="block"?"none":"block";
  }

  const shareBtn=e.target.closest(".icon-btn.share");
  if(shareBtn){
    const url=location.href;
    if(navigator.share) navigator.share({title:"Check this insight",url}).catch(()=>{});
    else {navigator.clipboard.writeText(url);alert("Link copied!");}
  }

  const exploreBtn=e.target.closest(".icon-btn.explore");
  if(exploreBtn){
    alert("Opening deep-dive chat (stub)â€¦ ðŸš€");
  }
});

/* ============ Swipe Actions ============ */
let startX,swipeCard;
document.addEventListener("pointerdown",e=>{
  swipeCard=e.target.closest(".bi-card"); if(!swipeCard) return;
  startX=e.clientX; swipeCard.style.transition="none";
},true);

document.addEventListener("pointermove",e=>{
  if(!swipeCard) return;
  const dx=e.clientX-startX;
  swipeCard.style.transform=`translateX(${dx}px) rotate(${dx/40}deg)`;
},true);

document.addEventListener("pointerup",e=>{
  if(!swipeCard) return;
  const dx=e.clientX-startX;
  swipeCard.style.transition="transform .3s ease-out";
  if(dx>80){ // swipe right â€“ save & move top
    swipeCard.classList.add("saved");
    swipeCard.style.transform="translateX(100vw)";
    setTimeout(()=>{
      swipeCard.style.transform="none";
      swipeCard.parentElement.prepend(swipeCard);
    },300);
  }else if(dx<-80){ // swipe left â€“ remove
    swipeCard.style.transform="translateX(-100vw)";
    setTimeout(()=>swipeCard.remove(),300);
  }else{
    swipeCard.style.transform="none";
  }
  swipeCard=null;
},true);
</script>
</body>
</html>