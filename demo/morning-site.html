<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>דמו סיטונאי — ניהול קטלוג מסונכרן מורנינג + אתר לקוחות (דף אחד, קליל ובהיר)</title>
<style>
  :root{
    /* צבעים בהירים ונקיים */
    --bg:#f6f8fb; --panel:#ffffff; --panel-soft:#fafbff; --border:#e5e7eb;
    --text:#0f172a; --muted:#64748b; --accent:#16a34a; --accent-2:#2563eb;
    --danger:#ef4444; --shadow:0 10px 28px rgba(15,23,42,.06), 0 4px 10px rgba(15,23,42,.05);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#ffffff,var(--bg));color:var(--text);font:15px/1.55 "Heebo", "Rubik", system-ui, -apple-system, Segoe UI, Roboto, Arial}
  a{color:var(--accent-2);text-decoration:none} a:hover{text-decoration:underline}
  button,input,select,textarea{background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:14px;padding:12px 14px;outline:none}
  input::placeholder,textarea::placeholder{color:#94a3b8}
  button{cursor:pointer;transition:.15s;box-shadow:inset 0 1px 0 rgba(255,255,255,.6)}
  button.primary{background:linear-gradient(180deg,#22c55e,#16a34a);border-color:#10a146;color:#fff}
  button.secondary{background:linear-gradient(180deg,#3b82f6,#2563eb);border-color:#2159d9;color:#fff}
  button.ghost{background:var(--panel);border-color:var(--border)}
  button.danger{background:linear-gradient(180deg,#f87171,#ef4444);border-color:#e11d48;color:#fff}
  .kbd{font:12px ui-monospace,Menlo,Consolas,monospace;border:1px solid var(--border);padding:2px 6px;border-radius:6px;background:#eef2ff;color:#334155}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .sp{flex:1}
  .badge{font-size:11px;padding:4px 10px;border-radius:999px;background:#eef2ff;border:1px solid var(--border);color:#334155}
  .muted{color:var(--muted)}
  .shadow{box-shadow:var(--shadow)}
  .hidden{display:none!important}

  /* מעטפת */
  .app{display:grid;grid-template-rows:auto 1fr;min-height:100%}
  header{
    position:sticky;top:0;z-index:30;
    display:flex;justify-content:space-between;align-items:center;gap:12px;
    padding:10px 14px;border-bottom:1px solid var(--border);background:rgba(255,255,255,.8);backdrop-filter:blur(10px)
  }
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:28px;height:28px;border-radius:9px;background:conic-gradient(from 210deg,#34d399,#22d3ee,#60a5fa,#a78bfa);box-shadow:0 0 22px rgba(99,102,241,.2)}
  nav .tab{padding:10px 14px;border:1px solid var(--border);border-radius:12px;background:var(--panel);cursor:pointer}
  nav .tab.active{outline:2px solid #bfdbfe}

  /* תצוגות */
  .view{display:none}
  .view.active{display:block}

  /* מסכים מדורגים — מעט פרטים */
  .centerwrap{min-height:calc(100vh - 56px);display:grid;place-items:center;padding:20px}
  .card{max-width:720px;width:100%;background:var(--panel);border:1px solid var(--border);border-radius:18px;padding:22px;display:grid;gap:16px}
  .title{margin:0;font-size:22px}
  .subtitle{margin:0;color:var(--muted)}
  .gbtn{display:flex;gap:12px;align-items:center;justify-content:center;background:#f8fafc;border:1px solid var(--border);border-radius:14px;padding:12px;cursor:pointer}
  .gbtn:hover{filter:brightness(1.02)}
  .google{width:18px;height:18px;border-radius:4px;background:conic-gradient(#ea4335 0 25%, #fbbc04 0 50%, #34a853 0 75%, #4285f4 0 100%)}

  /* ניהול — נקי ומינימלי */
  .admin-wrap{padding:14px;display:grid;gap:12px}
  .toolbar{display:flex;gap:10px;align-items:center}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
  .card-item{background:var(--panel);border:1px solid var(--border);border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
  .image{aspect-ratio:4/3;background:#f1f5f9;display:grid;place-items:center;position:relative}
  .image img{width:100%;height:100%;object-fit:cover}
  .image input{position:absolute;inset:0;opacity:0;cursor:pointer}
  .img-hint{position:absolute;bottom:6px;left:6px;font-size:11px;background:rgba(255,255,255,.9);border:1px solid var(--border);padding:4px 6px;border-radius:8px}
  .meta{padding:10px;display:grid;gap:6px}
  .row-sm{display:flex;justify-content:space-between;align-items:center;gap:6px}
  .desc{color:var(--muted);font-size:12px;height:36px;overflow:hidden}
  .pill{padding:6px 9px;border-radius:10px;background:#eef2ff;border:1px solid var(--border);font-size:12px;color:#334155}
  .fab{position:fixed;bottom:16px;left:16px;z-index:40}

  /* חנות */
  .store-head{position:sticky;top:56px;z-index:20;background:var(--panel-soft);border-bottom:1px solid var(--border);padding:10px 14px}
  .store-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;padding:12px}
  .store-card{background:var(--panel);border:1px solid var(--border);border-radius:16px;overflow:hidden}
  .store-footer{padding:16px;color:var(--muted);text-align:center}

  /* מגירת עריכה */
  .drawer{position:fixed;inset:0;display:none;z-index:60;align-items:flex-start;justify-content:flex-start;background:rgba(15,23,42,.1)}
  .drawer.show{display:flex}
  .panel{width:min(720px,100%);max-width:720px;height:100%;background:var(--panel);border-right:1px solid var(--border);padding:16px;overflow:auto}
  .form{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .form .full{grid-column:1/-1}
  .drop{border:2px dashed #e2e8f0;background:#f8fafc;border-radius:14px;display:grid;place-items:center;min-height:140px;position:relative}
  .drop input{position:absolute;inset:0;opacity:0;cursor:pointer}
  .preview{display:flex;gap:10px;flex-wrap:wrap}
  .preview img{width:120px;height:90px;object-fit:cover;border:1px solid var(--border);border-radius:10px}

  /* טוסט */
  .toast{position:fixed;bottom:16px;right:16px;background:#111827;color:#fff;border:1px solid #0b1220;padding:10px 14px;border-radius:12px;box-shadow:var(--shadow);display:none;z-index:90}
  .toast.show{display:block}

  @media (max-width:640px){
    .toolbar{gap:8px}
    .grid,.store-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}
    .image{aspect-ratio:1/1}
  }
</style>
</head>
<body>
<div class="app">

  <!-- כותרת עליונה מינימלית -->
  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <div style="font-weight:800;letter-spacing:.2px">דמו סיטונאי • חד״פ</div>
        <div class="muted" style="font-size:12px">ממשק ניהול + אתר לקוחות — בהיר, נקי ומותאם מובייל</div>
      </div>
      <span class="badge" id="modeBadge">דמו</span>
    </div>
    <nav class="row">
      <div class="tab active" id="tab-admin" title="ממשק ניהול">ניהול</div>
      <div class="tab" id="tab-store" title="אתר ללקוחות">חנות</div>
      <div class="tab hidden" id="tab-logout" title="התנתקות">התנתק</div>
    </nav>
  </header>

  <!-- מסך 1: רואים רק גוגל -->
  <section id="view-login" class="view active">
    <div class="centerwrap">
      <div class="card shadow" style="text-align:center">
        <h1 class="title">התחברות עם Google</h1>
        <p class="subtitle">דמו אינטראקטיבי — לחיצה תדמה התחברות מאובטחת (ללא חיבור חיצוני).</p>
        <div class="gbtn" id="btn-google"><div class="google"></div> התחברות עם Google</div>
      </div>
    </div>
  </section>

  <!-- מסך 2: רואים רק מפתחות מורנינג (מינימלי) -->
  <section id="view-keys" class="view">
    <div class="centerwrap">
      <div class="card shadow">
        <h2 class="title">חיבור ל-Morning</h2>
        <p class="subtitle">ניתן להשאיר במצב דמו — הכל יעבוד ללא רשת. להדגמה בלבד.</p>
        <label>סביבת עבודה</label>
        <select id="base">
          <option value="https://sandbox.d.greeninvoice.co.il/api/v1">Sandbox</option>
          <option value="https://api.greeninvoice.co.il/api/v1">Production</option>
          <option value="custom">מותאם…</option>
        </select>
        <input id="baseCustom" class="hidden" placeholder="https://…/api/v1"/>
        <label>JWT (Authorization: Bearer …)</label>
        <input id="token" placeholder="הדבק כאן את ה-JWT שלך (לא חובה בדמו)"/>
        <label class="row" style="align-items:center"><input type="checkbox" id="demoToggle" checked/> <span>מצב דמו (ללא רשת חיצונית)</span></label>
        <div class="row" style="justify-content:flex-start">
          <button class="primary" id="btn-continue">המשך לניהול</button>
          <button class="ghost" id="btn-test">בדיקת חיבור</button>
        </div>
        <small class="muted">טיפ: אפשר תמיד לעבור לחנות דרך הכפתור בחלק העליון.</small>
      </div>
    </div>
  </section>

  <!-- מסך 3: רואים רק הקטלוג ומצב ניהול (מינימליסטי) -->
  <section id="view-admin" class="view">
    <div class="admin-wrap">

      <!-- טולבר נקי: חיפוש + כפתורים עיקריים -->
      <div class="toolbar">
        <input id="q" class="sp" placeholder="חיפוש בקטלוג ( / )"/>
        <button id="newItem" class="ghost">➕ פריט חדש</button>
        <button id="syncBtn" class="ghost" title="סנכרון דוחף/שואב">🔄 סנכרן</button>
        <button id="publish" class="secondary">פרסום לחנות</button>
        <button id="gotoStore" class="primary">מעבר לחנות</button>
      </div>

      <!-- רשת פריטים -->
      <div class="grid" id="grid"></div>

      <!-- כפתור צף להוספה (מובייל נוח) -->
      <div class="fab"><button id="fabNew" class="primary shadow">➕ הוסף</button></div>
    </div>
  </section>

  <!-- מסך 4: החנות (נקייה: חיפוש בלבד + רשת כרטיסים) -->
  <section id="view-store" class="view">
    <div class="store-head row">
      <input id="s-q" class="sp" placeholder="חיפוש בחנות…"/>
      <button id="backAdmin" class="ghost">↩︎ חזרה לניהול</button>
    </div>
    <div class="store-grid" id="s-grid"></div>
    <div class="store-footer">דמו בהיר ומקצועי — כל הדף בקובץ אחד. התמונות בדמו הן דינמיות (SVG) לצורך המחשה.</div>
  </section>

</div>

<!-- מגירת עריכה -->
<div class="drawer" id="drawer">
  <div class="panel">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3 id="editTitle" style="margin:0">פריט חדש</h3>
      <div class="row">
        <button id="save" class="primary">💾 שמור</button>
        <button id="close" class="ghost">סגור ✖</button>
      </div>
    </div>
    <div class="form">
      <div class="full"><label>שם</label><input id="f_name" placeholder="שם פריט" required/></div>
      <div class="full"><label>תיאור</label><textarea id="f_desc" placeholder="תיאור קצר" rows="3"></textarea></div>
      <div><label>מחיר</label><input id="f_price" type="number" step="0.01" placeholder="0.00"/></div>
      <div><label>מטבע</label><select id="f_currency"><option>ILS</option><option>USD</option><option>EUR</option></select></div>
      <div><label>SKU</label><input id="f_sku" placeholder="מק״ט / קוד"/></div>
      <div><label>קטגוריה</label><input id="f_cat" placeholder="קטגוריה"/></div>
      <div class="full"><label>תמונה</label>
        <div class="drop"><input id="f_img" type="file" accept="image/*"/><div class="muted">גרור/י או לחצ/י להעלאת תמונה</div></div>
        <div class="preview" id="preview"></div>
      </div>
      <div class="full"><label>קישור תמונה (אופציונלי)</label><input id="f_imgurl" placeholder="https://… (להטמעה בחנות)"/></div>
      <div class="full"><label><input id="f_active" type="checkbox" checked/> להציג בחנות</label></div>
      <div class="full row" style="justify-content:space-between;margin-top:6px">
        <button id="dup" class="ghost">⧉ שכפל</button>
        <button id="delete" class="danger">מחק</button>
      </div>
    </div>
  </div>
</div>

<!-- טוסט -->
<div class="toast" id="toast"></div>

<script>
/* =========================
   דמו בהיר נקי: גוגל → מפתחות → ניהול → חנות
   ========================= */

const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const uid = () => Math.random().toString(36).slice(2,9);
const toast = (m)=>{const t=$('#toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2000);};
const esc = s => (s??'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));
const money = (v,c='ILS') => Number(v||0).toLocaleString('he-IL',{style:'currency',currency:c});

/* מצב כלל־מערכתי (מינימלי) */
const LS = { items:'lightdemo.items', published:'lightdemo.published', remote:'lightdemo.remote', settings:'lightdemo.settings', user:'lightdemo.user' };
let USER = null;
let SETTINGS = load(LS.settings) || { base:'https://sandbox.d.greeninvoice.co.il/api/v1', token:'', demo:true };
let ITEMS = load(LS.items) || [];
let PUBLISHED = load(LS.published) || { items:[] };
let CURRENT = null;

/* כלים */
function load(k){ try{ return JSON.parse(localStorage.getItem(k)||'null'); }catch{ return null; } }
function save(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function setView(id){ $$('.view').forEach(v=>v.classList.remove('active')); $(id).classList.add('active'); }
function svgPlaceholder(text, color='#22c55e'){
  const w=800,h=600,t=encodeURIComponent(text);
  return `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}'>
  <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='${color}'/><stop offset='100%' stop-color='%23e2e8f0'/></linearGradient></defs>
  <rect width='100%' height='100%' fill='url(%23g)'/><text x='50%' y='52%' dominant-baseline='middle' text-anchor='middle'
  font-family='Heebo,Arial' font-size='54' fill='%230f172a' opacity='.9'>${t}</text></svg>`;
}
const fileToDataURL = f => new Promise(res=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(f); });

/* "שרת" מורנינג מדומה — נקי */
const MorningMock = {
  load(){
    let r = load(LS.remote);
    if(!r){
      const seed = [
        ['כוסות פלסטיק 200 מ״ל (100 יח׳)','כוסות שקופות למשקאות קרים',12.9,'ILS'],
        ['מכסים לכוס 8oz (100 יח׳)','מתאים לכוסות קפה 8oz',18.0,'ILS'],
        ['צלחות נייר 9" (100 יח׳)','צלחות לבנות חד״פ',22.9,'ILS'],
        ['סכו״ם פלסטיק (100 יח׳)','מזלגות/סכינים/כפיות',27.9,'ILS'],
        ['שקי אשפה XL (25 יח׳)','שקיות 120 ל׳ חזקות',19.9,'ILS'],
        ['תבניות אלומיניום (20 יח׳)','לתנור/מנגל',32.0,'ILS'],
        ['מגבות נייר (24 גלילים)','ספיגה חזקה',69.0,'ILS'],
        ['סבון כלים 5 ל׳','ניחוח לימון',29.0,'ILS']
      ];
      r = seed.map((s,i)=>({ id:String(1000+i), name:s[0], description:s[1], price:s[2], currency:s[3] }));
      save(LS.remote, r);
    }
    return r;
  },
  save(a){ save(LS.remote, a); },
  async search(q=''){ await delay(); const all=this.load(); q=q.toLowerCase(); return { items: all.filter(i => (`${i.name} ${i.description}`).toLowerCase().includes(q)) }; },
  async create(p){ await delay(); const all=this.load(); const id=String(Date.now()+Math.random()*1000|0); const obj={ id, name:p.name||'', description:p.description||'', price:+(p.price||0), currency:p.currency||'ILS' }; all.push(obj); this.save(all); return obj; },
  async update(id,p){ await delay(); const all=this.load(); const ix=all.findIndex(x=>x.id===id); if(ix<0) throw new Error('404'); all[ix]={...all[ix], name:p.name||all[ix].name, description:p.description??all[ix].description, price:+(p.price??all[ix].price), currency:p.currency||all[ix].currency}; this.save(all); return all[ix]; },
  async remove(id){ await delay(); const all=this.load().filter(x=>x.id!==id); this.save(all); return 'ok'; },
};
function delay(){ return new Promise(r=>setTimeout(r,220+Math.random()*320)); }

/* זריעת דמו מקומי מינימלי */
function ensureSeed(){
  if(ITEMS.length) return;
  const remote = MorningMock.load();
  ITEMS = remote.map(r=>({
    id:uid(), morningId:r.id, name:r.name, description:r.description, price:r.price, currency:r.currency,
    sku:'SKU-'+(100+Math.random()*900|0), category:'חד״פ', active:true,
    imageData: svgPlaceholder(r.name), imageUrl:'', dirty:false
  }));
  save(LS.items, ITEMS);
}

/* רינדור ניהול */
function renderAdmin(){
  const q = ($('#q').value||'').toLowerCase();
  const list = ITEMS.filter(i => (`${i.name} ${i.description} ${i.sku} ${i.category}`).toLowerCase().includes(q));
  const grid = $('#grid'); grid.innerHTML='';
  list.forEach(it=>{
    const card=document.createElement('div'); card.className='card-item shadow';
    card.innerHTML = `
      <div class="image">
        ${(it.imageUrl||it.imageData)?`<img src="${it.imageUrl||it.imageData}" alt="">`:`<div class="muted">ללא תמונה</div>`}
        <div class="img-hint">שנה תמונה</div>
        <input type="file" accept="image/*" data-img="${it.id}">
      </div>
      <div class="meta">
        <div class="row-sm"><b>${esc(it.name)}</b>${it.dirty?'<span class="badge">לא מסונכרן</span>':''}</div>
        <div class="desc">${esc(it.description||'')}</div>
        <div class="row-sm"><div style="font-weight:700">${money(it.price,it.currency)}</div><span class="pill">${esc(it.currency||'ILS')}</span></div>
        <div class="row" style="justify-content:space-between">
          <span class="muted" title="SKU">${esc(it.sku||'–')}</span>
          <div class="row" style="gap:6px">
            <button class="ghost" data-edit="${it.id}">עריכה</button>
            <button class="ghost danger" data-del="${it.id}">מחיקה</button>
          </div>
        </div>
      </div>`;
    grid.appendChild(card);
  });
}

/* פתיחה/שמירה */
function openEditor(id){
  const it = ITEMS.find(x=>x.id===id);
  CURRENT = it ? {...it} : { id:uid(), name:'', description:'', price:0, currency:'ILS', sku:'', category:'', active:true, imageData:'', imageUrl:'' };
  $('#editTitle').textContent = it ? 'עריכת פריט' : 'פריט חדש';
  $('#f_name').value=CURRENT.name||''; $('#f_desc').value=CURRENT.description||'';
  $('#f_price').value=CURRENT.price||0; $('#f_currency').value=CURRENT.currency||'ILS';
  $('#f_sku').value=CURRENT.sku||''; $('#f_cat').value=CURRENT.category||'';
  $('#f_active').checked=!!CURRENT.active; $('#f_imgurl').value=CURRENT.imageUrl||'';
  $('#preview').innerHTML = (CURRENT.imageUrl||CURRENT.imageData)?`<img src="${CURRENT.imageUrl||CURRENT.imageData}">`:'';
  $('#drawer').classList.add('show');
}
function closeEditor(){ $('#drawer').classList.remove('show'); CURRENT=null; }
function persistCurrent(){
  if(!CURRENT) return;
  CURRENT.name = $('#f_name').value.trim(); if(!CURRENT.name) return toast('שם נדרש');
  CURRENT.description = $('#f_desc').value.trim();
  CURRENT.price = +($('#f_price').value||0);
  CURRENT.currency = $('#f_currency').value;
  CURRENT.sku = $('#f_sku').value.trim();
  CURRENT.category = $('#f_cat').value.trim();
  CURRENT.active = $('#f_active').checked;
  CURRENT.imageUrl = $('#f_imgurl').value.trim();
  const ix = ITEMS.findIndex(x=>x.id===CURRENT.id);
  if(ix<0) ITEMS.unshift({...CURRENT, dirty:true}); else ITEMS[ix] = {...CURRENT, dirty:true};
  save(LS.items, ITEMS);
  renderAdmin(); toast('נשמר מקומית');
}

/* סנכרון (דמו) */
function mapToMorning(i){ return { name:i.name||'', description:i.description||'', price:+(i.price||0), currency:i.currency||'ILS' }; }
async function pushPull(){
  if(!SETTINGS.demo){ toast('Live אינו פעיל בדמו'); return; }
  // דחיפה
  const dirty = ITEMS.filter(i=>i.dirty);
  for(const it of dirty){
    let id = it.morningId;
    if(!id){
      const res = await MorningMock.search(it.name);
      const found = (res.items||[]).find(x=> (x.name||'').toLowerCase()===(it.name||'').toLowerCase());
      if(found) id = found.id;
    }
    if(id){ await MorningMock.update(id, mapToMorning(it)); it.morningId=id; }
    else{ const created=await MorningMock.create(mapToMorning(it)); it.morningId=created.id; }
    it.dirty=false;
  }
  // משיכה
  const res = await MorningMock.search($('#q').value||'');
  const arr = res.items||[];
  const byName = Object.fromEntries(ITEMS.map(i=>[(i.name||'').toLowerCase(),i]));
  ITEMS = arr.map(r=>{
    const local = byName[(r.name||'').toLowerCase()];
    return {
      id: local?.id||uid(), morningId: r.id,
      name:r.name||'', description:r.description||'', price:+(r.price||0), currency:r.currency||'ILS',
      sku: local?.sku||'', category: local?.category||'', active: local?.active ?? true,
      imageUrl: local?.imageUrl||'', imageData: local?.imageData || svgPlaceholder(r.name,'#93c5fd'),
      dirty:false
    };
  });
  save(LS.items, ITEMS);
  renderAdmin();
  toast('סונכרן מול מורנינג (דמו)');
}

/* פרסום לחנות */
function publish(){
  PUBLISHED = { items: ITEMS.filter(i=>i.active).map(i=>({ id:i.id, name:i.name, description:i.description, price:+(i.price||0), currency:i.currency||'ILS', category:i.category||'', imageUrl:i.imageUrl||'', imageData:i.imageData||'' })) };
  save(LS.published, PUBLISHED);
  toast('פורסם לחנות');
  if($('#view-store').classList.contains('active')) renderStore();
}

/* חנות — נקייה */
function renderStore(){
  const q = ($('#s-q').value||'').toLowerCase();
  const list = (PUBLISHED.items||[]).filter(i => (`${i.name} ${i.description} ${i.category}`).toLowerCase().includes(q));
  const g = $('#s-grid'); g.innerHTML='';
  list.forEach(i=>{
    const el=document.createElement('div'); el.className='store-card shadow';
    el.innerHTML = `
      <div class="image">${(i.imageUrl||i.imageData)?`<img src="${i.imageUrl||i.imageData}" alt="">`:`<div class="muted">ללא תמונה</div>`}</div>
      <div class="meta">
        <div class="row" style="justify-content:space-between"><b>${esc(i.name)}</b><span class="pill">${esc(i.currency||'ILS')}</span></div>
        <div class="desc">${esc(i.description||'')}</div>
        <div class="row" style="justify-content:space-between;margin-top:6px"><div style="font-weight:700">${money(i.price,i.currency)}</div><div class="muted" style="font-size:12px">${esc(i.category||'')}</div></div>
      </div>`;
    g.appendChild(el);
  });
}

/* ניווט/אימות */
function signedInUI(){ $('#tab-logout').classList.remove('hidden'); $('#modeBadge').textContent = SETTINGS.demo ? 'דמו' : 'Live'; }
$('#tab-admin').onclick=()=>{ $('#tab-admin').classList.add('active'); $('#tab-store').classList.remove('active'); setView('#view-admin'); };
$('#tab-store').onclick=()=>{ $('#tab-store').classList.add('active'); $('#tab-admin').classList.remove('active'); setView('#view-store'); renderStore(); };
$('#tab-logout').onclick=()=>{ USER=null; save(LS.user,null); setView('#view-login'); $('#tab-logout').classList.add('hidden'); };

/* אירועים — מסכים */
$('#btn-google').onclick=()=>{ USER={name:'משתמש/ת', email:'demo@example.com'}; save(LS.user, USER); setView('#view-keys'); toast('מחובר/ת (דמו)'); signedInUI(); };
$('#base').onchange=()=>{ $('#baseCustom').classList.toggle('hidden', $('#base').value!=='custom'); };
$('#demoToggle').onchange=()=>{ SETTINGS.demo = $('#demoToggle').checked; save(LS.settings, SETTINGS); $('#modeBadge').textContent = SETTINGS.demo?'דמו':'Live'; };
$('#btn-test').onclick=()=> toast(SETTINGS.demo ? 'בדיקה בדמו: ✓' : 'Live אינו פעיל בדמו');
$('#btn-continue').onclick=()=>{
  SETTINGS.base = ($('#base').value==='custom') ? ($('#baseCustom').value.trim() || SETTINGS.base) : $('#base').value;
  SETTINGS.token = $('#token').value.trim() || '';
  save(LS.settings, SETTINGS);
  ensureSeed(); renderAdmin(); setView('#view-admin'); toast('ברוך הבא לניהול');
};

/* אירועים — ניהול */
$('#q').addEventListener('input', renderAdmin);
$('#newItem').onclick=()=>openEditor();
$('#fabNew').onclick=()=>openEditor();
$('#syncBtn').onclick=()=>pushPull();
$('#publish').onclick=()=>publish();
$('#gotoStore').onclick=()=>{ $('#tab-store').click(); };
$('#backAdmin').onclick=()=>{ $('#tab-admin').click(); };
document.addEventListener('keydown', e=>{
  if(e.key==='/' && !['INPUT','TEXTAREA'].includes(document.activeElement.tagName)){ e.preventDefault(); $('#q').focus(); }
  if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){ e.preventDefault(); if($('#drawer').classList.contains('show')) persistCurrent(); }
});

/* עריכה/תמונות/מחיקה בכרטיסים */
document.addEventListener('change', async e=>{
  const t=e.target;
  if(t.matches('.image input[type=file]')){
    const id=t.getAttribute('data-img'); const f=t.files?.[0]; if(!f) return;
    const data=await fileToDataURL(f); const it=ITEMS.find(x=>x.id===id);
    if(it){ it.imageData=data; it.dirty=true; save(LS.items, ITEMS); renderAdmin(); toast('תמונה עודכנה'); }
  }
  if(t.id==='f_img'){
    const f=t.files?.[0]; if(!f) return; const data=await fileToDataURL(f);
    CURRENT.imageData=data; $('#preview').innerHTML=`<img src="${data}">`;
  }
});
document.addEventListener('click', async e=>{
  const edit=e.target.closest('[data-edit]'); const del=e.target.closest('[data-del]');
  if(edit) openEditor(edit.getAttribute('data-edit'));
  if(del){
    const id=del.getAttribute('data-del');
    if(confirm('למחוק את הפריט מקומית (ובדמו גם מהשרת המדומה)?')){
      const it=ITEMS.find(x=>x.id===id);
      ITEMS = ITEMS.filter(x=>x.id!==id); save(LS.items, ITEMS); renderAdmin();
      if(it?.morningId && SETTINGS.demo){ try{ await MorningMock.remove(it.morningId); }catch{} }
      toast('נמחק');
    }
  }
});
$('#save').onclick=()=>persistCurrent();
$('#close').onclick=()=>closeEditor();
$('#dup').onclick=()=>{ if(!CURRENT) return; const copy={...CURRENT,id:uid(),name:CURRENT.name+' (העתק)',dirty:true}; ITEMS.unshift(copy); save(LS.items, ITEMS); renderAdmin(); toast('שוכפל'); };
$('#delete').onclick=()=>{ if(!CURRENT) return; if(confirm('למחוק פריט זה?')){ ITEMS=ITEMS.filter(x=>x.id!==CURRENT.id); save(LS.items, ITEMS); renderAdmin(); closeEditor(); toast('נמחק'); } };

/* אתחול */
(function init(){
  USER = load(LS.user);
  if(USER){ signedInUI(); ensureSeed(); renderAdmin(); setView('#view-admin'); }
  else{ setView('#view-login'); }
})();
</script>
</body>
</html>
```0