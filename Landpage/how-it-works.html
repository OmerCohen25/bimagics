<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How It Works | The Intelligent Agent Behind BI MAGICS</title>
    
    <meta name="description" content="See our intelligent Agent in action. Discover how it connects to your DWH, builds a live data catalog, finds relationships, and provides optimization recommendations.">
    <meta name="keywords" content="Data Agent, Automated Data Catalog, Data Governance, BI Architecture, LLM Agnostic, VPC Deployment, Data Optimization, Data Discovery, Self-Service BI">
    <meta name="theme-color" content="#0a0a1a">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.bimagics.com/how-it-works.html">
    <meta property="og:title" content="How It Works | The Intelligent Agent Behind BI MAGICS">
    <meta property="og:description" content="Our agent provides self-service for business teams and a powerful optimization & discovery tool for data teams. See the live, interactive demo.">
    <meta property="og:image" content="https://www.bimagics.com/og-image-how.png">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>✨</text></svg>">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2EY1HGXGNT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-2EY1HGXGNT');
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=Tilt+Neon&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.js"></script>
    <script src="https://unpkg.com/lucide-static@latest/dist/lucide.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        :root { --cyan-glow: rgba(34, 211, 238, 0.5); }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #0a0a1a; color: #E0E0E0; overflow-x: hidden; }
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .content-wrapper { position: relative; z-index: 1; }
        .font-tilt-neon { font-family: 'Tilt Neon', sans-serif; }
        .font-fira-code { font-family: 'Fira Code', monospace; }
        .glass-effect { background: rgba(17, 24, 39, 0.6); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .header-scrolled { background: rgba(10, 10, 26, 0.8); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        .neon-text-cyan { text-shadow: 0 0 8px #22D3EE, 0 0 12px #22D3EE, 0 0 20px #67e8f9; }
        
        .fade-in-section { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .fade-in-section.is-visible { opacity: 1; transform: translateY(0); }
        
        .faq-item.open .faq-icon { transform: rotate(135deg); }
        .faq-icon { transition: transform 0.3s ease-in-out; }
        .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, padding 0.5s ease; padding: 0 1.5rem; }
        .faq-item.open .faq-answer { max-height: 500px; padding: 0.5rem 1.5rem 1.5rem; }

        .pulse-glow { animation: pulse-glow-animation 2s infinite; }
        @keyframes pulse-glow-animation {
            0% { box-shadow: 0 0 0 0 var(--cyan-glow); }
            70% { box-shadow: 0 0 20px 10px rgba(34, 211, 238, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 211, 238, 0); }
        }

        .demo-element, .wizard-bubble, .data-tool-content { opacity: 0; transform: scale(0.95) translateY(10px); transition: opacity 0.4s ease-out, transform 0.4s ease-out; }
        .demo-element.visible, .wizard-bubble.visible, .data-tool-content.visible { opacity: 1; transform: scale(1) translateY(0); }
        .lineage-path { stroke-dasharray: 500; stroke-dashoffset: 500; animation: draw-line 1s ease-out forwards; }
        @keyframes draw-line { to { stroke-dashoffset: 0; } }
        .data-tool-tab { border-bottom: 2px solid transparent; transition: all 0.2s ease-in-out; }
        .data-tool-tab.active { color: #22D3EE; border-bottom-color: #22D3EE; }
        .wizbi-bar { transform-origin: bottom; transition: transform 0.5s ease-out; }
    </style>
</head>
<body class="antialiased">

    <canvas id="bg-canvas"></canvas>

    <div class="content-wrapper">
        <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
             <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-20 transition-all duration-300">
                    <a href="index.html" class="flex items-center space-x-2">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-purple-400"><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <span class="text-2xl font-black gradient-text">BI MAGICS</span>
                    </a>
                    <nav class="hidden lg:flex items-center space-x-8 font-medium">
                        <a href="index.html#solutions" class="text-gray-300 hover:text-white transition-colors">Solutions</a>
                        <a href="wizbi.html" class="text-gray-300 hover:text-white transition-colors">WizBI</a>
                        <a href="how-it-works.html" class="text-white transition-colors neon-text-cyan font-bold">How It Works</a>
                        <a href="full-service.html" class="text-gray-300 hover:text-white transition-colors">Full Service</a>
                        <a href="index.html#contact" class="text-gray-300 hover:text-white transition-colors">Contact</a>
                    </nav>
                     <div class="flex items-center gap-4">
                        <div class="hidden lg:block">
                           <a href="#contact-tech" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105">Talk to an Engineer</a>
                        </div>
                        <div class="lg:hidden">
                            <button id="mobile-menu-button" aria-label="Open mobile menu" class="text-white focus:outline-none"><i data-lucide="menu"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="mobile-menu" class="hidden lg:hidden glass-effect">
                 <nav class="px-4 pt-2 pb-4 space-y-1 sm:px-6">
                    <a href="index.html#solutions" class="block text-gray-300 hover:text-white py-2 rounded-md">Solutions</a>
                    <a href="wizbi.html" class="block text-gray-300 hover:text-white py-2 rounded-md">WizBI</a>
                    <a href="how-it-works.html" class="block text-white py-2 rounded-md font-bold">How It Works</a>
                    <a href="full-service.html" class="block text-gray-300 hover:text-white py-2 rounded-md">Full Service</a>
                    <a href="index.html#contact" class="block text-gray-300 hover:text-white py-2 rounded-md">Contact</a>
                    <a href="#contact-tech" class="block bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 text-center mt-4">Talk to an Engineer</a>
                </nav>
            </div>
        </header>

        <main class="pt-20">
             <section id="how-it-works-hero" class="py-24 bg-cyan-900/10 fade-in-section is-visible">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-center max-w-4xl mx-auto">
                        <h1 class="text-4xl md:text-5xl font-black font-tilt-neon mb-4"><span class="neon-text-cyan">The Intelligent Agent That Powers Modern BI</span></h1>
                        <p class="text-lg md:text-xl text-gray-300">Go beyond dashboards. Our autonomous agent doesn't just enable self-service for your business teams—it gives your data team a powerful new tool for governance, discovery, and optimization.</p>
                    </div>
                </div>
            </section>
            
            <section id="agent-demo" class="py-24 fade-in-section is-visible" x-data="agentDemo">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                     <div class="text-center mb-16">
                        <h2 class="text-3xl md:text-5xl font-black">See The Agent in Real-Time</h2>
                        <p class="text-lg text-gray-400 max-w-3xl mx-auto mt-4" x-text="demoSubtitle"></p>
                    </div>
                    <div class="max-w-7xl mx-auto flex flex-col items-center">
                        <div x-show="state === 'idle'" x-transition class="w-full max-w-md text-center">
                            <div class="glass-effect rounded-2xl p-8">
                                <i data-lucide="database" class="w-16 h-16 text-cyan-400 mx-auto mb-4"></i>
                                <h3 class="text-2xl font-bold">Connect to Data Warehouse</h3>
                                <p class="text-gray-400 mt-2 mb-6">Provide read-only credentials to allow the Agent to begin the discovery process.</p>
                                <div class="space-y-4">
                                    <input type="text" value="agent_user@bimagics" disabled class="w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-2 text-center font-fira-code">
                                    <input type="password" value="**************" disabled class="w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-2 text-center font-fira-code">
                                </div>
                            </div>
                            <button @click="runScript()" class="pulse-glow mt-8 bg-cyan-600 text-white font-bold py-4 px-10 rounded-full transition-all duration-300 transform hover:scale-105 hover:bg-cyan-500 active:scale-95 flex items-center gap-3 text-lg mx-auto">
                                <i data-lucide="zap"></i>
                                <span>Connect & Run Agent</span>
                            </button>
                        </div>
                        
                        <div x-show="state !== 'idle'" x-transition class="w-full h-[650px] md:h-[600px] glass-effect rounded-2xl flex flex-col p-1 border-2 border-cyan-400/30">
                             <div class="flex-shrink-0 p-2 border-b border-cyan-800/50 flex items-center justify-between"><div class="flex items-center gap-2"><span class="w-3 h-3 bg-red-500 rounded-full"></span><span class="w-3 h-3 bg-yellow-500 rounded-full"></span><span class="w-3 h-3 bg-green-500 rounded-full"></span></div><div class="text-xs text-cyan-300 font-fira-code">BI MAGICS Agent Console</div></div>
                             <div class="flex-grow flex flex-col lg:flex-row p-4 gap-4 overflow-hidden h-full">
                                <div class="w-full lg:w-3/5 bg-black/20 rounded-lg p-4 overflow-y-auto space-y-4" x-ref="visualPanel">
                                    <template x-for="visual in visuals" :key="visual.id">
                                        <div class="demo-element" :class="{ 'visible': visual.visible }" x-html="visual.html"></div>
                                    </template>
                                    <div x-show="state === 'finished'" class="demo-element" :class="{'visible': state === 'finished'}">
                                        <div class="mt-4 pt-4 border-t-2 border-dashed border-purple-500/50">
                                            <h4 class="font-bold text-center text-purple-300 mb-4">WizBI is Now Active</h4>
                                            <div class="space-y-3">
                                                <template x-for="message in wizardMessages" :key="message.id">
                                                     <div class="wizard-bubble flex items-end gap-2" :class="message.author === 'user' ? 'justify-end' : 'justify-start', {'visible': message.visible}">
                                                        <div x-show="message.author === 'user'" class="bg-purple-800 rounded-lg p-3 max-w-xs"><p x-text="message.text"></p></div>
                                                        <div x-show="message.author === 'wizbi'" class="flex items-end gap-2 max-w-md">
                                                            <i data-lucide="wand-2" class="w-8 h-8 text-purple-300 flex-shrink-0 self-start"></i>
                                                            <div class="bg-slate-700 rounded-lg p-3 w-full" x-html="message.text"></div>
                                                        </div>
                                                     </div>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="w-full lg:w-2/5 bg-black/20 rounded-lg p-4 flex flex-col font-fira-code text-sm overflow-y-auto" x-ref="logContainer">
                                    <template x-for="log in logs" :key="log.id">
                                        <p :class="log.color" class="flex gap-2 text-xs"><span class="flex-shrink-0 text-gray-500" x-text="log.timestamp"></span><span class="flex-shrink-0" x-text="log.level"></span><span class="whitespace-pre-wrap" x-html="log.message"></span></p>
                                    </template>
                                </div>
                             </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="data-team-tools" class="py-24 bg-gray-900/20 fade-in-section is-visible" x-data="dataTeamTools">
                 <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-center mb-16 max-w-3xl mx-auto">
                        <h2 class="text-3xl md:text-5xl font-black">A Powerful Toolkit for Data Teams</h2>
                        <p class="text-lg text-gray-400">The Agent's work creates valuable assets that empower your team to govern, optimize, and understand your data better than ever before. Explore the outputs:</p>
                    </div>
                    <div class="max-w-5xl mx-auto">
                        <div class="flex justify-center border-b border-gray-700 mb-8">
                            <button @click="activeTab = 'catalog'" :class="{'active': activeTab === 'catalog'}" class="data-tool-tab font-bold text-lg px-6 py-3 text-gray-400 hover:text-white">
                                <i data-lucide="book-marked" class="inline-block w-5 h-5 mr-2"></i> Live Data Catalog
                            </button>
                            <button @click="activeTab = 'optimize'" :class="{'active': activeTab === 'optimize'}" class="data-tool-tab font-bold text-lg px-6 py-3 text-gray-400 hover:text-white">
                                <i data-lucide="gauge-circle" class="inline-block w-5 h-5 mr-2"></i> DWH Optimization
                            </button>
                        </div>
                        
                        <div class="relative min-h-[300px]">
                            <div x-show="activeTab === 'catalog'" x-transition:enter.duration.300ms x-transition:leave.duration.200ms class="data-tool-content absolute w-full" :class="{'visible': activeTab === 'catalog'}">
                                <div class="glass-effect rounded-lg p-6">
                                    <h3 class="text-xl font-bold mb-4">`analytics` Schema Catalog</h3>
                                    <div class="space-y-4">
                                        <div class="bg-slate-800 p-4 rounded-md">
                                            <p class="font-bold font-fira-code text-cyan-300">dim_customers</p>
                                            <p class="text-sm text-gray-300 mt-1"><strong>AI Summary:</strong> Dimension table containing customer profile information, including signup date, location, and account status. Enriched with `country_name` from IP lookup.</p>
                                        </div>
                                        <div class="bg-slate-800 p-4 rounded-md">
                                            <p class="font-bold font-fira-code text-cyan-300">fact_orders</p>
                                            <p class="text-sm text-gray-300 mt-1"><strong>AI Summary:</strong> Central fact table for all sales transactions. Contains order amounts, product IDs, customer IDs, and timestamps. Use for revenue analysis.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div x-show="activeTab === 'optimize'" x-transition:enter.duration.300ms x-transition:leave.duration.200ms class="data-tool-content absolute w-full" :class="{'visible': activeTab === 'optimize'}">
                                 <div class="glass-effect rounded-lg p-6">
                                    <h3 class="text-xl font-bold mb-4">Cost & Performance Insights</h3>
                                    <p class="text-gray-400 mb-4">Agent-identified opportunities to improve performance and reduce warehouse spend.</p>
                                    <div class="bg-slate-800 p-4 rounded-md">
                                        <p class="font-bold text-yellow-400 mb-2"><i data-lucide="alert-triangle" class="inline w-5 h-5"></i> Inefficient Query Detected</p>
                                        <code class="block bg-black/50 p-2 rounded text-xs font-fira-code text-red-400">SELECT * FROM fact_orders WHERE DATE(order_date) > '2025-01-01'</code>
                                        <p class="text-sm text-gray-300 mt-2"><strong>Recommendation:</strong> Avoid functions on partitioned columns. Replace `DATE(order_date)` with `order_date >= '2025-01-01T00:00:00'` to enable partition pruning and reduce query cost by an estimated 95%.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                 </div>
            </section>
            
            <section id="architecture-diagram" class="py-24 fade-in-section is-visible">
                 <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                     <div class="text-center mb-16">
                        <h2 class="text-3xl md:text-5xl font-black">Secure By Design</h2>
                        <p class="text-lg text-gray-400 max-w-3xl mx-auto mt-4">Our architecture prioritizes your data's security and integrity above all else.</p>
                    </div>
                    <div class="max-w-4xl mx-auto glass-effect rounded-2xl p-8">
                        <div class="grid md:grid-cols-5 gap-4 md:gap-8 items-center text-center">
                            <div class="md:col-span-2 flex flex-col items-center gap-4">
                                <i data-lucide="users" class="w-12 h-12 text-purple-300"></i>
                                <h3 class="font-bold text-lg">Business Teams</h3>
                                <p class="text-sm text-gray-400">Ask questions in Slack, Web App, etc.</p>
                            </div>
                            <div class="text-gray-500">
                                <i data-lucide="arrow-left-right" class="w-12 h-12 mx-auto"></i>
                                <p class="text-xs font-fira-code mt-2">Natural Language to SQL</p>
                            </div>
                            <div class="md:col-span-2 flex flex-col items-center gap-4 p-6 rounded-lg border-2 border-cyan-400 border-dashed">
                                <h3 class="font-bold text-lg text-cyan-300">Your Secure Cloud (VPC)</h3>
                                <div class="w-full space-y-4">
                                    <div class="flex items-center gap-3 bg-gray-800 p-3 rounded-md">
                                        <i data-lucide="database" class="w-6 h-6 text-cyan-400"></i>
                                        <span class="text-sm">Your Data Warehouse</span>
                                    </div>
                                    <div class="flex items-center gap-3 bg-gray-800 p-3 rounded-md">
                                        <i data-lucide="cpu" class="w-6 h-6 text-purple-400"></i>
                                        <span class="text-sm">BI MAGICS Agent (Read-Only)</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">Raw data is never moved or stored.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="faq-how" class="py-24 bg-gray-900/20 fade-in-section is-visible">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl">
                    <div class="text-center mb-16">
                        <h2 class="text-3xl md:text-5xl font-black font-tilt-neon mb-4">Technical & Security FAQs</h2>
                        <p class="text-lg text-gray-400 max-w-2xl mx-auto">Answering the important questions for data and engineering teams.</p>
                    </div>
                    <div class="space-y-4" x-data="{ open: 1 }">
                        <div class="glass-effect rounded-lg faq-item" :class="{'open': open === 1}">
                            <button @click="open = (open === 1 ? null : 1)" class="w-full flex justify-between items-center text-left text-xl font-semibold p-6">
                                <span>Can we deploy the agent in our own cloud environment?</span><i data-lucide="plus" class="faq-icon w-6 h-6 text-cyan-400"></i>
                            </button>
                            <div class="faq-answer"><p class="text-gray-300 leading-relaxed"><strong>Absolutely.</strong> For maximum security and control, our Agent can be deployed entirely within your own VPC. This means your data, including metadata, never leaves your secure cloud environment, ensuring compliance with the strictest data residency and privacy policies.</p></div>
                        </div>
                        <div class="glass-effect rounded-lg faq-item" :class="{'open': open === 2}">
                            <button @click="open = (open === 2 ? null : 2)" class="w-full flex justify-between items-center text-left text-xl font-semibold p-6">
                                <span>Are we locked into a specific LLM?</span><i data-lucide="plus" class="faq-icon w-6 h-6 text-cyan-400"></i>
                            </button>
                             <div class="faq-answer"><p class="text-gray-300 leading-relaxed"><strong>No. We are model-agnostic.</strong> Our platform is designed for flexibility. While we have optimized integrations with leading models like Google's Gemini and OpenAI's GPT series, you can connect to your preferred LLM. This includes private models hosted in your environment or any other commercial or open-source model you choose.</p></div>
                        </div>
                        <div class="glass-effect rounded-lg faq-item" :class="{'open': open === 3}">
                            <button @click="open = (open === 3 ? null : 3)" class="w-full flex justify-between items-center text-left text-xl font-semibold p-6">
                                <span>Do you store a copy of our raw data?</span><i data-lucide="plus" class="faq-icon w-6 h-6 text-cyan-400"></i>
                            </button>
                             <div class="faq-answer"><p class="text-gray-300 leading-relaxed"><strong>Never.</strong> We are a metadata-only platform. Our Agent analyzes schemas, column names, and query logs. When a user asks a question, we generate a real-time SQL query that runs directly in your warehouse. The results are streamed back to the user, not stored on our servers.</p></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="contact-tech" class="py-24">
                 <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center max-w-3xl">
                    <i data-lucide="binary" class="w-16 h-16 text-cyan-300 mx-auto mb-6"></i>
                    <h2 class="text-4xl font-black font-tilt-neon mb-4">Ready for a Technical Deep-Dive?</h2>
                    <p class="text-lg text-gray-300 mb-8">Have questions about our architecture, security protocols, or the Agent's capabilities? Our engineers are ready to talk.</p>
                    <a href="mailto:hello@bimagics.com?subject=Technical%20Deep-Dive%20Request" class="inline-block bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-4 px-10 rounded-full text-lg transition-all duration-300 transform hover:scale-105">
                        Schedule a Call with an Engineer
                    </a>
                </div>
            </section>
        </main>

        <footer class="bg-gray-900/50">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="text-center text-gray-500">
                    <p>&copy; <span id="year-footer"></span> BI MAGICS. All Spells Reserved.</p>
                    <p class="text-xs mt-2">Crafted with magic in Tel Aviv</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('agentDemo', () => ({
            state: 'idle',
            logs: [],
            visuals: [],
            wizardMessages: [],
            
            get scriptRunning() { return this.state === 'running' },
            get demoSubtitle() {
                switch(this.state) {
                    case 'idle': return 'Click the button below to simulate the agent connecting and starting its discovery process.';
                    case 'running': return 'The Agent is live-scanning the warehouse, building context and finding relationships...';
                    case 'finished': return 'Process complete! The Agent built the catalog, and WizBI is now ready to answer questions.';
                }
            },

            clearPrevious() {
                this.state = 'running';
                this.logs = [];
                this.visuals = [];
                this.wizardMessages = [];
                this.$nextTick(() => lucide.createIcons());
            },
            
            addLog(log, delay = 100) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        this.logs.push({ id: Date.now() + Math.random(), timestamp: new Date().toLocaleTimeString(), level: `[${log.level.padEnd(8)}]`, message: log.message, color: log.color });
                        this.$nextTick(() => { if (this.$refs.logContainer) this.$refs.logContainer.scrollTop = this.$refs.logContainer.scrollHeight; });
                        resolve();
                    }, delay);
                });
            },

            addVisual(id, html, delay = 100) {
                 return new Promise(resolve => {
                    setTimeout(() => {
                        const existingIndex = this.visuals.findIndex(v => v.id === id);
                        const newVisual = { id, html, visible: false };
                        if (existingIndex > -1) { this.visuals.splice(existingIndex, 1, newVisual); } 
                        else { this.visuals.push(newVisual); }
                        this.$nextTick(() => {
                            this.visuals.find(v => v.id === id).visible = true;
                            lucide.createIcons();
                            if(this.$refs.visualPanel) this.$refs.visualPanel.scrollTop = this.$refs.visualPanel.scrollHeight;
                            resolve();
                        });
                    }, delay);
                });
            },

            addWizardMessage(msg, delay = 100) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        const newMsg = { id: Date.now() + Math.random(), visible: false, ...msg };
                        this.wizardMessages.push(newMsg);
                        this.$nextTick(() => {
                           this.wizardMessages.find(m => m.id === newMsg.id).visible = true;
                           lucide.createIcons();
                           if(this.$refs.visualPanel) this.$refs.visualPanel.scrollTop = this.$refs.visualPanel.scrollHeight;
                           resolve();
                        });
                    }, delay);
                });
            },
            
            async runScript() {
                if (this.scriptRunning) return;
                this.clearPrevious();
                
                try {
                    await this.addLog({ level: 'INIT', message: 'Agent activated. Secure connection to `prod_data_warehouse` established.', color: 'text-cyan-400' }, 200);
                    await this.addLog({ level: 'SCAN', message: "Scanning schemas...", color: 'text-gray-400' }, 500);
                    await this.addVisual('schema', `<div class="p-3 bg-slate-800/50 border border-gray-700 rounded-lg"><h4 class="font-bold text-gray-400 font-fira-code">Schema: analytics</h4><div id="tables-container" class="mt-2 space-y-2"></div></div>`);
                    await this.addLog({ level: 'SCAN', message: "Found 3 schemas: `analytics`, `raw_data`, `staging`", color: 'text-gray-400' }, 500);
                    await this.addLog({ level: 'MAP', message: "Mapping `analytics` schema...", color: 'text-gray-400' }, 300);
                    
                    const tablesContainer = this.$refs.visualPanel.querySelector('#tables-container');
                    
                    await this.addLog({ level: 'DISCOVER', message: 'Found table: `dim_customers` (21 columns)', color: 'text-gray-400' }, 400);
                    tablesContainer.innerHTML += '<div id="table-customers" class="p-3 bg-slate-800 rounded-md transition-all duration-300"><div class="font-bold flex items-center gap-2"><i data-lucide="table-2"></i>dim_customers</div></div>';
                    lucide.createIcons();
                    
                    await this.addLog({ level: 'ANALYZE', message: 'Analyzing `dim_customers`...', color: 'text-gray-400' }, 800);
                    const customerTable = this.$refs.visualPanel.querySelector('#table-customers');
                    customerTable.innerHTML += `<div class="mt-3 pt-3 border-t border-gray-700 space-y-2 text-xs">
                        <p class="text-purple-300"><i data-lucide="brain-circuit" class="w-4 h-4 inline-block mr-1"></i><strong>AI Summary:</strong> Customer profiles, location, and status.</p>
                        <p><strong>Key Columns:</strong> <span class="inline-flex items-center gap-1"><i data-lucide="key-round" class="w-3 h-3 text-yellow-400"></i>id</span>, <span class="inline-flex items-center gap-1"><i data-lucide="mail" class="w-3 h-3"></i>email</span>, <span class="inline-flex items-center gap-1"><i data-lucide="calendar" class="w-3 h-3"></i>signup_date</span></p>
                        <p><strong>Tags:</strong> <span class="text-xs bg-blue-500/50 text-blue-300 px-2 py-0.5 rounded-full">Dimension</span> <span class="text-xs bg-red-500/50 text-red-300 px-2 py-0.5 rounded-full">PII Detected</span></p>
                    </div>`;
                    lucide.createIcons();

                    await this.addLog({ level: 'DISCOVER', message: 'Found table: `fact_orders` (15 columns)', color: 'text-gray-400' }, 500);
                    tablesContainer.innerHTML += '<div id="table-orders" class="p-3 bg-slate-800 rounded-md transition-all duration-300"><div class="font-bold flex items-center gap-2"><i data-lucide="table-2"></i>fact_orders</div></div>';
                    lucide.createIcons();
                    
                    await this.addLog({ level: 'ANALYZE', message: 'Analyzing `fact_orders`...', color: 'text-gray-400' }, 800);
                    const ordersTable = this.$refs.visualPanel.querySelector('#table-orders');
                     ordersTable.innerHTML += `<div class="mt-3 pt-3 border-t border-gray-700 space-y-2 text-xs">
                        <p class="text-purple-300"><i data-lucide="brain-circuit" class="w-4 h-4 inline-block mr-1"></i><strong>AI Summary:</strong> Core table for sales transactions and revenue analysis.</p>
                        <p><strong>Key Columns:</strong> <span class="inline-flex items-center gap-1"><i data-lucide="key-round" class="w-3 h-3 text-yellow-400"></i>order_id</span>, <span class="inline-flex items-center gap-1"><i data-lucide="dollar-sign" class="w-3 h-3"></i>amount</span>, <span class="inline-flex items-center gap-1"><i data-lucide="calendar" class="w-3 h-3"></i>order_date</span></p>
                        <p><strong>Tags:</strong> <span class="text-xs bg-green-500/50 text-green-300 px-2 py-0.5 rounded-full">Fact Table</span> <span class="text-xs bg-yellow-500/50 text-yellow-300 px-2 py-0.5 rounded-full">High Cardinality</span></p>
                    </div>`;
                    lucide.createIcons();
                    
                    await this.addLog({ level: 'METADATA', message: 'Analyzing relationships...', color: 'text-gray-400' }, 1000);
                    await this.addLog({ level: 'RELATION', message: 'Detected JOIN key: <span class="text-yellow-400">fact_orders.customer_id</span> -> <span class="text-yellow-400">dim_customers.id</span>', color: 'text-gray-400' }, 800);
                    await this.addVisual('lineage', `<div class="p-4 bg-slate-800/50 border border-gray-700 rounded-lg text-center"><h4 class="font-bold text-sm mb-3 text-cyan-300">Data Lineage</h4><svg viewBox="0 0 300 60" class="w-full h-auto"><defs><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#67e8f9"></path></marker></defs><g><rect x="10" y="15" width="100" height="30" rx="5" fill="#1e293b" stroke="#38bdf8"></rect><text x="60" y="35" font-size="10" fill="white" class="font-fira-code">dim_customers</text></g><g><rect x="190" y="15" width="100" height="30" rx="5" fill="#1e293b" stroke="#38bdf8"></rect><text x="240" y="35" font-size="10" fill="white" class="font-fira-code">fact_orders</text></g><path d="M 110 30 L 190 30" stroke="#67e8f9" stroke-width="1.5" marker-end="url(#arrow)" class="lineage-path"></path></svg></div>`, 500);

                    await this.addLog({ level: 'OPTIMIZE', message: 'Analyzing query history for performance...', color: 'text-gray-400' }, 1200);
                    await this.addLog({ level: 'RECOMMEND', message: 'High-cardinality join on `fact_orders` detected. Recommend creating pre-aggregated daily sales view.', color: 'text-yellow-400' }, 800);
                    
                    await this.addLog({ level: 'COMPLETE', message: 'Cataloging complete. <span class="text-purple-300">WizBI</span> is now enabled.', color: 'text-green-400' }, 1000);
                    
                    this.state = 'finished';
                    await this.runWizardHandoff();

                } catch(e) { console.error("Agent demo failed:", e); }
            },
            
            async runWizardHandoff() {
                await new Promise(r => setTimeout(r, 1500));
                await this.addWizardMessage({ author: 'user', text: 'Show me the top 5 products by revenue' }, 500);
                await new Promise(r => setTimeout(r, 1500));
                const chartHTML = `<div class="space-y-1 mt-2">${[{label: 'Quantum Widget', val: 100}, {label: 'Hyper-Module', val: 71}, {label: 'Omega Gear', val: 62}, {label: 'Nano-Connector', val: 42}, {label: 'Zeta Probe', val: 33}].map(p => `<div class="text-xs text-gray-300"><span class="font-bold w-28 inline-block">${p.label}:</span><span class="inline-block h-4 bg-gradient-to-r from-purple-500 to-cyan-500 rounded-sm wizbi-bar" style="width: ${p.val}px; transform: scaleX(0); transition-delay: ${Math.random()*200}ms;"></span></div>`).join('')}</div>`;
                await this.addWizardMessage({ author: 'wizbi', text: `<p>Of course. Here are the top 5 products by revenue from the newly cataloged data:</p>${chartHTML}` }, 500);
                this.$nextTick(() => { this.$refs.visualPanel.querySelectorAll('.wizbi-bar').forEach(bar => bar.style.transform = 'scaleX(1)'); });
            }
        }));
        
        Alpine.data('dataTeamTools', () => ({
            activeTab: 'catalog',
        }));
    });
    
    const App = {
        init() {
            this.setupMobileMenu(); 
            this.setupHeaderScroll(); 
            this.initThreeJSBackground(); 
            this.updateDynamicContent();
            this.setupIntersectionObserver();
        },
        updateDynamicContent() { 
            if (typeof lucide !== 'undefined') { lucide.createIcons(); }
            document.querySelector('#year-footer').textContent = new Date().getFullYear(); 
        },
        setupMobileMenu() {
            const btn = document.getElementById('mobile-menu-button'); 
            const menu = document.getElementById('mobile-menu');
            if(!btn || !menu) return;
            const toggleMenu = () => menu.classList.toggle('hidden');
            btn.addEventListener('click', toggleMenu);
            menu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                     if (!menu.classList.contains('hidden')) { toggleMenu(); }
                });
            });
        },
        setupHeaderScroll() { 
            const header = document.getElementById('header');
            if(!header) return;
            window.addEventListener('scroll', () => header.classList.toggle('header-scrolled', window.scrollY > 50), { passive: true }); 
        },
        setupIntersectionObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.fade-in-section').forEach(el => observer.observe(el));
        },
        initThreeJSBackground() {
            try {
                const canvas = document.getElementById('bg-canvas');
                if (!canvas) return;
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                camera.position.setZ(30);
                const starGeometry = new THREE.BufferGeometry();
                const starCount = 8000;
                const positions = new Float32Array(starCount * 3);
                for (let i = 0; i < starCount * 3; i++) { positions[i] = (Math.random() - 0.5) * 200; }
                starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                const starMaterial = new THREE.PointsMaterial({ color: 0xaaaaaa, size: 0.15, transparent: true, blending: THREE.AdditiveBlending });
                const stars = new THREE.Points(starGeometry, starMaterial);
                scene.add(stars);
                let mouseX = 0, mouseY = 0;
                document.addEventListener('mousemove', e => { mouseX = (e.clientX / window.innerWidth) * 2 - 1; mouseY = -(e.clientY / window.innerHeight) * 2 + 1; }, { passive: true });
                window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
                function animate() {
                    requestAnimationFrame(animate);
                    stars.rotation.y += 0.0001;
                    stars.rotation.x += 0.0001;
                    camera.position.x += (mouseX * 5 - camera.position.x) * 0.02;
                    camera.position.y += (mouseY * 5 - camera.position.y) * 0.02;
                    camera.lookAt(scene.position);
                    renderer.render(scene, camera);
                }
                animate();
            } catch (e) {
                console.error("Three.js failed to initialize:", e);
                document.body.style.backgroundColor = '#0a0a1a';
            }
        }
    };
    document.addEventListener('DOMContentLoaded', () => { App.init(); });
    </script>
</body>
</html>
