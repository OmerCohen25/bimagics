<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>砖拽 住拽</title>
    <style>
        /* --- 住转  --- */
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        canvas {
            background-color: #000;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        /* --- 住 砖拽 --- */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 10;
            padding: 20px;
            box-sizing: border-box;
        }

        .screen h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }

        .screen p {
            font-size: 1.2rem;
            max-width: 400px;
            line-height: 1.5;
            margin-bottom: 30px;
        }

        .button {
            padding: 15px 30px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #1a1a1a;
            background-color: #00ff88;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
        }

        .button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.6);
        }
        
        #gameOverScreen .button {
            margin-top: 15px;
        }

        #finalScore, #finalLevel {
            font-weight: bold;
            color: #00ff88;
        }

        .hidden {
            display: none;
        }

        /* --- 驻转专 住 --- */
        #soundToggle {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 2rem;
            cursor: pointer;
            z-index: 20;
            background: none;
            border: none;
            color: white;
            padding: 5px;
        }
    </style>
</head>
<body>

    <div id="startScreen" class="screen">
        <h1> 住拽 ' </h1>
        <p>
             转 砖   砖转专 转驻.
            专  驻注 拽专转  注爪!
        </p>
        <p><strong>砖:</strong> 拽转 爪注 ()  拽砖 爪 (砖).</p>
        <button id="startButton" class="button">转 砖拽</button>
    </div>

    <div id="gameOverScreen" class="screen hidden">
        <h1>砖拽 专!</h1>
        <p>拽 住驻: <span id="finalScore">0</span></p>
        <p>砖 住驻: <span id="finalLevel">1</span></p>
        <button id="restartButton" class="button">砖拽 砖</button>
        <button id="shareButton" class="button">砖转祝 转爪 </button>
    </div>

    <button id="soundToggle"></button>

    <canvas id="gameCanvas"></canvas>

    <script>
        // ===============================================
        //           转 砖转 拽注
        // ===============================================

        // 驻转  -DOM
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const shareButton = document.getElementById('shareButton');
        const finalScoreDisplay = document.getElementById('finalScore');
        const finalLevelDisplay = document.getElementById('finalLevel');
        const soundToggleButton = document.getElementById('soundToggle');

        // 专转 砖拽
        const TILE_SIZE = 20; //   "砖爪转" 专砖转
        let tileCountX, tileCountY; // 砖 转

        // 砖转 爪 砖拽
        let gameState = 'start'; // 'start', 'playing', 'gameOver'
        let score = 0;
        let level = 1;
        let isMuted = false;

        // 砖转 拽专转 砖拽
        let snake;
        let food;
        let gameLoopTimeout;
        let currentSpeed = 150; // 砖转  爪注, 专  砖砖拽 转拽

        // 砖转 砖 注
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        
        // ===============================================
        //               住 (Base64)
        // ===============================================

        // AudioContext 爪专转 住
        let audioContext;
        const sounds = {
            eat: 'data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=', // 爪 拽爪专 驻砖
            gameOver: 'data:audio/wav;base64,UklGRiwaAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YRIWAACAgICAAAAAgIA=' // 爪 专
        };

        // 驻拽爪  住
        async function playSound(soundName) {
            if (isMuted || !sounds[soundName]) return;
            try {
                if (!audioContext) {
                     // AudioContext 爪专 专拽 专 专拽爪 砖 砖转砖
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                const response = await fetch(sounds[soundName]);
                const arrayBuffer = await response.arrayBuffer();
                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                const source = audioContext.createBufferSource();
                source.buffer = audioBuffer;
                source.connect(audioContext.destination);
                source.start(0);
            } catch (e) {
                console.error("砖  住:", e);
            }
        }
        
        // ===============================================
        //             拽转 砖拽 (Classes)
        // ===============================================

        /**
         * 爪 转 砖. 专 注 转注,  爪专.
         */
        class Snake {
            constructor() {
                // 拽 转转 专 专砖转
                this.body = [{
                    x: Math.floor(tileCountX / 2),
                    y: Math.floor(tileCountY / 2)
                }];
                //  转注 转转
                this.direction = { x: 1, y: 0 }; // 
                this.nextDirection = { x: 1, y: 0 };
            }

            // 注 拽 砖
            move() {
                this.direction = this.nextDirection;
                const head = { x: this.body[0].x + this.direction.x, y: this.body[0].y + this.direction.y };
                this.body.unshift(head); // 住驻转 专砖 砖  转注
                
                //  砖  , 住专转  (爪专 砖转 转注)
                if (head.x === food.x && head.y === food.y) {
                    this.grow();
                } else {
                    this.body.pop();
                }
            }

            // 转 砖 (专 )
            grow() {
                score++;
                playSound('eat');
                food.spawn(this.body); // 爪专转  砖
                // 拽  注  注转 砖
                if (score % 5 === 0) {
                    level++;
                    // 专转 专转 (拽转  砖)
                    currentSpeed = Math.max(50, currentSpeed - 10);
                }
            }
            
            // 砖  砖
            changeDirection(x, y) {
                // 注 砖 驻  注 注爪
                if (this.direction.x === -x || this.direction.y === -y) {
                    return;
                }
                this.nextDirection = { x, y };
            }

            // 爪专 砖 注 拽住
            draw(ctx) {
                ctx.font = `${TILE_SIZE * 1.2}px Arial`;
                // 爪专 专砖
                ctx.fillText('', this.body[0].x * TILE_SIZE - TILE_SIZE*0.1, this.body[0].y * TILE_SIZE + TILE_SIZE*0.9);
                // 爪专 祝
                ctx.fillStyle = '#00dd00';
                for (let i = 1; i < this.body.length; i++) {
                    ctx.beginPath();
                    ctx.arc(
                        this.body[i].x * TILE_SIZE + TILE_SIZE / 2, 
                        this.body[i].y * TILE_SIZE + TILE_SIZE / 2,
                        TILE_SIZE / 2.5, 0, 2 * Math.PI
                    );
                    ctx.fill();
                }
            }
            
            // 拽转 转砖转
            checkCollision() {
                const head = this.body[0];
                // 转砖转 拽专转
                if (head.x < 0 || head.x >= tileCountX || head.y < 0 || head.y >= tileCountY) {
                    return true;
                }
                // 转砖转 注爪转
                for (let i = 1; i < this.body.length; i++) {
                    if (head.x === this.body[i].x && head.y === this.body[i].y) {
                        return true;
                    }
                }
                return false;
            }
        }
        
        /**
         * 爪 转 . 专 注 拽 拽专 爪专.
         */
        class Food {
            constructor() {
                this.spawn([]);
            }

            // 爪专转  拽 砖, 砖 注 祝 砖
            spawn(snakeBody) {
                let validPosition = false;
                while (!validPosition) {
                    this.x = Math.floor(Math.random() * tileCountX);
                    this.y = Math.floor(Math.random() * tileCountY);
                    
                    // 拽 砖拽 砖  爪 注 砖
                    validPosition = !snakeBody.some(segment => segment.x === this.x && segment.y === this.y);
                }
            }

            // 爪专  注 拽住
            draw(ctx) {
                ctx.font = `${TILE_SIZE}px Arial`;
                ctx.fillText('', this.x * TILE_SIZE, this.y * TILE_SIZE + TILE_SIZE);
            }
        }
        
        // ===============================================
        //             驻拽爪转  砖 砖拽
        // ===============================================

        // 驻拽爪 转  驻住 砖拽
        function initGame() {
            // 转转  拽住 住
            const size = Math.min(window.innerWidth, window.innerHeight) * 0.9;
            canvas.width = Math.floor(size / TILE_SIZE) * TILE_SIZE;
            canvas.height = canvas.width;

            tileCountX = canvas.width / TILE_SIZE;
            tileCountY = canvas.height / TILE_SIZE;

            // 驻住 砖转 砖拽
            score = 0;
            level = 1;
            currentSpeed = 150;
            snake = new Snake();
            food = new Food();
            food.spawn(snake.body); // 拽 专砖 
        }

        // 转 砖拽 专砖转
        function gameLoop() {
            if (gameState !== 'playing') return;

            // 注 爪 砖拽
            snake.move();
            
            // 拽转 转砖转
            if (snake.checkCollision()) {
                endGame();
                return;
            }

            // 爪专 砖 砖  
            drawGame();
            
            // 拽专 专转  专转 转
            clearTimeout(gameLoopTimeout);
            gameLoopTimeout = setTimeout(gameLoop, currentSpeed);
        }

        // 驻拽爪 爪专  专 砖拽
        function drawGame() {
            // 拽 拽住
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 爪专 专砖转 (驻爪, 注爪)
            ctx.strokeStyle = '#333';
            for (let i = 0; i < tileCountX; i++) {
                ctx.beginPath();
                ctx.moveTo(i * TILE_SIZE, 0);
                ctx.lineTo(i * TILE_SIZE, canvas.height);
                ctx.stroke();
            }
             for (let i = 0; i < tileCountY; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * TILE_SIZE);
                ctx.lineTo(canvas.width, i * TILE_SIZE);
                ctx.stroke();
            }

            // 爪专 砖 
            snake.draw(ctx);
            food.draw(ctx);

            // 爪专 转爪 注转 (HUD)
            drawHUD();
        }

        // 驻拽爪 爪专 -HUD (拽, 砖)
        function drawHUD() {
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`拽: ${score}`, 10, 25);
            ctx.textAlign = 'right';
            ctx.fillText(`砖: ${level}`, canvas.width - 10, 25);
            ctx.textAlign = 'center';
        }

        // 驻拽爪 转转 砖拽
        function startGame() {
            gameState = 'playing';
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            initGame();
            gameLoop();
        }

        // 驻拽爪 住 砖拽
        function endGame() {
            playSound('gameOver');
            gameState = 'gameOver';
            clearTimeout(gameLoopTimeout);
            
            // 爪转 住 住 注 转
            finalScoreDisplay.textContent = score;
            finalLevelDisplay.textContent = level;
            gameOverScreen.classList.remove('hidden');
        }

        // ===============================================
        //              拽专转 砖拽 (Events)
        // ===============================================

        //  专注 拽转
        function handleKeyDown(e) {
            if (gameState !== 'playing') return;
            switch (e.key) {
                case 'ArrowUp': case 'w': snake.changeDirection(0, -1); break;
                case 'ArrowDown': case 's': snake.changeDirection(0, 1); break;
                case 'ArrowLeft': case 'a': snake.changeDirection(-1, 0); break;
                case 'ArrowRight': case 'd': snake.changeDirection(1, 0); break;
            }
        }
        
        //  专注 注 ()
        function handleTouchStart(e) {
            e.preventDefault();
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        }
        
        //   拽 (swipe)
        function handleSwipe() {
             if (gameState !== 'playing') return;
            const dx = touchEndX - touchStartX;
            const dy = touchEndY - touchStartY;
            const absDx = Math.abs(dx);
            const absDy = Math.abs(dy);

            if (Math.max(absDx, absDy) > 30) { // 转注 转 砖 拽
                if (absDx > absDy) {
                    // 拽 驻拽转
                    if (dx > 0) snake.changeDirection(1, 0); // 
                    else snake.changeDirection(-1, 0); // 砖
                } else {
                    // 拽 转
                    if (dy > 0) snake.changeDirection(0, 1); // 
                    else snake.changeDirection(0, -1); // 注
                }
            }
        }

        // 驻拽爪转 砖转祝
        async function shareScore() {
            const gameName = "住拽 '";
            const shareText = `砖转 拽 ${score} 砖 ${level} ${gameName}! 住 爪 转:`;
            const shareUrl = "https://bimagics.com/games/chicken.html"; // 转转 驻 砖专

            if (navigator.share) {
                // 砖砖 -Web Share API ()
                try {
                    await navigator.share({
                        title: gameName,
                        text: shareText,
                        url: shareUrl,
                    });
                } catch (err) {
                    console.error('砖 砖转祝:', err);
                }
            } else {
                // 驻 (Fallback) 住拽驻 - 注转拽 
                try {
                    await navigator.clipboard.writeText(`${shareText}\n${shareUrl}`);
                    alert('转爪 拽砖专 注转拽 ! 砖转驻 注 专.');
                } catch (err) {
                    console.error('砖 注转拽 :', err);
                    alert(' 转  注转拽 转 转爪.');
                }
            }
        }
        
        // 专 驻拽爪转 驻转专 专注
        window.addEventListener('keydown', handleKeyDown);
        canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
        canvas.addEventListener('touchend', handleTouchEnd, { passive: false });
        
        startButton.addEventListener('click', () => {
             // 爪专转 AudioContext 驻注 专砖 砖砖转砖 抓 注 砖
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            startGame();
        });
        
        restartButton.addEventListener('click', startGame);
        shareButton.addEventListener('click', shareScore);

        soundToggleButton.addEventListener('click', () => {
            isMuted = !isMuted;
            soundToggleButton.textContent = isMuted ? '' : '';
        });
        
        // 转转  拽住 砖  
        window.addEventListener('resize', () => {
            if (gameState !== 'playing') {
                initGame();
                // 爪专 专砖 砖 住 驻转 注 拽住 转
                ctx.fillStyle = '#111';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        });
        
        // 转 专砖
        initGame();

    </script>
</body>
</html>
