<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunlytics - לוח בקרה</title>
    <!-- טעינת Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- טעינת פונטים (Assistant ו-Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Assistant:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        /* הגדרת פונט Assistant כברירת מחדל */
        body {
            font-family: 'Assistant', 'Inter', sans-serif;
        }
        
        /* עיצוב כפתור ניווט פעיל (מהדוגמה) */
        .nav-button.active {
            background-color: #2563eb; /* bg-blue-600 */
            color: #ffffff; /* text-white */
            font-weight: 700; /* font-bold */
        }
        
        /* עיצוב כפתור ניווט לא פעיל (מהדוגמה) */
        .nav-button {
            font-weight: 600; /* font-semibold */
            color: #4b5563; /* text-gray-600 */
        }
        .nav-button:hover {
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #1d4ed8; /* hover:text-blue-700 */
        }
        
        /* פונטים בגדלים שונים (מהדוגמה) */
        .stat-value {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #2563eb; /* text-blue-600 */
        }
        .stat-label {
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            color: #6b7280; /* text-gray-500 */
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }

        /* צל עדין (מהדוגמה) */
        .rtl-shadow {
             box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="flex h-screen">
        <!-- תפריט צד (ימין) - מעוצב מחדש -->
        <nav class="w-72 bg-white text-gray-800 h-full overflow-y-auto rtl-shadow z-10">
            <div class="p-6">
                <!-- לוגו (מהדוגמה) -->
                <a href="#" class="mb-8 block">
                    <img src="https://sunlytics.co.il/logo.png" alt="Sunlytics לוגו" class="h-10"
                         onerror="this.onerror=null; this.src='https://placehold.co/150x40/ffffff/333333?text=Sunlytics';">
                </a>
                
                <h2 class="text-xl font-bold text-gray-900 mb-6">אתרים סולאריים</h2>
                <ul id="site-list" class="space-y-2">
                    <!-- רשימת האתרים תטען כאן על ידי JavaScript -->
                </ul>
            </div>
        </nav>

        <!-- אזור תוכן מרכזי (שמאל) -->
        <main id="content-area" class="flex-1 h-full overflow-y-auto p-8">
            <!-- התוכן של האתר הנבחר יוצג כאן -->
            <h1 class="text-4xl font-bold text-gray-800">בחר אתר מהתפריט</h1>
            <p class="text-gray-600 mt-2 text-lg">אנא בחר אתר מהרשימה בצד ימין כדי לראות את הנתונים שלו.</p>
        </main>
    </div>

    <script>
        // --- מאגר הנתונים המלא ---
        // (זהה לקודם, לא שונה)
        const siteData = [
            {
                // אתר 1: רונן סגרון 38 - מערכת מספר 1
                details: { "details": { "id": 3347266, "name": "*** רונן סיגרון מזרח", "accountId": 117998, "status": "Active", "peakPower": 299.75, "lastUpdateTime": "2025-11-13", "installationDate": "2022-12-22", "ptoDate": null, "notes": "", "type": "Optimizers & Inverters", "location": { "country": "Israel", "city": "Nofekh", "address": "ברכיה", "address2": "", "zip": "1111111", "timeZone": "Asia/Jerusalem", "countryCode": "IL", "latitude": "31.6703539", "longitude": "34.6281842" }, "primaryModule": { "manufacturerName": "JinkoSolar Holding Co. Ltd.", "modelName": "JKM-545M-72HL4-TV Tiger Pro 72HC-TV", "maximumPower": 545.0, "temperatureCoef": -0.35 }, "alertQuantity": 1, "highestImpact": "2", "uris": { "DETAILS": "/site/3347266/details", "DATA_PERIOD": "/site/3347266/dataPeriod", "OVERVIEW": "/site/3347266/overview" }, "publicSettings": { "isPublic": null } } },
                dataPeriod: { "dataPeriod": { "startDate": "2023-09-20", "endDate": "2025-11-13" } },
                overview: { "overview": { "lastUpdateTime": "2025-11-13 11:55:26", "lifeTimeData": { "energy": 1030526340.0, "revenue": 0.0 }, "lastYearData": { "energy": 448231616.0 }, "lastMonthData": { "energy": 12704835.0 }, "lastDayData": { "energy": 482315.0 }, "currentPower": { "power": 65872.2 }, "measuredBy": "" } },
                energy_last_7_days: { "energy": { "timeUnit": "DAY", "unit": "Wh", "values": { "sample": [ { "date": "2025-11-06 00:00:00", "value": 964878.0 }, { "date": "2025-11-07 00:00:00", "value": 1037531.0 }, { "date": "2025-11-08 00:00:00", "value": 953271.0 }, { "date": "2025-11-09 00:00:00", "value": 966217.0 }, { "date": "2025-11-10 00:00:00", "value": 946480.0 }, { "date": "2025-11-11 00:00:00", "value": 917030.0 }, { "date": "2025-11-12 00:00:00", "value": 851944.0 } ] } } },
                power_last_24h: { "power": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "values": { "sample": [ { "date": "2025-11-12 09:45:00", "value": 156250.42 }, { "date": "2025-11-12 10:00:00", "value": 164262.5 }, { "date": "2025-11-12 10:15:00", "value": 138657.0 }, { "date": "2025-11-12 10:30:00", "value": 168768.14 }, { "date": "2025-11-12 10:45:00", "value": 165933.78 } ] } } },
                powerDetails_sample: { "powerDetails": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "meters": [ { "type": "Purchased", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "FeedIn", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Consumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "SelfConsumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Production", "values": { "sample": [ { "date": "2025-11-13 07:45:00", "value": 48253.824 }, { "date": "2025-11-13 08:00:00", "value": 64888.39 }, { "date": "2025-11-13 08:15:00", "value": 60847.6 }, { "date": "2025-11-13 08:30:00", "value": 38339.664 }, { "date": "2025-11-13 08:45:00", "value": 73591.56 } ] } } ] } },
                meters_sample: { "meterEnergyDetails": { "timeUnit": "DAY", "unit": "Wh", "meters": [] } },
                inventory: { "Inventory": { "inverters": [ { "name": "Inverter 2", "manufacturer": "SolarEdge", "model": "SE100K-IL00IBNQ4", "communicationMethod": "RS485", "cpuVersion": "4.19.521", "connectedOptimizers": 143, "partNumber": "SE100K-IL00IBNQ4", "SN": "7E04FF4F-D0" }, { "name": "Inverter 1", "manufacturer": "SolarEdge", "model": "SE100K-IL00IBNQ4", "communicationMethod": "ETHERNET", "cpuVersion": "4.19.521", "connectedOptimizers": 136, "partNumber": "SE100K-IL00IBNQ4", "SN": "7E04FF11-92" } ], "batteries": [], "gateways": [], "sensors": [], "meters": [] } },
                sensors_list: { "SiteSensors": { "total": 0, "list": [] } },
                sensors_data_error: "HTTP 400 for https://monitoringapi.solaredge.com/site/3347266/sensors params={'startTime': '2025-11-12 09:55:32', 'endTime': '2025-11-13 09:55:32'}. Body: <!doctype html><html lang=\"en\"><head><title>HTTP Status 400 – Bad Request</title><style type=\"text/css\">h1 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;} h2 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;} h3 {font"
            },
            {
                // אתר 2: רונן סגרון 38 - מערכת מספר 2
                details: { "details": { "id": 3347195, "name": "*** רונן סיגרון מערב", "accountId": 117998, "status": "Active", "peakPower": 299.75, "lastUpdateTime": "2025-11-13", "installationDate": "2022-12-22", "ptoDate": null, "notes": "", "type": "Optimizers & Inverters", "location": { "country": "Israel", "city": "ברכיה", "address": "ברכיה", "address2": "", "zip": "1111111", "timeZone": "Asia/Jerusalem", "countryCode": "IL", "latitude": "31.6705508", "longitude": "34.6281513" }, "primaryModule": { "manufacturerName": "JinkoSolar Holding Co. Ltd.", "modelName": "JKM-545M-72HL4-TV Tiger Pro 72HC-TV", "maximumPower": 545.0, "temperatureCoef": -0.35 }, "alertQuantity": 2, "highestImpact": "2", "uris": { "DETAILS": "/site/3347195/details", "DATA_PERIOD": "/site/3347195/dataPeriod", "OVERVIEW": "/site/3347195/overview" }, "publicSettings": { "isPublic": null } } },
                dataPeriod: { "dataPeriod": { "startDate": "2023-09-20", "endDate": "2025-11-13" } },
                overview: { "overview": { "lastUpdateTime": "2025-11-13 11:55:17", "lifeTimeData": { "energy": 1030077120.0, "revenue": 0.0 }, "lastYearData": { "energy": 448822912.0 }, "lastMonthData": { "energy": 13131061.0 }, "lastDayData": { "energy": 483330.0 }, "currentPower": { "power": 92808.7 }, "measuredBy": "" } },
                energy_last_7_days: { "energy": { "timeUnit": "DAY", "unit": "Wh", "values": { "sample": [ { "date": "2025-11-06 00:00:00", "value": 969780.0 }, { "date": "2025-11-07 00:00:00", "value": 1042358.0 }, { "date": "2025-11-08 00:00:00", "value": 1115692.0 }, { "date": "2025-11-09 00:00:00", "value": 1095914.0 }, { "date": "2025-11-10 00:00:00", "value": 1088209.0 }, { "date": "2025-11-11 00:00:00", "value": 1056557.0 }, { "date": "2025-11-12 00:00:00", "value": 997970.0 } ] } } },
                power_last_24h: { "power": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "values": { "sample": [ { "date": "2025-11-12 09:45:00", "value": 160507.16 }, { "date": "2025-11-12 10:00:00", "value": 144996.44 }, { "date": "2025-11-12 10:15:00", "value": 152615.81 }, { "date": "2025-11-12 10:30:00", "value": 153372.25 }, { "date": "2025-11-12 10:45:00", "value": 165121.1 } ] } } },
                powerDetails_sample: { "powerDetails": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "meters": [ { "type": "FeedIn", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Purchased", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Consumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Production", "values": { "sample": [ { "date": "2025-11-13 07:45:00", "value": 46948.266 }, { "date": "2025-11-13 08:00:00", "value": 77663.945 }, { "date": "2025-11-13 08:15:00", "value": 47361.99 }, { "date": "2025-11-13 08:30:00", "value": 50466.633 }, { "date": "2025-11-13 08:45:00", "value": 95484.4 } ] } }, { "type": "SelfConsumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } } ] } },
                meters_sample: { "meterEnergyDetails": { "timeUnit": "DAY", "unit": "Wh", "meters": [] } },
                inventory: { "Inventory": { "inverters": [ { "name": "Inverter 1", "manufacturer": "SolarEdge", "model": "SE100K-RW00IBNQ4", "communicationMethod": "WIFI", "cpuVersion": "4.23.529", "connectedOptimizers": 140, "partNumber": "SE100K-RW00IBNQ4", "SN": "7E05DD63-C3" }, { "name": "Inverter 2", "manufacturer": "SolarEdge", "model": "SE100K-IL00IBNQ4", "communicationMethod": "WIFI", "cpuVersion": "4.19.521", "connectedOptimizers": 140, "partNumber": "SE100K-IL00IBNQ4", "SN": "7E04FF7D-FE" } ], "batteries": [], "gateways": [], "sensors": [], "meters": [] } },
                sensors_list: { "SiteSensors": { "total": 0, "list": [] } },
                sensors_data_error: "HTTP 400 for https://monitoringapi.solaredge.com/site/3347195/sensors params={'startTime': '2025-11-12 09:55:39', 'endTime': '2025-11-13 09:55:39'}. Body: <!doctype html><html lang=\"en\"><head><title>HTTP Status 400 – Bad Request</title><style type=\"text/css\">h1 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;} h2 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;} h3 {font"
            },
            {
                // אתר 3: איציק ברבי - משק 23
                details: { "details": { "id": 2617088, "name": "איציק ברבי", "accountId": 101684, "status": "Active", "peakPower": 219.1, "lastUpdateTime": "2025-11-13", "installationDate": "2021-12-10", "ptoDate": null, "notes": "Name of Previous Owner/Admin: איציק ברבי\nSite Name: איציק ברבי\nSite Id: 2617088\nSerial Datecode:\nSerial Hex: 7E04A6F1\nSerial Checksum:\nNew Owner / Admin Name: nir shni\nCountry: IL\nStates Free:\nStates: 0\nCity: כפר יחזקאל\nZip: 1892500\nEmail: Niko86@walla.co", "type": "Optimizers & Inverters", "location": { "country": "Israel", "city": "Berekhya", "address": "23", "address2": "", "zip": "123456", "timeZone": "Asia/Jerusalem", "countryCode": "IL", "latitude": "31.6755013", "longitude": "34.633264" }, "primaryModule": { "manufacturerName": "JA solar", "modelName": "JAM72S20 MR 460", "maximumPower": 0.0, "temperatureCoef": 0.0 }, "alertQuantity": 0, "highestImpact": "0", "uris": { "DETAILS": "/site/2617088/details", "DATA_PERIOD": "/site/2617088/dataPeriod", "OVERVIEW": "/site/2617088/overview" }, "publicSettings": { "isPublic": null } } },
                dataPeriod: { "dataPeriod": { "startDate": "2021-12-10", "endDate": "2025-11-13" } },
                overview: { "overview": { "lastUpdateTime": "2025-11-13 11:55:46", "lifeTimeData": { "energy": 1789051900.0, "revenue": 0.0 }, "lastYearData": { "energy": 395690944.0 }, "lastMonthData": { "energy": 9856730.0 }, "lastDayData": { "energy": 389752.0 }, "currentPower": { "power": 136841.6 }, "measuredBy": "" } },
                energy_last_7_days: { "energy": { "timeUnit": "DAY", "unit": "Wh", "values": { "sample": [ { "date": "2025-11-06 00:00:00", "value": 747920.0 }, { "date": "2025-11-07 00:00:00", "value": 716217.0 }, { "date": "2025-11-08 00:00:00", "value": 827810.0 }, { "date": "2025-11-09 00:00:00", "value": 828292.0 }, { "date": "2025-11-10 00:00:00", "value": 815418.0 }, { "date": "2025-11-11 00:00:00", "value": 789173.0 }, { "date": "2025-11-12 00:00:00", "value": 737035.0 } ] } } },
                power_last_24h: { "power": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "values": { "sample": [ { "date": "2025-11-12 09:45:00", "value": 119066.69 }, { "date": "2025-11-12 10:00:00", "value": 116025.19 }, { "date": "2025-11-12 10:15:00", "value": 99692.586 }, { "date": "2025-11-12 10:30:00", "value": 125031.125 }, { "date": "2025-11-12 10:45:00", "value": 128889.23 } ] } } },
                powerDetails_sample: { "powerDetails": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "meters": [ { "type": "FeedIn", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Purchased", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Consumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Production", "values": { "sample": [ { "date": "2025-11-13 07:45:00", "value": 34445.363 }, { "date": "2025-11-13 08:00:00", "value": 50070.957 }, { "date": "2025-11-13 08:15:00", "value": 40749.707 }, { "date": "2025-11-13 08:30:00", "value": 35215.246 }, { "date": "2025-11-13 08:45:00", "value": 54776.28 } ] } }, { "type": "SelfConsumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } } ] } },
                meters_sample: { "meterEnergyDetails": { "timeUnit": "DAY", "unit": "Wh", "meters": [] } },
                inventory: { "Inventory": { "inverters": [ { "name": "Inverter 5", "manufacturer": "SolarEdge", "model": "SE50K-IL00IBPQ4", "communicationMethod": "RS485", "cpuVersion": "4.23.529", "connectedOptimizers": 78, "partNumber": "SE50K-IL00IBPQ4", "SN": "7E0514C6-5D" }, { "name": "Inverter 2", "manufacturer": "SolarEdge", "model": "SE33.3K-IL00IBNN4", "communicationMethod": "GSM", "dsp1Version": "1.20.23120", "dsp2Version": "2.20.23034", "cpuVersion": "4.23.529", "connectedOptimizers": 54, "partNumber": "SE33.3K-IL00IBNN4", "SN": "7E0D3B9E-64" }, { "name": "Inverter 3", "manufacturer": "SolarEdge", "model": "SE50K-IL00IBNQ4", "communicationMethod": "ETHERNET", "cpuVersion": "4.23.529", "connectedOptimizers": 78, "partNumber": "SE50K-IL00IBNQ4", "SN": "7E04A6F1-19" }, { "name": "Inverter 1", "manufacturer": "SolarEdge", "model": "SE33.3K-IL00IBNN4", "communicationMethod": "RS485", "dsp1Version": "1.20.23120", "dsp2Version": "2.20.23034", "cpuVersion": "4.23.529", "connectedOptimizers": 51, "partNumber": "SE33.3K-IL00IBNN4", "SN": "7E0D3B7C-42" }, { "name": "Inverter 4", "manufacturer": "SolarEdge", "model": "SE33.3K-RW00IBNM4", "communicationMethod": "RS485", "dsp1Version": "1.20.23120", "dsp2Version": "2.20.23034", "cpuVersion": "4.23.529", "connectedOptimizers": 52, "partNumber": "SE33.3K-RW00IBNM4", "SN": "7B0EC071-BA" } ], "batteries": [], "gateways": [], "sensors": [], "meters": [] } },
                sensors_list: { "SiteSensors": { "total": 0, "list": [] } },
                sensors_data_error: "HTTP 400 for https://monitoringapi.solaredge.com/site/2617088/sensors params={'startTime': '2025-11-12 09:55:45', 'endTime': '2025-11-13 09:55:45'}. Body: <!doctype html><html lang=\"en\"><head><title>HTTP Status 400 – Bad Request</title><style type=\"text/css\">h1 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;} h2 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;} h3 {font"
            },
            {
                // אתר 4: אבישי לוי1
                details: { "details": { "id": 1834583, "name": "אבישי לוי", "accountId": 54175, "status": "Active", "peakPower": 20.2, "lastUpdateTime": "2025-11-13", "installationDate": "2020-10-01", "ptoDate": null, "notes": "", "type": "Optimizers & Inverters", "location": { "country": "Israel", "city": "ברכיה", "address": "ברכיה", "address2": "", "zip": "12345", "timeZone": "Asia/Jerusalem", "countryCode": "IL", "latitude": "31.668047", "longitude": "34.624296" }, "primaryModule": { "manufacturerName": "Hanwha Q.Cells GmbH", "modelName": "Q.PEAK DUO L-G5.2 430", "maximumPower": 0.0, "temperatureCoef": 0.0 }, "alertQuantity": 0, "highestImpact": "0", "uris": { "DETAILS": "/site/1834583/details", "DATA_PERIOD": "/site/1834583/dataPeriod", "OVERVIEW": "/site/1834583/overview" }, "publicSettings": { "isPublic": null } } },
                dataPeriod: { "dataPeriod": { "startDate": "2020-10-01", "endDate": "2025-11-13" } },
                overview: { "overview": { "lastUpdateTime": "2025-11-13 11:55:45", "lifeTimeData": { "energy": 160666848.0, "revenue": 0.0 }, "lastYearData": { "energy": 29023400.0 }, "lastMonthData": { "energy": 732816.0 }, "lastDayData": { "energy": 25703.0 }, "currentPower": { "power": 4045.0 }, "measuredBy": "" } },
                energy_last_7_days: { "energy": { "timeUnit": "DAY", "unit": "Wh", "values": { "sample": [ { "date": "2025-11-06 00:00:00", "value": 54224.0 }, { "date": "2025-11-07 00:00:00", "value": 56613.0 }, { "date": "2025-11-08 00:00:00", "value": 60716.0 }, { "date": "2025-11-09 00:00:00", "value": 61263.0 }, { "date": "2025-11-10 00:00:00", "value": 59634.0 }, { "date": "2025-11-11 00:00:00", "value": 57805.0 }, { "date": "2025-11-12 00:00:00", "value": 52627.0 } ] } } },
                power_last_24h: { "power": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "values": { "sample": [ { "date": "2025-11-12 09:45:00", "value": 8695.0 }, { "date": "2025-11-12 10:00:00", "value": 9206.333 }, { "date": "2025-11-12 10:15:00", "value": 9073.0 }, { "date": "2025-11-12 10:30:00", "value": 9164.0 }, { "date": "2025-11-12 10:45:00", "value": 9478.667 } ] } } },
                powerDetails_sample: { "powerDetails": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "meters": [ { "type": "Purchased", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Consumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "FeedIn", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Production", "values": { "sample": [ { "date": "2025-11-13 07:45:00", "value": 2347.3333 }, { "date": "2025-11-13 08:00:00", "value": 3555.3333 }, { "date": "2025-11-13 08:15:00", "value": 2796.6667 }, { "date": "2025-11-13 08:30:00", "value": 2906.3333 }, { "date": "2025-11-13 08:45:00", "value": 5221.3335 } ] } }, { "type": "SelfConsumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } } ] } },
                meters_sample: { "meterEnergyDetails": { "timeUnit": "DAY", "unit": "Wh", "meters": [] } },
                inventory: { "Inventory": { "inverters": [ { "name": "Inverter 1", "manufacturer": "SolarEdge", "model": "SE15K-IL0T0BNN4", "communicationMethod": "ETHERNET", "dsp1Version": "1.13.2016", "dsp2Version": "2.19.1601", "cpuVersion": "4.16.25", "connectedOptimizers": 47, "partNumber": "SE15K-IL0T0BNN4", "SN": "7E0923D2-7C" } ], "batteries": [], "gateways": [], "sensors": [], "meters": [] } },
                sensors_list: { "SiteSensors": { "total": 0, "list": [] } },
                sensors_data_error: "HTTP 400 for https://monitoringapi.solaredge.com/site/1834583/sensors params={'startTime': '2025-11-12 09:55:52', 'endTime': '2025-11-13 09:55:52'}. Body: <!doctype html><html lang=\"en\"><head><title>HTTP Status 400 – Bad Request</title><style type=\"text/css\">h1 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;} h2 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;} h3 {font"
            },
            {
                // אתר 5: home
                details: { "details": { "id": 4542929, "name": "רזאל מגוס", "accountId": 288784, "status": "Active", "peakPower": 9.8, "lastUpdateTime": "2025-11-13", "installationDate": "2025-02-12", "ptoDate": null, "notes": "", "type": "Optimizers & Inverters", "location": { "country": "Israel", "city": "Ofakim", "address": "Fikus Street, 18", "address2": "", "zip": "1107", "timeZone": "Asia/Jerusalem", "countryCode": "IL", "latitude": "31.30560483255414", "longitude": "34.61456649005413" }, "primaryModule": { "manufacturerName": "610", "modelName": "unkowm", "maximumPower": 0.0, "temperatureCoef": 0.0 }, "alertQuantity": 0, "highestImpact": "0", "uris": { "DETAILS": "/site/4542929/details", "DATA_PERIOD": "/site/4542929/dataPeriod", "OVERVIEW": "/site/4542929/overview" }, "publicSettings": { "isPublic": null } } },
                dataPeriod: { "dataPeriod": { "startDate": "2025-02-12", "endDate": "2025-11-13" } },
                overview: { "overview": { "lastUpdateTime": "2025-11-13 11:54:18", "lifeTimeData": { "energy": 21392018.0, "revenue": 0.0 }, "lastYearData": { "energy": 21394336.0 }, "lastMonthData": { "energy": 650136.0 }, "lastDayData": { "energy": 24968.0 }, "currentPower": { "power": 3787.0 }, "measuredBy": "" } },
                energy_last_7_days: { "energy": { "timeUnit": "DAY", "unit": "Wh", "values": { "sample": [ { "date": "2025-11-06 00:00:00", "value": 49052.0 }, { "date": "2025-11-07 00:00:00", "value": 49980.0 }, { "date": "2025-11-08 00:00:00", "value": 54851.0 }, { "date": "2025-11-09 00:00:00", "value": 51578.0 }, { "date": "2025-11-10 00:00:00", "value": 52927.0 }, { "date": "2025-11-11 00:00:00", "value": 50820.0 }, { "date": "2025-11-12 00:00:00", "value": 46524.0 } ] } } },
                power_last_24h: { "power": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "values": { "sample": [ { "date": "2025-11-12 09:45:00", "value": 7098.0 }, { "date": "2025-11-12 10:00:00", "value": 7431.6665 }, { "date": "2025-11-12 10:15:00", "value": 7798.0 }, { "date": "2025-11-12 10:30:00", "value": 7917.3335 }, { "date": "2025-11-12 10:45:00", "value": 8142.3335 } ] } } },
                powerDetails_sample: { "powerDetails": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "meters": [ { "type": "Consumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Purchased", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "FeedIn", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Production", "values": { "sample": [ { "date": "2025-11-13 07:45:00", "value": 3105.6667 }, { "date": "2025-11-13 08:00:00", "value": 2971.3333 }, { "date": "2025-11-13 08:15:00", "value": 4193.0 }, { "date": "2025-11-13 08:30:00", "value": 3565.0 }, { "date": "2025-11-13 08:45:00", "value": 4114.6665 } ] } }, { "type": "SelfConsumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } } ] } },
                meters_sample: { "meterEnergyDetails": { "timeUnit": "DAY", "unit": "Wh", "meters": [] } },
                inventory: { "Inventory": { "inverters": [ { "name": "Inverter 1", "manufacturer": "SolarEdge", "model": "SE17K-IL0T0BNN4", "communicationMethod": "ETHERNET", "dsp1Version": "1.13.2405", "dsp2Version": "2.19.2001", "cpuVersion": "4.22.518", "connectedOptimizers": 28, "partNumber": "SE17K-IL0T0BNN4", "SN": "7B12266D-20" } ], "batteries": [], "gateways": [], "sensors": [], "meters": [] } },
                sensors_list: { "SiteSensors": { "total": 0, "list": [] } },
                sensors_data_error: "HTTP 400 for https://monitoringapi.solaredge.com/site/4542929/sensors params={'startTime': '2025-11-12 09:55:59', 'endTime': '2025-11-13 09:55:59'}. Body: <!doctype html><html lang=\"en\"><head><title>HTTP Status 400 – Bad Request</title><style type=\"text/css\">h1 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;} h2 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;} h3 {font"
            },
            {
                // אתר 6: רונן סגרון מערכת קטנה
                details: { "details": { "id": 254108, "name": "*** solar check - רונן סיגרון - ברכיה", "accountId": 117998, "status": "Active", "peakPower": 47.88, "lastUpdateTime": "2025-11-13", "installationDate": "2016-05-16", "ptoDate": null, "notes": "", "type": "Optimizers & Inverters", "location": { "country": "Israel", "city": "Berekhya", "address": "berekhya", "address2": "", "zip": "79852", "timeZone": "Asia/Jerusalem", "countryCode": "IL", "latitude": "31.668047", "longitude": "34.624296" }, "primaryModule": { "manufacturerName": "JA solar", "modelName": "JAP6 72-315/3BB", "maximumPower": 0.0, "temperatureCoef": 0.0 }, "alertQuantity": 0, "highestImpact": "0", "uris": { "DETAILS": "/site/254108/details", "DATA_PERIOD": "/site/254108/dataPeriod", "OVERVIEW": "/site/254108/overview" }, "publicSettings": { "isPublic": null } } },
                dataPeriod: { "dataPeriod": { "startDate": "2016-04-12", "endDate": "2025-11-13" } },
                overview: { "overview": { "lastUpdateTime": "2025-11-13 11:55:37", "lifeTimeData": { "energy": 689244860.0, "revenue": 0.0 }, "lastYearData": { "energy": 73261496.0 }, "lastMonthData": { "energy": 2122913.0 }, "lastDayData": { "energy": 77758.0 }, "currentPower": { "power": 27822.0 }, "measuredBy": "" } },
                energy_last_7_days: { "energy": { "timeUnit": "DAY", "unit": "Wh", "values": { "sample": [ { "date": "2025-11-06 00:00:00", "value": 157371.0 }, { "date": "2025-11-07 00:00:00", "value": 170276.0 }, { "date": "2025-11-08 00:00:00", "value": 183093.0 }, { "date": "2025-11-09 00:00:00", "value": 180963.0 }, { "date": "2025-11-10 00:00:00", "value": 176997.0 }, { "date": "2025-11-11 00:00:00", "value": 170198.0 }, { "date": "2025-11-12 00:00:00", "value": 156902.0 } ] } } },
                power_last_24h: { "power": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "values": { "sample": [ { "date": "2025-11-12 09:45:00", "value": 26166.0 }, { "date": "2025-11-12 10:00:00", "value": 21160.0 }, { "date": "2025-11-12 10:15:00", "value": 25655.0 }, { "date": "2025-11-12 10:30:00", "value": 21553.666 }, { "date": "2025-11-12 10:45:00", "value": 28732.0 } ] } } },
                powerDetails_sample: { "powerDetails": { "timeUnit": "QUARTER_OF_AN_HOUR", "unit": "W", "meters": [ { "type": "Purchased", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Consumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "FeedIn", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } }, { "type": "Production", "values": { "sample": [ { "date": "2025-11-13 07:45:00", "value": 6603.0 }, { "date": "2025-11-13 08:00:00", "value": 11905.0 }, { "date": "2025-11-13 08:15:00", "value": 9956.0 }, { "date": "2025-11-13 08:30:00", "value": 9581.0 }, { "date": "2025-11-13 08:45:00", "value": 11755.333 } ] } }, { "type": "SelfConsumption", "values": { "sample": [ { "date": "2025-11-13 07:45:00" }, { "date": "2025-11-13 08:00:00" }, { "date": "2025-11-13 08:15:00" }, { "date": "2025-11-13 08:30:00" }, { "date": "2025-11-13 08:45:00" } ] } } ] } },
                meters_sample: { "meterEnergyDetails": { "timeUnit": "DAY", "unit": "Wh", "meters": [] } },
                inventory: { "Inventory": { "inverters": [ { "name": "Inverter 2", "manufacturer": "SolarEdge", "model": "RSE27.6K-RW000BNN4", "communicationMethod": "ETHERNET", "dsp1Version": "1.13.2306", "dsp2Version": "2.19.1900", "cpuVersion": "4.15.120", "connectedOptimizers": 48, "partNumber": "RSE27.6K-RW000BNN4", "SN": "BE04D3D8-6D" }, { "name": "Inverter 1", "manufacturer": "SolarEdge", "model": "SE16K", "communicationMethod": "RS485", "dsp1Version": "1.13.1525", "dsp2Version": "2.19.1312", "cpuVersion": "3.2434.0", "connectedOptimizers": 28, "partNumber": "RSE16K-RW002NNN2", "SN": "BE041806-E0" } ], "batteries": [], "gateways": [], "sensors": [], "meters": [] } },
                sensors_list: { "SiteSensors": { "total": 0, "list": [] } },
                sensors_data_error: "HTTP 400 for https://monitoringapi.solaredge.com/site/254108/sensors params={'startTime': '2025-11-12 09:56:05', 'endTime': '2025-11-13 09:56:05'}. Body: <!doctype html><html lang=\"en\"><head><title>HTTP Status 400 – Bad Request</title><style type=\"text/css\">h1 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:22px;} h2 {font-family:Tahoma,Arial,sans-serif;color:white;background-color:#525D76;font-size:16px;} h3 {font"
            }
        ];


        // --- פונקציות עזר לפורמט נתונים ---
        // (זהות לקודם, למעט שינויים קלים ב-formatPower)

        function formatEnergy(wh) {
            if (wh === null || wh === undefined) return 'N/A';
            if (wh >= 1_000_000_000) {
                return (wh / 1_000_000_000).toFixed(2) + ' GWh';
            }
            if (wh >= 1_000_000) {
                return (wh / 1_000_000).toFixed(2) + ' MWh';
            }
            if (wh >= 1_000) {
                return (wh / 1_000).toFixed(2) + ' kWh';
            }
            return wh.toFixed(0) + ' Wh';
        }

        function formatPower(w) {
            if (w === null || w === undefined) return 'N/A';
            if (w >= 1_000_000) {
                return (w / 1_000_000).toFixed(2) + ' MW';
            }
            if (w >= 1_000) {
                return (w / 1_000).toFixed(2) + ' kW';
            }
            return w.toFixed(0) + ' W';
        }
        
        // פונקציה חדשה לעיצוב ערך + יחידה בנפרד
        function formatPowerParts(w) {
             if (w === null || w === undefined) return { value: 'N/A', unit: '' };
            if (w >= 1_000_000) {
                return { value: (w / 1_000_000).toFixed(2), unit: 'MW' };
            }
            if (w >= 1_000) {
                return { value: (w / 1_000).toFixed(2), unit: 'kW' };
            }
            return { value: w.toFixed(0), unit: 'W' };
        }
        
        function formatEnergyParts(wh) {
            if (wh === null || wh === undefined) return { value: 'N/A', unit: '' };
            if (wh >= 1_000_000_000) {
                return { value: (wh / 1_000_000_000).toFixed(2), unit: 'GWh' };
            }
            if (wh >= 1_000_000) {
                return { value: (wh / 1_000_000).toFixed(2), unit: 'MWh' };
            }
            if (wh >= 1_000) {
                return { value: (wh / 1_000).toFixed(2), unit: 'kWh' };
            }
            return { value: wh.toFixed(0), unit: 'Wh' };
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            try {
                const [year, month, day] = dateString.split('-');
                return `${day}/${month}/${year}`;
            } catch (e) {
                return dateString;
            }
        }

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return 'N/A';
            try {
                const [date, time] = dateTimeString.split(' ');
                const [year, month, day] = date.split('-');
                return `${day}/${month}/${year} ${time || ''}`;
            } catch (e) {
                return dateTimeString;
            }
        }
        
        /**
         * מייצר כרטיס סטטיסטיקה (KPI) - *מעודכן לעיצוב החדש*
         */
        function renderStatCard(label, data, valueColor = 'text-blue-600') {
            return `
                <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col justify-between">
                    <div class="stat-label">${label}</div>
                    <div>
                        <span class="stat-value ${valueColor}">${data.value}</span>
                        ${data.unit && `<span class="text-2xl font-semibold text-gray-500 mr-2">${data.unit}</span>`}
                    </div>
                </div>
            `;
        }

        /**
         * מייצר גרף עמודות פשוט - *מעודכן לעיצוב החדש*
         */
        function renderBarChart(title, data) {
            if (!data || data.length === 0) return '';
            
            const maxValue = Math.max(...data.map(item => item.value));
            const barsHtml = data.map(item => `
                <div class="flex-1 flex flex-col items-center px-1">
                    <div class="w-full bg-gray-200 rounded-t-lg" style="height: 150px;">
                        <div class="bg-blue-600 rounded-t-lg" 
                             style="height: ${((item.value || 0) / maxValue) * 100}%;"
                             title="${formatEnergy(item.value)}">
                        </div>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">${formatDate(item.date.split(' ')[0]).substring(0, 5)}</div>
                </div>
            `).join('');

            return `
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">${title}</h3>
                    <div class="flex items-end space-x-2 space-x-reverse h-[170px]">
                        ${barsHtml}
                    </div>
                </div>
            `;
        }

        /**
         * מייצר טבלה פשוטה - *מעודכן לעיצוב החדש*
         */
        function renderTable(title, headers, data) {
            if (!data || data.length === 0) return '';

            const headerHtml = headers.map(h => `<th class="px-4 py-3 text-right bg-gray-50 font-semibold text-gray-600">${h}</th>`).join('');
            const rowsHtml = data.map(row => `
                <tr class="border-b border-gray-100">
                    <td class="px-4 py-3 text-gray-700">${formatDateTime(row.date)}</td>
                    <td class="px-4 py-3 text-gray-900 font-medium">${formatPower(row.value)}</td>
                </tr>
            `).join('');

            return `
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">${title}</h3>
                    <div class="overflow-auto max-h-96">
                        <table class="min-w-full text-sm">
                            <thead class="sticky top-0 bg-white">
                                <tr>${headerHtml}</tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${rowsHtml}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        /**
         * מייצר כרטיס פרטים (מציג key-value) - *מעודכן לעיצוב החדש*
         */
        function renderDetailCard(title, data) {
            const itemsHtml = Object.entries(data).map(([key, value]) => {
                if (typeof value === 'object' && value !== null) return ''; // מדלג על אובייקטים מקוננים
                return `
                    <div class="py-3 sm:grid sm:grid-cols-3 sm:gap-4">
                        <dt class="text-sm font-semibold text-gray-500">${key}</dt>
                        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2 font-medium">${value || 'N/A'}</dd>
                    </div>
                `;
            }).join('');

            return `
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-900 mb-2">${title}</h3>
                    <dl class="divide-y divide-gray-200">
                        ${itemsHtml}
                    </dl>
                </div>
            `;
        }
        
        /**
         * מייצר כרטיס ציוד (ממירים וכו') - *מעודכן לעיצוב החדש*
         */
        function renderInventory(inverters) {
             if (!inverters || inverters.length === 0) return '<p class="text-gray-500">לא נמצא ציוד</p>';

             const invertersHtml = inverters.map(inv => `
                <li class="py-3">
                    <div class="font-bold text-gray-800">${inv.name} (${inv.model})</div>
                    <div class="text-sm text-gray-600">
                        <strong>יצרן:</strong> ${inv.manufacturer} | <strong>S/N:</strong> ${inv.SN}
                    </div>
                    <div class="text-sm text-gray-600">
                        <strong>גרסת CPU:</strong> ${inv.cpuVersion} | <strong>מחוברים:</strong> ${inv.connectedOptimizers} אופטימייזרים
                    </div>
                </li>
             `).join('');

             return `<ul class="divide-y divide-gray-200">${invertersHtml}</ul>`;
        }


        // --- לוגיקה ראשית ---

        const siteListEl = document.getElementById('site-list');
        const contentAreaEl = document.getElementById('content-area');

        /**
         * פונקציה ראשית לאתחול הדף
         */
        function init() {
            // יצירת רשימת הניווט
            siteData.forEach(site => {
                const li = document.createElement('li');
                const button = document.createElement('button');
                
                button.textContent = site.details.details.name;
                button.dataset.siteId = site.details.details.id;
                // שימוש בעיצוב כפתור מהדוגמה
                button.className = "nav-button w-full text-right pr-4 pl-2 py-3 rounded-lg transition-colors duration-200";
                
                button.onclick = () => handleNavClick(site.details.details.id);
                
                li.appendChild(button);
                siteListEl.appendChild(li);
            });

            // טעינת האתר הראשון כברירת מחדל
            if (siteData.length > 0) {
                handleNavClick(siteData[0].details.details.id);
            }
        }

        /**
         * מטפל בלחיצה על כפתור ניווט
         */
        function handleNavClick(siteId) {
            // הסרת 'active' מכל הכפתורים
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // הוספת 'active' לכפתור שנלחץ
            const activeButton = document.querySelector(`.nav-button[data-site-id="${siteId}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }

            // רינדור הנתונים
            renderSiteData(siteId);
        }

        /**
         * מרנדר את כל הנתונים של אתר ספציפי לאזור התוכן - *מעודכן לעיצוב החדש*
         */
        function renderSiteData(siteId) {
            const site = siteData.find(s => s.details.details.id === siteId);
            if (!site) {
                contentAreaEl.innerHTML = '<h1 class="text-2xl text-red-500">שגיאה: לא נמצא אתר</h1>';
                return;
            }

            const d = site.details.details;
            const o = site.overview.overview;
            
            const statusColorClass = d.status === 'Active' ? 'text-green-700 bg-green-100' : 'text-red-700 bg-red-100';
            const statusDotClass = d.status === 'Active' ? 'bg-green-500' : 'bg-red-500';

            // יצירת ה-HTML
            const html = `
                <!-- כותרת ראשית ומזהה (מעוצב) -->
                <div class="mb-8">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <h1 class="text-4xl font-bold text-gray-900">${d.name}</h1>
                        <span class="${statusColorClass} text-sm font-bold px-4 py-2 rounded-full flex items-center">
                            <span class="w-2 h-2 ${statusDotClass} rounded-full ml-2"></span>
                            ${d.status === 'Active' ? 'פעיל' : 'תקלה'}
                        </span>
                    </div>
                    <p class_=("text-lg text-gray-500 mt-1">
                        Site ID: ${d.id} | עדכון אחרון: ${formatDateTime(o.lastUpdateTime)}
                    </p>
                </div>

                <!-- כרטיסי נתונים ראשיים (KPIs) (מעוצב) -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    ${renderStatCard('הספק נוכחי', formatPowerParts(o.currentPower.power))}
                    ${renderStatCard('אנרגיה (היום)', formatEnergyParts(o.lastDayData.energy), 'text-gray-900')}
                    ${renderStatCard('אנרגיה (חודש)', formatEnergyParts(o.lastMonthData.energy), 'text-gray-900')}
                    ${renderStatCard('אנרגיה (סה"כ)', formatEnergyParts(o.lifeTimeData.energy), 'text-gray-900')}
                </div>

                <!-- גרפים וטבלאות (מעוצב) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    ${renderBarChart('ייצור יומי (7 ימים אחרונים)', site.energy_last_7_days.energy.values.sample)}
                    ${renderTable('דגימת הספק (5 ערכים אחרונים)', ['זמן', 'הספק'], site.power_last_24h.power.values.sample)}
                </div>

                <!-- פרטי אתר וציוד (מעוצב) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- פרטי אתר -->
                    ${renderDetailCard('פרטי אתר', {
                        'תאריך התקנה': formatDate(d.installationDate),
                        'מודול ראשי': `${d.primaryModule.manufacturerName} - ${d.primaryModule.modelName}`,
                        'מיקום': `${d.location.address}, ${d.location.city}`,
                        'הספק שיא (Peak)': formatPower(d.peakPower * 1000)
                    })}

                    <!-- רשימת ציוד (ממירים) -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">ציוד וממירים</h3>
                        ${renderInventory(site.inventory.Inventory.inverters)}
                    </div>
                </div>

                <!-- שגיאות (אם יש) (מעוצב) -->
                ${site.sensors_data_error ? `
                <div class="bg-red-100 border border-red-300 text-red-800 px-5 py-4 rounded-xl shadow-lg" role="alert">
                    <strong class="font-bold">שגיאת חיישנים:</strong>
                    <p class="text-sm break-words mt-1">${site.sensors_data_error}</p>
                </div>
                ` : ''}
            `;

            contentAreaEl.innerHTML = html;
        }


        // הפעלת האפליקציה לאחר טעינת ה-DOM
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
