<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Wizard Pro ‚Äì Advanced AI Data-Engineer Demo</title>
  <meta name="description" content="Explore Data Wizard's advanced capabilities: automated warehouse dashboards, ERD mapping, deep SQL analysis, and an AI agent that streamlines data engineering tasks.">
  <meta name="theme-color" content="#0d1117">

  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    html { scroll-behavior: smooth; }
    body { font-family: 'Inter', sans-serif; }
    .bg-aurora { background: #0d1117; background-image: radial-gradient(ellipse at top, rgba(167, 139, 250, .12), transparent 55%), radial-gradient(ellipse at bottom, rgba(103, 232, 249, .12), transparent 55%), linear-gradient(rgba(255, 255, 255, .04) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, .04) 1px, transparent 1px); background-size: 100% 100%, 100% 100%, 2.5rem 2.5rem, 2.5rem 2.5rem; }
    .gradient-text { background: linear-gradient(to right, #a78bfa, #67e8f9); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    @keyframes bob { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    .typing-indicator span { height: 8px; width: 8px; margin: 0 2px; background-color: #9ca3af; border-radius: 50%; display: inline-block; animation: bob 1.4s infinite ease-in-out; }
    .typing-indicator span:nth-child(1) { animation-delay: -.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -.16s; }
    .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background-color: #4b5563; border-radius: 6px; }
    .immersive-container { position: fixed; top: 4rem; right: 0; left: 0; bottom: 0; overflow-y: auto; }
    html.immersive-active { overflow: hidden; }
    /* ERD Line Style */
    .erd-line { position: absolute; border: 1px solid; border-color: rgba(107, 114, 128, 0.7); z-index: 0; }
  </style>
</head>
<body class="bg-aurora text-gray-200 antialiased" x-data="wizardPage()" x-init="init()">

  <header class="fixed top-0 inset-x-0 z-50 bg-gray-900/60 backdrop-blur-lg border-b border-gray-700/40 h-16">
    <nav class="container mx-auto px-4 sm:px-6 h-full flex justify-between items-center">
      <a href="#" class="text-xl font-extrabold gradient-text">üîÆ Data Wizard Pro</a>
      <button @click="enterImmersive()" class="bg-purple-500 hover:bg-purple-400 text-white font-semibold py-2 px-5 rounded-lg transition-transform hover:scale-105 shadow-lg shadow-purple-500/20 text-sm sm:text-base">
        Start Advanced Demo
      </button>
    </nav>
  </header>

  <div class="pt-16">

    <section x-show="!immersive" x-transition class="pt-16 md:pt-24 text-center overflow-hidden select-none">
      <div class="container mx-auto px-4 sm:px-6">
        <span class="bg-purple-500/10 border border-purple-500/30 text-purple-300 text-xs font-semibold px-4 py-1 rounded-full">
          Autonomous Data-Engineering Platform
        </span>
        <h1 class="text-4xl md:text-6xl font-extrabold text-white mt-6 mb-4 leading-tight">
          The Last Data-Engineering Tool<br>You'll Ever Need
        </h1>
        <p class="text-lg md:text-xl text-gray-400 max-w-3xl mx-auto">
          From automated cost optimization and ERD mapping to an expert AI agent, Data Wizard Pro handles it all.
        </p>
        <div class="mt-10 flex justify-center gap-4 flex-wrap">
          <button @click="enterImmersive()" class="bg-purple-500 hover:bg-purple-400 text-white font-bold py-3 px-8 rounded-lg transition-transform hover:scale-105 text-lg shadow-lg shadow-purple-500/30">üöÄ Launch Advanced Demo</button>
          <a href="#features" class="inline-flex items-center gap-2 border border-gray-600 hover:bg-gray-800 px-6 py-3 rounded-lg transition-colors"> <i class="fa-solid fa-list-check text-purple-300"></i> Explore Features </a>
        </div>
      </div>
    </section>

    <section id="features" x-show="!immersive" x-transition class="py-20 bg-gray-900/40 mt-16">
      <div class="container mx-auto px-4 sm:px-6 text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">A Full Data Engineer in a Box</h2>
        <p class="text-gray-400 max-w-2xl mx-auto mb-16">Go beyond monitoring. Get automated insights, visual maps, and proactive fixes.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 text-left">
          <template x-for="feat in features" :key="feat.title">
            <div class="bg-gray-800/60 p-6 rounded-xl border border-gray-700 hover:border-purple-500 transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-purple-500/10">
              <div class="text-3xl mb-4 text-purple-400"><i :class="feat.icon"></i></div>
              <h3 class="text-xl font-bold text-white mb-2" x-text="feat.title"></h3>
              <p class="text-gray-400" x-text="feat.desc"></p>
            </div>
          </template>
        </div>
      </div>
    </section>

    <main id="demo" x-show="immersive" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" class="immersive-container bg-gray-800/30" x-data="demoWizard()" x-init="start()">

      <template x-if="phase==='mapping'">
        <section class="h-full flex flex-col items-center justify-center text-center gap-6 px-4">
          <h2 class="text-2xl font-bold text-white">‚öôÔ∏è Analyzing Warehouse Architecture...</h2>
          <p class="text-purple-300 h-5" x-text="status"></p>
          <div class="w-full max-w-xl bg-gray-900 rounded-full h-3.5 overflow-hidden border border-gray-700"><div class="h-full bg-gradient-to-r from-cyan-400 to-purple-500 transition-all duration-500 ease-out" :style="`width:${progress}%`"></div></div>
        </section>
      </template>

      <template x-if="phase==='dashboard'">
        <section class="h-full flex flex-col p-4 md:p-6 gap-6">
            <div class="flex-shrink-0 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-white">Warehouse Overview</h2>
                <button @click="phase='warehouse'" class="bg-purple-500 hover:bg-purple-400 text-white font-semibold px-4 py-2 rounded-lg transition-transform hover:scale-105 text-sm">Dive into Explorer <i class="fa-solid fa-arrow-right ml-1"></i></button>
            </div>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                <div class="bg-gray-900/60 p-4 rounded-xl border border-gray-700"><p class="text-sm text-gray-400">Total Tables</p><p class="text-2xl font-bold text-white" x-text="demoData.summary.totalTables"></p></div>
                <div class="bg-gray-900/60 p-4 rounded-xl border border-gray-700"><p class="text-sm text-gray-400">Total Size</p><p class="text-2xl font-bold text-white" x-text="demoData.summary.totalSizeTB + ' TB'"></p></div>
                <div class="bg-gray-900/60 p-4 rounded-xl border border-gray-700"><p class="text-sm text-gray-400">30-Day Cost</p><p class="text-2xl font-bold text-white" x-text="'$'+demoData.summary.totalCost.toLocaleString()"></p></div>
                <div class="bg-gray-900/60 p-4 rounded-xl border border-gray-700"><p class="text-sm text-gray-400">Issues Found</p><p class="text-2xl font-bold text-red-400" x-text="demoData.summary.issuesFound"></p></div>
            </div>
            <div class="flex-1 grid lg:grid-cols-3 gap-4 md:gap-6 min-h-0">
                <div class="lg:col-span-1 bg-gray-900/60 p-4 rounded-xl border border-gray-700 flex flex-col items-center justify-center"><h3 class="text-lg font-bold mb-2">Warehouse Health Score</h3><div class="relative w-48 h-48"><canvas id="healthScoreChart"></canvas><span class="absolute inset-0 flex items-center justify-center text-3xl font-extrabold text-cyan-300" x-text="demoData.summary.healthScore + '%'"></span></div></div>
                <div class="lg:col-span-2 bg-gray-900/60 p-4 rounded-xl border border-gray-700 flex flex-col"><h3 class="text-lg font-bold mb-4">Cost Distribution by Table</h3><div class="relative flex-1"><canvas id="costDistributionChart"></canvas></div></div>
            </div>
        </section>
      </template>

      <template x-if="phase==='warehouse'">
        <section class="h-full flex flex-col md:flex-row gap-4 p-4">
          <aside class="w-full md:w-72 lg:w-80 bg-gray-900/60 border border-gray-700 rounded-xl p-4 flex flex-col shrink-0">
            <div class="flex items-center justify-between mb-3">
                <button @click="phase='dashboard'" class="text-gray-400 hover:text-white"><i class="fa-solid fa-arrow-left mr-2"></i>Dashboard</button>
                <h3 class="font-bold text-white text-lg">Explorer</h3>
            </div>
            <div class="flex border border-gray-700 rounded-lg p-1 bg-gray-800/50 mb-3"><button @click="warehouseView='details'" class="flex-1 py-1 text-sm rounded-md transition" :class="warehouseView==='details' ? 'bg-purple-600 text-white' : 'hover:bg-gray-700/50'">Details</button><button @click="warehouseView='erd'" class="flex-1 py-1 text-sm rounded-md transition" :class="warehouseView==='erd' ? 'bg-purple-600 text-white' : 'hover:bg-gray-700/50'">ERD</button></div>
            <input x-model="filterTerm" placeholder="Search tables‚Ä¶" class="bg-gray-800/50 mb-3 text-gray-200 placeholder-gray-400 border border-gray-700 rounded-md px-3 py-2 text-sm focus:outline-none focus:border-purple-400 w-full">
            <div class="flex-1 overflow-y-auto scrollbar-thin space-y-1">
              <template x-for="table in filteredTables" :key="table.name"><button @click="selectTable(table)" class="w-full flex justify-between items-center text-left px-3 py-2 rounded-md hover:bg-gray-800/50 transition" :class="{'bg-purple-600/40 text-white':selectedTable?.name===table.name}"><span class="font-medium" x-text="table.name"></span><span class="text-xs text-gray-400" x-text="(table.rows/1000000).toFixed(1) + 'M rows'"></span></button></template>
            </div>
            <button @click="phase='chat'; initPreQ(); $nextTick(() => scrollToBottom())" class="mt-4 w-full bg-cyan-500 hover:bg-cyan-400 text-black font-semibold px-6 py-2 rounded-lg shadow-lg shadow-cyan-500/20 transition-transform hover:scale-105">üí¨ Chat with Agent</button>
          </aside>
          <div class="flex-1 bg-gray-900/60 border border-gray-700 rounded-xl overflow-hidden flex flex-col">
            <template x-if="warehouseView === 'details'">
              <div class="p-4 md:p-6 flex flex-col min-w-0 h-full">
                <template x-if="!selectedTable"><div class="flex items-center justify-center h-full text-gray-500 text-center"><span><i class="fa-solid fa-arrow-left fa-lg mr-2"></i> Select a table to inspect its properties</span></div></template>
                <template x-if="selectedTable"><div class="flex flex-col h-full">
                  <h3 class="text-xl lg:text-2xl font-bold text-white mb-1" x-text="selectedTable.name"></h3><p class="text-sm text-gray-400 mb-4" x-text="selectedTable.description"></p>
                  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 text-center"><div class="bg-gray-800/70 p-2 rounded-lg"><div class="text-xs text-purple-300">Size</div><div class="font-semibold" x-text="selectedTable.sizeGB + ' GB'"></div></div><div class="bg-gray-800/70 p-2 rounded-lg"><div class="text-xs text-purple-300">30d Cost</div><div class="font-semibold" x-text="'$'+selectedTable.last30Cost.toLocaleString()"></div></div><div class="bg-gray-800/70 p-2 rounded-lg"><div class="text-xs text-purple-300">Partitioned</div><div class="font-semibold" x-html="selectedTable.partitioned ? `<span class='text-green-400'>Yes</span>` : `<span class='text-yellow-400'>No</span>`"></div></div><div class="bg-gray-800/70 p-2 rounded-lg"><div class="text-xs text-purple-300">Complexity</div><div class="font-semibold" x-text="selectedTable.complexityScore"></div></div></div>
                  <div class="grid lg:grid-cols-2 gap-6 flex-1 min-h-0">
                    <div class="overflow-y-auto pr-2 scrollbar-thin text-sm"><h4 class="font-semibold text-gray-300 mb-2 text-base">Columns</h4><table class="w-full text-left"><thead><tr class="text-purple-300 text-xs"><th class="pb-1 font-semibold pl-2">Name</th><th class="font-semibold">Type</th><th class="font-semibold">Notes</th></tr></thead><tbody><template x-for="col in selectedTable.columns" :key="col.name"><tr class="border-t border-gray-700/50"><td class="py-1.5 pl-2" x-text="col.name"></td><td class="text-gray-400" x-text="col.type"></td><td class="text-gray-400 text-xs" x-text="col.note"></td></tr></template></tbody></table></div>
                    <div class="overflow-y-auto pr-2 scrollbar-thin text-sm"><h4 class="font-semibold text-gray-300 mb-2 text-base">Relationships</h4><template x-if="selectedTable.relations.length === 0"><p class="text-xs text-gray-500">No foreign keys detected.</p></template><div class="space-y-1"><template x-for="rel in selectedTable.relations" :key="rel.toTable"><div class="text-xs text-gray-400 bg-gray-800/50 rounded p-2 border border-gray-700" x-text="`${selectedTable.name}.${rel.from} ‚ûú ${rel.toTable}.${rel.to}`"></div></template></div><h4 class="font-semibold text-gray-300 mt-4 mb-2 text-base">Proactive Insights</h4><p class="text-xs text-gray-400" x-text="selectedTable.insight"></p></div>
                  </div>
                </div></template>
              </div>
            </template>
            <template x-if="warehouseView === 'erd'">
              <div class="p-4 h-full overflow-auto scrollbar-thin">
                  <div class="relative w-[1200px] h-[700px]">
                      <template x-for="table in demoData.tables" :key="table.name">
                          <div :id="'erd-' + table.name" class="absolute bg-gray-800 border-2 rounded-lg p-2 w-48 shadow-lg" :class="selectedTable?.name === table.name ? 'border-purple-500' : 'border-gray-600'" :style="`top:${table.pos.y}px; left:${table.pos.x}px;`">
                              <p class="font-bold text-sm text-cyan-300 flex justify-between items-center" x-text="table.name"><button @click="warehouseView='details'; selectTable(table)" class="text-gray-400 hover:text-white text-xs"><i class="fa-solid fa-magnifying-glass"></i></button></p>
                              <div class="text-xs mt-1 border-t border-gray-600 pt-1"><template x-for="col in table.columns.slice(0, 5)"><p class="text-gray-400 truncate" x-text="col.name + ' (' + col.type.toLowerCase() + ')'"></p></template><p x-show="table.columns.length > 5" class="text-gray-500 text-center">...</p></div>
                          </div>
                      </template>
                      <svg class="absolute top-0 left-0 w-full h-full overflow-visible z-[-1]">
                        <template x-for="line in erdLines" :key="line.key">
                            <line :x1="line.x1" :y1="line.y1" :x2="line.x2" :y2="line.y2" stroke="rgba(107, 114, 128, 0.7)" stroke-width="2"/>
                        </template>
                      </svg>
                  </div>
              </div>
            </template>
          </div>
        </section>
      </template>
      
      <template x-if="phase==='chat'"><section class="h-full flex flex-col bg-gray-900/40">
        <div class="flex items-center justify-between px-4 h-14 border-b border-gray-700 bg-gray-900/60 shrink-0"><button @click="phase='warehouse'" class="text-gray-300 hover:text-white text-sm"><i class="fa-solid fa-arrow-left mr-2"></i>Back</button><h2 class="font-semibold text-white text-sm">Data-Engineer Agent</h2><div class="w-12"></div></div>
        <div id="chatArea" class="flex-1 overflow-y-auto p-4 space-y-6 scrollbar-thin"><template x-for="msg in messages" :key="msg.id"><div class="flex" :class="msg.who==='user'?'justify-end':'justify-start'"><div class="max-w-[90%] sm:max-w-[80%] md:max-w-[70%]"><div :class="msg.who==='user'?'bg-purple-600 text-white rounded-br-none':'bg-gray-800 text-gray-200 rounded-bl-none'" class="px-4 py-2.5 rounded-xl whitespace-pre-wrap text-sm" x-html="msg.text"></div></div></div></template><div x-show="isTyping" class="flex justify-start"><div class="bg-gray-800 text-gray-200 rounded-xl rounded-bl-none px-4 py-2"><div class="typing-indicator"><span></span><span></span><span></span></div></div></div></div>
        <div x-show="suggested.length" class="border-t border-gray-700 bg-gray-900/50 p-3 text-xs"><p class="text-gray-400 mb-2">Suggestions:</p><div class="flex flex-wrap gap-2"><template x-for="q in suggested" :key="q"><button @click="quickAsk(q)" class="bg-gray-800 hover:bg-purple-500 hover:text-white border border-gray-700 text-gray-300 px-3 py-1.5 rounded-full transition text-left">üéØ <span x-text="q"></span></button></template></div></div>
        <div class="border-t border-gray-700 bg-gray-900/50 p-3 flex items-start sm:items-center gap-3 shrink-0"><textarea x-model="chatInput" @keydown.enter.prevent.stop="sendMsg()" placeholder="Ask about warehouse health, ERD, query optimization..." class="flex-1 bg-gray-800 text-gray-200 rounded-md px-3 py-2 resize-none h-10 focus:outline-none focus:ring-2 focus:ring-purple-500 border border-gray-700 text-sm" @input="chatInput.style.height = 'auto'; chatInput.style.height = chatInput.scrollHeight + 'px'"></textarea><button @click="sendMsg()" :disabled="!chatInput.trim()" class="bg-purple-500 hover:bg-purple-400 disabled:opacity-40 disabled:cursor-not-allowed text-white font-semibold px-5 py-2 rounded-md transition self-end sm:self-center">Send</button></div>
      </section></template>

    </main>

    <footer x-show="!immersive" class="bg-gray-900/50 border-t border-gray-700/40 py-10 text-center text-gray-500">
      <p>&copy; <span x-text="year"></span> BI Magics. All rights reserved.</p>
      <p class="text-xs mt-2">Built with ü™Ñ for data-engineering teams</p>
    </footer>
  </div>

<script>
function wizardPage() {
  return {
    immersive: false,
    year: new Date().getFullYear(),
    features: [
      { icon: 'fa-solid fa-gauge-high', title: 'Health & Cost Dashboard', desc: 'Get a 360¬∞ view of your warehouse with a health score, cost breakdowns, and proactive alerts.' },
      { icon: 'fa-solid fa-diagram-project', title: 'Automated ERD Mapping', desc: 'Visualize your entire data schema with an automatically generated Entity-Relationship Diagram.' },
      { icon: 'fa-solid fa-code-compare', title: 'Advanced SQL Analysis', desc: 'Detect inefficient query patterns, get complexity scores, and receive concrete optimization advice.' },
      { icon: 'fa-solid fa-database', title: 'Deep Table Statistics', desc: 'Analyze row counts, data freshness, partitioning strategies, and column-level details.' },
      { icon: 'fa-solid fa-comments', title: 'Expert AI Agent', desc: 'Chat in natural language to query metadata, ask for optimization SQL, and understand complex relationships.' },
      { icon: 'fa-solid fa-shield-heart', title: 'Proactive Issue Detection', desc: 'Automatically find orphan tables, missing keys, and tables that are costly to scan.' }
    ],
    enterImmersive() {
      this.immersive = true;
      document.documentElement.classList.add('immersive-active');
    },
    init() {}
  }
}

function demoWizard() {
  return {
    phase: 'mapping',
    progress: 0,
    status: 'Initializing‚Ä¶',
    warehouseView: 'details',
    filterTerm: '',
    selectedTable: null,
    chatInput: '',
    messages: [],
    msgId: 0,
    suggested: [],
    isTyping: false,
    demoData: {
      summary: { totalTables: 5, totalSizeTB: 1.6, totalCost: 44255, issuesFound: 3, healthScore: 78 },
      tables: [
        { name: 'fact_events', rows: 2100000000, sizeGB: 1250.7, last30Cost: 38400, partitioned: false, complexityScore: 7.2, description: 'Core table logging all user interactions.', insight: 'High cost due to full table scans. Recommend partitioning by `event_date` and clustering by `event_name`.', pos: {x: 450, y: 300},
          columns: [{ name: 'event_id', type: 'UUID', note: 'PK' }, { name: 'session_id', type: 'UUID', note: 'FK to sessions' }, { name: 'user_id', type: 'INT', note: 'FK to users' }, { name: 'event_name', type: 'STRING', note: '' }, { name: 'event_time', type: 'TIMESTAMP', note: '' }], relations: [{ from: 'user_id', to: 'id', toTable: 'dim_users' }, { from: 'session_id', to: 'session_id', toTable: 'fact_sessions' }] },
        { name: 'dim_users', rows: 85000000, sizeGB: 120.4, last30Cost: 3100, partitioned: true, complexityScore: 4.5, description: 'Dimension table for user profiles.', insight: 'Well-optimized, but `email` column has high cardinality and is often filtered. Consider adding an index.', pos: {x: 50, y: 50},
          columns: [{ name: 'id', type: 'INT', note: 'PK' }, { name: 'email', type: 'STRING', note: '' }, { name: 'created_at', type: 'TIMESTAMP', note: '' }, { name: 'country_code', type: 'STRING', note: 'Partition Key' }], relations: [] },
        { name: 'dim_payments', rows: 32000000, sizeGB: 80.2, last30Cost: 2200, partitioned: true, complexityScore: 8.8, description: 'Dimension table for payment records.', insight: 'Associated views have high complexity (nested CTEs). Recommend refactoring `vw_user_revenue` for better performance.', pos: {x: 850, y: 50},
          columns: [{ name: 'payment_id', type: 'UUID', note: 'PK' }, { name: 'user_id', type: 'INT', note: 'FK to users' }, { name: 'amount_usd', type: 'NUMERIC', note: '' }], relations: [{ from: 'user_id', to: 'id', toTable: 'dim_users' }] },
        { name: 'fact_sessions', rows: 450000000, sizeGB: 150.5, last30Cost: 550, partitioned: true, complexityScore: 6.1, description: 'Session data for user activity.', insight: 'Low query cost suggests it might be underutilized or data is archived efficiently.', pos: {x: 450, y: 50},
          columns: [{ name: 'session_id', type: 'UUID', note: 'PK' }, { name: 'user_id', type: 'INT', note: 'FK to users' }, { name: 'start_time', type: 'TIMESTAMP', note: '' }, { name: 'end_time', type: 'TIMESTAMP', note: '' } ], relations: [{ from: 'user_id', to: 'id', toTable: 'dim_users' }] },
        { name: 'stg_orphan_data', rows: 1200000, sizeGB: 0.8, last30Cost: 5, partitioned: false, complexityScore: 1.0, description: 'Temporary staging table.', insight: 'No recent queries or relations found. This is a candidate for deletion to save storage costs.', pos: {x: 850, y: 550},
          columns: [{ name: 'dummy_col', type: 'STRING', note: '' }], relations: [] }
      ]
    },
    get filteredTables() { if (!this.filterTerm) return this.demoData.tables; const term = this.filterTerm.toLowerCase(); return this.demoData.tables.filter(t => t.name.toLowerCase().includes(term)) },
    get erdLines() {
        const lines = [];
        this.demoData.tables.forEach(table => {
            table.relations.forEach(rel => {
                const toTable = this.demoData.tables.find(t => t.name === rel.toTable);
                if (toTable) {
                    lines.push({
                        key: `${table.name}-${toTable.name}`,
                        x1: table.pos.x + 96, // center of table div (width 192/2)
                        y1: table.pos.y + 40, // middle of table div
                        x2: toTable.pos.x + 96,
                        y2: toTable.pos.y + 40
                    });
                }
            });
        });
        return lines;
    },
    start() {
      const steps = ['Scanning schemas‚Ä¶', 'Analyzing table statistics‚Ä¶', 'Computing relationships‚Ä¶', 'Calculating complexity scores‚Ä¶', 'Generating health report‚Ä¶'];
      steps.forEach((txt, i) => setTimeout(() => { this.status = txt; this.progress = Math.round(((i + 1) / steps.length) * 100) }, i * 600));
      setTimeout(() => {
        this.phase = 'dashboard';
        this.$nextTick(() => { this.renderDashboardCharts(); this.selectTable(this.demoData.tables[0]); });
      }, steps.length * 600 + 300);
    },
    renderDashboardCharts() {
        const healthCtx = document.getElementById('healthScoreChart')?.getContext('2d');
        if (healthCtx) new Chart(healthCtx, { type: 'doughnut', data: { datasets: [{ data: [this.demoData.summary.healthScore, 100 - this.demoData.summary.healthScore], backgroundColor: ['#67e8f9', '#374151'], borderWidth: 0 }] }, options: { responsive: true, cutout: '80%', plugins: { tooltip: { enabled: false } } } });
        
        const costCtx = document.getElementById('costDistributionChart')?.getContext('2d');
        if (costCtx) new Chart(costCtx, { type: 'bar', data: { labels: this.demoData.tables.map(t => t.name), datasets: [{ label: '30-Day Cost', data: this.demoData.tables.map(t => t.last30Cost), backgroundColor: '#a78bfa' }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } }, scales: { y: { ticks: { color: '#9ca3af' } }, x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,.05)' } } } } });
    },
    selectTable(t) { this.selectedTable = t; },
    initPreQ() {
      this.messages.push({id: ++this.msgId, who: 'bot', text: 'Hello! As an advanced Data-Engineer Agent, I can help you with complex warehouse analysis. What can I do for you?'});
      this.suggested = [ 'Explain the warehouse health score', 'Why is fact_events so expensive?', 'Show me an SQL query to improve performance for dim_payments', 'Describe the relationships around the dim_users table' ];
    },
    quickAsk(q) { this.chatInput = q; this.sendMsg(); },
    sendMsg() {
      if (!this.chatInput.trim()) return;
      const txt = this.chatInput.trim(); this.messages.push({ id: ++this.msgId, who: 'user', text: txt });
      this.chatInput = ''; this.suggested = []; this.isTyping = true; this.scrollToBottom();
      setTimeout(() => { this.botRespond(txt); this.isTyping = false; this.scrollToBottom(); }, 1200 + Math.random() * 600);
    },
    botRespond(q) {
      const lq = q.toLowerCase(); let ans = '';
      if (lq.includes('health score')) {
        ans = `The current <strong>Warehouse Health Score is 78%</strong>. Here's the breakdown:\n\n‚Ä¢ ‚úÖ <strong>Cost Efficiency (Good):</strong> Most tables are cost-effective, but <code>fact_events</code> is a major outlier.\n‚Ä¢ ‚ö†Ô∏è <strong>Structural Integrity (Fair):</strong> We have one orphan table (<code>stg_orphan_data</code>) and one large, unpartitioned table (<code>fact_events</code>).\n‚Ä¢ ‚úÖ <strong>Query Complexity (Good):</strong> Most queries are simple, but views related to <code>dim_payments</code> show high complexity.\n\nAddressing the issues with <code>fact_events</code> would provide the biggest boost to the score.`;
      } else if (lq.includes('fact_events')) {
        ans = `The <code>fact_events</code> table is expensive primarily because it is <strong>not partitioned</strong>. At 1.25 TB and with 2.1 billion rows, most queries against it result in a full table scan, which is very costly.\n\n<span class="gradient-text">üí° Recommendation:</span> Partitioning this table by a date column (e.g., daily partitions on <code>event_time</code>) would drastically reduce scan sizes for time-based queries. This action alone could cut costs for this table by <strong>60-80%</strong>.`;
      } else if (lq.includes('sql') && lq.includes('payments')) {
        ans = `Certainly. I've detected a view, likely named <code>vw_user_revenue</code>, that uses an inefficient pattern to join <code>dim_payments</code> with <code>dim_users</code>.\n\n<strong>üö´ Inefficient Pattern:</strong>\n<pre><code class="language-sql" style="color: #cbd5e1; font-size: 0.8rem;">SELECT\n  u.country_code, \n  SUM(p.amount_usd) \nFROM dim_users u \nLEFT JOIN dim_payments p \n  ON u.id = p.user_id \nGROUP BY 1;</code></pre>\n<strong>üí° Optimized Version:</strong>\n<pre><code class="language-sql" style="color: #cbd5e1; font-size: 0.8rem;">-- Pre-aggregate payments first\nWITH payment_agg AS (\n  SELECT user_id, SUM(amount_usd) as total\n  FROM dim_payments\n  GROUP BY 1\n)\nSELECT \n  u.country_code, \n  SUM(p.total)\nFROM dim_users u\nJOIN payment_agg p ON u.id = p.user_id\nGROUP BY 1;</code></pre>\nThis pre-aggregation reduces the join size and improves performance.`;
      } else if (lq.includes('relationships') && lq.includes('users')) {
        ans = `The <code>dim_users</code> table is a central entity in your warehouse. Based on the ERD, it has the following key relationships:\n\n‚Ä¢ <strong>[1-to-Many]</strong> <code>dim_users</code> ‚Üí <code>fact_events</code> (on <code>id</code> = <code>user_id</code>): One user can have many events.\n‚Ä¢ <strong>[1-to-Many]</strong> <code>dim_users</code> ‚Üí <code>dim_payments</code> (on <code>id</code> = <code>user_id</code>): One user can have multiple payments.\n‚Ä¢ <strong>[1-to-Many]</strong> <code>dim_users</code> ‚Üí <code>fact_sessions</code> (on <code>id</code> = <code>user_id</code>): One user can have many sessions.\n\nThis "hub-and-spoke" model is typical and efficient, positioning <code>dim_users</code> as a primary dimension for analysis.`;
      } else {
        ans = 'I can help with that. Could you be more specific? You can ask about cost optimization, specific table structures, or how to write more efficient SQL.';
      }
      this.messages.push({ id: ++this.msgId, who: 'bot', text: ans });
    },
    scrollToBottom() { this.$nextTick(() => { const area = document.getElementById('chatArea'); if (area) area.scrollTo({ top: area.scrollHeight, behavior: 'smooth' }); }); }
  }
}
</script>

</body>
</html>
