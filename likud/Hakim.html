import React, { useState, useEffect } from 'react';
import { Save, UserCheck, UserX, Trash2, Download, Search } from 'lucide-react';

// נתונים בסיסיים - רשימת ה-120 המקורית והשינויים
// based on the user's raw list + 2026 context
const initialData = [
  { id: 1, name: "בנימין נתניהו", role: "ראש הממשלה", active: true, type: "gov" },
  { id: 2, name: "יריב לוין", role: "סגן רה\"מ ושר המשפטים", active: true, type: "gov" },
  { id: 3, name: "אלי כהן", role: "שר האנרגיה", active: true, type: "gov" },
  { id: 4, name: "יואב גלנט", role: "התפטר מהכנסת/ממשלה", active: false, type: "out", replacement: "עפיף עבד (43)" },
  { id: 5, name: "דודי אמסלם", role: "שר (במשרד המשפטים/אזורי)", active: true, type: "gov" },
  { id: 6, name: "אמיר אוחנה", role: "יו\"ר הכנסת", active: true, type: "knesset" },
  { id: 7, name: "יואב קיש", role: "שר החינוך", active: true, type: "gov" },
  { id: 8, name: "ניר ברקת", role: "שר הכלכלה", active: true, type: "gov" },
  { id: 9, name: "מירי רגב", role: "שרת התחבורה", active: true, type: "gov" },
  { id: 10, name: "מיקי זוהר", role: "שר התרבות והספורט", active: true, type: "gov" },
  { id: 11, name: "אבי דיכטר", role: "שר החקלאות", active: true, type: "gov" },
  { id: 12, name: "ישראל כ\"ץ", role: "שר הביטחון", active: true, type: "gov" },
  { id: 13, name: "שלמה קרעי", role: "שר התקשורת", active: true, type: "gov" },
  { id: 14, name: "עמיחי שיקלי", role: "שר התפוצות", active: true, type: "gov" },
  { id: 15, name: "דני דנון", role: "שגריר באו\"ם (התפטר)", active: false, type: "out", replacement: "אביחי בוארון (42)" },
  { id: 16, name: "עידית סילמן", role: "השרה להגנת הסביבה", active: true, type: "gov" },
  { id: 17, name: "דוד ביטן", role: "יו\"ר ועדת הכלכלה", active: true, type: "knesset" },
  { id: 18, name: "יולי אדלשטיין", role: "יו\"ר ועדת חוץ וביטחון", active: true, type: "knesset" },
  { id: 19, name: "אליהו רביבו", role: "ח\"כ (ועדת כספים)", active: true, type: "knesset" },
  { id: 20, name: "גלית דיסטל אטבריאן", role: "ח\"כית", active: true, type: "knesset" },
  { id: 21, name: "ניסים ואטורי", role: "סגן יו\"ר הכנסת", active: true, type: "knesset" },
  { id: 22, name: "שלום דנינו", role: "ח\"כ", active: true, type: "knesset" },
  { id: 23, name: "חיים כץ", role: "שר התיירות", active: true, type: "gov" },
  { id: 24, name: "אופיר אקוניס", role: "קונסול בניו יורק (התפטר)", active: false, type: "out", replacement: "צגה מלקו (37)" },
  { id: 25, name: "טלי גוטליב", role: "ח\"כית", active: true, type: "knesset" },
  { id: 26, name: "חנוך מילביצקי", role: "יו\"ר ועדת כספים", active: true, type: "knesset" },
  { id: 27, name: "בועז ביסמוט", role: "ח\"כ", active: true, type: "knesset" },
  { id: 28, name: "משה סעדה", role: "ח\"כ", active: true, type: "knesset" },
  { id: 29, name: "אלי דלל", role: "ח\"כ", active: true, type: "knesset" },
  { id: 30, name: "גילה גמליאל", role: "שרת המדע והחדשנות", active: true, type: "gov" },
  { id: 31, name: "אופיר כץ", role: "יו\"ר הקואליציה", active: true, type: "knesset" },
  { id: 32, name: "מאי גולן", role: "השרה לשוויון חברתי", active: true, type: "gov" },
  // נורווגים ומחליפים
  { id: 33, name: "דן אילוז", role: "ח\"כ (נורווגי)", active: true, type: "norwegian" },
  { id: 34, name: "אריאל קלנר", role: "ח\"כ (נורווגי)", active: true, type: "norwegian" },
  { id: 35, name: "אתי עטייה", role: "ח\"כית (נורווגית)", active: true, type: "norwegian" },
  { id: 36, name: "עמית הלוי", role: "ח\"כ (נורווגי)", active: true, type: "norwegian" },
  { id: 37, name: "צגה מלקו", role: "ח\"כית (החליפה את אקוניס)", active: true, type: "knesset" },
  { id: 38, name: "אושר שקלים", role: "ח\"כ (נורווגי)", active: true, type: "norwegian" },
  { id: 39, name: "קטי שטרית", role: "ח\"כית (נורווגית)", active: true, type: "norwegian" },
  { id: 40, name: "משה פסל", role: "ח\"כ לשעבר (אינו מכהן כרגע)", active: false, type: "out" }, 
  { id: 41, name: "ששון (ששי) גואטה", role: "ח\"כ (נורווגי)", active: true, type: "norwegian" },
  { id: 42, name: "אביחי בוארון", role: "ח\"כ (במקום דנון)", active: true, type: "knesset" },
  { id: 43, name: "עפיף עבד", role: "ח\"כ (במקום גלנט)", active: true, type: "knesset" },
];

export default function LikudChecklist() {
  // State for user inputs
  const [memberData, setMemberData] = useState(() => {
    const saved = localStorage.getItem('likudTrackerData');
    if (saved) {
      return JSON.parse(saved);
    }
    // Initialize empty data structure
    const initial = {};
    initialData.forEach(m => {
      initial[m.id] = {
        metKnesset: false,
        metEvent: false,
        notes: '',
        contact: ''
      };
    });
    return initial;
  });

  const [searchTerm, setSearchTerm] = useState('');
  const [hideInactive, setHideInactive] = useState(false);

  // Save to local storage whenever data changes
  useEffect(() => {
    localStorage.setItem('likudTrackerData', JSON.stringify(memberData));
  }, [memberData]);

  const toggleCheck = (id, field) => {
    setMemberData(prev => ({
      ...prev,
      [id]: {
        ...prev[id],
        [field]: !prev[id]?.[field]
      }
    }));
  };

  const updateText = (id, field, value) => {
    setMemberData(prev => ({
      ...prev,
      [id]: {
        ...prev[id],
        [field]: value
      }
    }));
  };

  const clearData = () => {
    if (window.confirm("האם אתה בטוח שברצונך למחוק את כל המידע?")) {
      const reset = {};
      initialData.forEach(m => {
        reset[m.id] = { metKnesset: false, metEvent: false, notes: '', contact: '' };
      });
      setMemberData(reset);
    }
  };

  const filteredMembers = initialData.filter(m => {
    const matchesSearch = m.name.includes(searchTerm) || m.role.includes(searchTerm);
    const matchesActive = hideInactive ? m.active : true;
    return matchesSearch && matchesActive;
  });

  // Calculate stats
  const activeCount = initialData.filter(m => m.active).length;
  const metKnessetCount = Object.values(memberData).filter(d => d.metKnesset).length;

  return (
    <div className="min-h-screen bg-gray-100 font-sans text-right" dir="rtl">
      {/* Header */}
      <div className="bg-blue-800 text-white p-4 sticky top-0 z-10 shadow-md">
        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
          <div>
            <h1 className="text-2xl font-bold flex items-center gap-2">
              <UserCheck size={28} />
              הצ'ק-ליסט: נבחרת הליכוד
            </h1>
            <p className="text-blue-200 text-sm">מעקב קשרים, בקשות וסטטוס (מתעדכן אוטומטית)</p>
          </div>
          
          <div className="flex gap-4 items-center bg-blue-900 p-2 rounded-lg">
            <div className="text-center px-4 border-l border-blue-700">
              <span className="block text-xl font-bold">{activeCount}</span>
              <span className="text-xs text-blue-300">ח"כים פעילים</span>
            </div>
            <div className="text-center px-4">
              <span className="block text-xl font-bold text-green-400">{metKnessetCount}</span>
              <span className="text-xs text-blue-300">סומנו</span>
            </div>
          </div>
        </div>
      </div>

      {/* Controls */}
      <div className="max-w-7xl mx-auto p-4 space-y-4">
        <div className="bg-white p-4 rounded-lg shadow flex flex-col md:flex-row gap-4 justify-between items-center">
          <div className="relative w-full md:w-1/3">
            <Search className="absolute right-3 top-2.5 text-gray-400" size={20} />
            <input 
              type="text" 
              placeholder="חיפוש לפי שם או תפקיד..." 
              className="w-full pr-10 pl-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
          
          <div className="flex gap-4 items-center w-full md:w-auto justify-end">
             <label className="flex items-center gap-2 cursor-pointer select-none">
              <input 
                type="checkbox" 
                checked={hideInactive}
                onChange={() => setHideInactive(!hideInactive)}
                className="w-4 h-4"
              />
              <span className="text-gray-700">הסתר לא רלוונטיים</span>
            </label>
            
            <button 
              onClick={clearData}
              className="flex items-center gap-1 text-red-600 hover:bg-red-50 px-3 py-2 rounded transition-colors"
            >
              <Trash2 size={16} />
              איפוס
            </button>
          </div>
        </div>

        {/* List */}
        <div className="bg-white rounded-lg shadow overflow-hidden">
          <div className="overflow-x-auto">
            <table className="w-full min-w-[800px]">
              <thead className="bg-gray-50 text-gray-700 border-b">
                <tr>
                  <th className="p-3 w-12 text-center">#</th>
                  <th className="p-3 w-48 text-right">שם הח"כ/שר</th>
                  <th className="p-3 w-40 text-right">תפקיד</th>
                  <th className="p-3 w-24 text-center bg-blue-50">פגישה בכנסת</th>
                  <th className="p-3 w-24 text-center bg-yellow-50">ביקור בברכיה</th>
                  <th className="p-3 w-64 text-right">מה אפשר לקבל? (הערות)</th>
                  <th className="p-3 w-48 text-right">איש קשר / יועץ</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredMembers.map((member) => {
                  const data = memberData[member.id] || {};
                  const isInactive = !member.active;
                  
                  return (
                    <tr 
                      key={member.id} 
                      className={`hover:bg-gray-50 transition-colors ${isInactive ? 'bg-gray-100 opacity-60' : ''}`}
                    >
                      <td className="p-3 text-center text-gray-500 font-mono text-sm">{member.id}</td>
                      
                      <td className="p-3">
                        <div className="font-bold text-gray-900">{member.name}</div>
                        {member.type === 'norwegian' && <span className="text-xs text-purple-600 bg-purple-100 px-1 rounded">נורווגי</span>}
                        {isInactive && <span className="text-xs text-red-600 bg-red-100 px-1 rounded mr-2">לא מכהן</span>}
                      </td>
                      
                      <td className="p-3 text-sm text-gray-600">
                        {member.role}
                        {member.replacement && <div className="text-xs text-red-500 mt-1">הוחלף ע"י: {member.replacement}</div>}
                      </td>

                      {/* Checkboxes */}
                      <td className="p-3 text-center bg-blue-50/50">
                        <input 
                          type="checkbox" 
                          disabled={isInactive}
                          checked={data.metKnesset || false}
                          onChange={() => toggleCheck(member.id, 'metKnesset')}
                          className="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 cursor-pointer disabled:cursor-not-allowed"
                        />
                      </td>
                      <td className="p-3 text-center bg-yellow-50/50">
                        <input 
                          type="checkbox" 
                          disabled={isInactive}
                          checked={data.metEvent || false}
                          onChange={() => toggleCheck(member.id, 'metEvent')}
                          className="w-5 h-5 text-yellow-500 rounded focus:ring-yellow-500 cursor-pointer disabled:cursor-not-allowed"
                        />
                      </td>

                      {/* Inputs */}
                      <td className="p-3">
                        <input 
                          type="text" 
                          disabled={isInactive}
                          placeholder={isInactive ? "-" : "מה הבטיחו/בקשה..."}
                          className="w-full border-gray-300 rounded text-sm p-1.5 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 bg-transparent"
                          value={data.notes || ''}
                          onChange={(e) => updateText(member.id, 'notes', e.target.value)}
                        />
                      </td>
                      <td className="p-3">
                        <input 
                          type="text" 
                          disabled={isInactive}
                          placeholder={isInactive ? "-" : "שם היועץ/טלפון"}
                          className="w-full border-gray-300 rounded text-sm p-1.5 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 bg-transparent"
                          value={data.contact || ''}
                          onChange={(e) => updateText(member.id, 'contact', e.target.value)}
                        />
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
          
          {filteredMembers.length === 0 && (
            <div className="p-8 text-center text-gray-500">
              לא נמצאו תוצאות לחיפוש זה.
            </div>
          )}
        </div>
        
        <div className="flex justify-between text-gray-500 text-xs px-2">
          <span>* נתונים מעודכנים לינואר 2026</span>
          <span className="flex items-center gap-1"><Save size={12}/> נשמר אוטומטית</span>
        </div>
      </div>
    </div>
  );
}



