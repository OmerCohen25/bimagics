<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>住专 住专 专转</title>
    <!-- 注转 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 注转 驻 Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* 砖砖 驻 Rubik 注专 注专转 -Inter 专专转  */
        body {
            font-family: 'Rubik', 'Inter', sans-serif;
        }
        /* 转转 拽转 -RTL */
        label {
            display: block;
            text-align: right;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">住专 住专 专转</h1>
            <p class="text-lg text-gray-600 mt-2">转 爪转 驻爪 专砖转</p>
        </header>

        <!-- 转 住 砖 专转 -->
        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-800 p-4 rounded-lg mb-8 shadow-md" role="alert">
            <h3 class="font-bold text-xl mb-2">转 住 (拽注)</h3>
            <div class="flex flex-wrap justify-around text-center">
                <div class="p-2">
                    <span class="block text-3xl font-bold">19</span>
                    <span class="text-sm">拽转 专</span>
                </div>
                <div class="p-2">
                    <span class="block text-3xl font-bold">12</span>
                    <span class="text-sm">专转 (住)  爪注</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- 专住 1: 驻爪 ( 爪专?) -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-blue-700 mb-6 border-b pb-3">
                    <span class="inline-block mr-2"></span>
                    驻爪:  拽转 爪专  爪?
                </h2>
                <div class="space-y-4">
                    <div>
                        <label for="ourCandidatesToWin" class="block text-sm font-medium text-gray-700 mb-1"> 注 *砖*  专爪 住?</label>
                        <input type="number" id="ourCandidatesToWin" value="15" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="oppVotersOpt" class="block text-sm font-medium text-gray-700 mb-1"> 爪注 砖 *专*?</label>
                        <input type="number" id="oppVotersOpt" value="100" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="oppCandidatesOpt" class="block text-sm font-medium text-gray-700 mb-1"> 注 *专* 专抓 专砖 砖?</label>
                        <input type="number" id="oppCandidatesOpt" value="12" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <button id="calculateMinVoters" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-150 ease-in-out shadow-md">
                        砖   爪注  爪专
                    </button>
                </div>
                <div id="minVotersResult" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                    <!-- 转爪 转爪  -->
                </div>
            </div>

            <!-- 专住 2: 住专 ( 拽专 ?) -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-green-700 mb-6 border-b pb-3">
                    <span class="inline-block mr-2"></span>
                    住专:  拽专 ...
                </h2>
                <div class="space-y-4">
                    <div>
                        <label for="ourVotersSim" class="block text-sm font-medium text-gray-700 mb-1"> 爪注 砖 **?</label>
                        <input type="number" id="ourVotersSim" value="127" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                    </div>
                     <div>
                        <label for="ourCandidatesSim" class="block text-sm font-medium text-gray-700 mb-1"> 注 *砖*  专爪?</label>
                        <input type="number" id="ourCandidatesSim" value="15" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label for="oppVotersSim" class="block text-sm font-medium text-gray-700 mb-1"> 爪注 砖 *专*?</label>
                        <input type="number" id="oppVotersSim" value="100" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label for="oppCandidatesSim" class="block text-sm font-medium text-gray-700 mb-1"> 注 *专* 专抓?</label>
                        <input type="number" id="oppCandidatesSim" value="12" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500">
                    </div>
                    <button id="runSimulation" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-150 ease-in-out shadow-md">
                        专抓 住爪
                    </button>
                </div>
                <div id="simulationResult" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                    <!-- 转爪 转爪  -->
                </div>
            </div>
        </div>

        <!-- 专 转爪转 驻专: 爪转 驻爪 专砖转 -->
        <div id="listRecommendation" class="mt-8 bg-white p-6 rounded-lg shadow-lg hidden">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">
                <span class="inline-block mr-2"></span>
                爪 住专转: 驻爪 专砖转 砖 (住)
            </h3>
            <p class="text-gray-600 mb-4"> 砖 驻专 拽转 驻 住 转  注 砖, 注 拽 转 爪注 砖 拽爪转 ("专砖转 砖"  "住").  拽爪 拽转 专砖转 爪注 砖.</p>
            <div id="listRecommendationContent" class="space-y-4">
                <!-- 转 爪 住  -->
            </div>
        </div>
        
        <!-- 专 转爪转 驻专:  注 -->
        <div id="fullResults" class="mt-8 bg-white p-6 rounded-lg shadow-lg hidden">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">
                <span class="inline-block mr-2"></span>
                驻专 转爪转 
            </h3>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">专</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">注</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">住 拽转</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">住住</th>
                        </tr>
                    </thead>
                    <tbody id="fullResultsBody" class="bg-white divide-y divide-gray-200">
                        <!-- 砖专转 转爪转 住  -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // --- 拽注 ---
        const TOTAL_SEATS = 19;
        const VOTES_PER_VOTER = 12;

        // --- 专 DOM ---
        const calculateMinVotersBtn = document.getElementById('calculateMinVoters');
        const runSimulationBtn = document.getElementById('runSimulation');
        
        const minVotersResultEl = document.getElementById('minVotersResult');
        const simulationResultEl = document.getElementById('simulationResult');
        const listRecommendationEl = document.getElementById('listRecommendation');
        const listRecommendationContentEl = document.getElementById('listRecommendationContent');
        const fullResultsEl = document.getElementById('fullResults');
        const fullResultsBodyEl = document.getElementById('fullResultsBody');

        // --- 专注 ---
        calculateMinVotersBtn.addEventListener('click', handleCalculateMinVoters);
        runSimulationBtn.addEventListener('click', handleRunSimulation);

        // --- 驻拽爪转  ---

        /**
         * 驻拽爪转 : 砖转 转 驻爪 拽转 驻
         * @param {number} K - 住驻专 注 *砖* (, 15)
         * @param {number} V - 住驻专 住  爪注 (拽注: 12)
         * @param {number} N - 住驻专 爪注 *砖* (, 127)
         * @returns {object} - 拽 注 { lists: [], candidateVotes: [] }
         */
        function calculateOptimalSplit(K, V, N) {
            if (K <= 0 || V <= 0 || N <= 0 || K <= V) {
                // 拽专 驻砖:  爪专 驻爪
                const candidateVotes = Array(K).fill(0).map((_, i) => ({
                    id: `砖-${i + 1}`,
                    votes: N
                }));
                const lists = [{
                    voters: N,
                    omits: [],
                    includes: Array.from({ length: K }, (_, i) => i + 1)
                }];
                return { lists, candidateVotes };
            }

            const omitCount = K - V; //  注 ** 住  专砖 (砖, 15-12 = 3)
            const numLists = Math.ceil(K / omitCount); // 住驻专 专砖转 (住) 专砖 (砖, 15/3 = 5)

            const lists = [];
            const candidateVotes = Array(K).fill(0).map((_, i) => ({
                id: `砖-${i + 1}`,
                votes: 0
            }));

            // 1. 拽 转 爪注 砖  专砖转 爪专 砖  转
            const baseVotersPerList = Math.floor(N / numLists);
            let remainderVoters = N % numLists;
            
            const voterDistribution = [];
            for (let i = 0; i < numLists; i++) {
                let votersForThisList = baseVotersPerList + (i < remainderVoters ? 1 : 0);
                voterDistribution.push(votersForThisList);
            }

            // 2. 爪专 转 专砖转 (住)
            let candidateOmitIndex = 0;
            for (let i = 0; i < numLists; i++) {
                const voters = voterDistribution[i];
                const omits = []; // 注 砖 (拽住 0-14)
                const includes = []; // 注  (住驻专 1-15)

                for (let j = 0; j < omitCount; j++) {
                    if (candidateOmitIndex < K) {
                        omits.push(candidateOmitIndex);
                        candidateOmitIndex++;
                    }
                }
                
                // 3. 砖 拽转:  注 拽 拽转  专砖 *砖* 砖 转
                for (let c = 0; c < K; c++) {
                    if (!omits.includes(c)) {
                        candidateVotes[c].votes += voters;
                        includes.push(c + 1); // 住祝 转 住驻专 住专 (1-15)
                    }
                }
                
                lists.push({
                    voters: voters,
                    omits: omits.map(idx => idx + 1), // 专 拽住 1 (1-15)
                    includes: includes
                });
            }

            return { lists, candidateVotes };
        }

        /**
         * 专抓 转 住爪 
         * @param {number} ourVoters - 住驻专 爪注 砖
         * @param {number} ourCandidates - 住驻专 注 砖
         * @param {number} oppVoters - 住驻专 爪注 专
         * @param {number} oppCandidates - 住驻专 注 专
         * @returns {object} - 拽 注 转爪转 住爪
         */
        function runFullSimulation(ourVoters, ourCandidates, oppVoters, oppCandidates) {
            // 1. 砖 拽转 专
            // : 专  驻爪 驻转  爪专 (K > V),  专   (K <= V)
            const oppSplit = calculateOptimalSplit(oppCandidates, VOTES_PER_VOTER, oppVoters);
            const oppResults = oppSplit.candidateVotes.map(c => ({
                ...c,
                id: `专-${c.id.split('-')[1]}`
            }));

            // 2. 砖 拽转 砖 (注 驻爪 驻)
            const ourSplit = calculateOptimalSplit(ourCandidates, VOTES_PER_VOTER, ourVoters);
            const ourResults = ourSplit.candidateVotes;

            // 3.  专
            const allCandidates = [...ourResults, ...oppResults];
            allCandidates.sort((a, b) => b.votes - a.votes);

            // 4. 拽转 拽转
            const winners = [];
            const losers = [];
            
            allCandidates.forEach((candidate, index) => {
                const rank = index + 1;
                const status = rank <= TOTAL_SEATS ? '专' : ' 专';
                const result = { ...candidate, rank, status };
                
                if (status === '专') {
                    winners.push(result);
                } else {
                    losers.push(result);
                }
            });

            const ourWins = winners.filter(c => c.id.startsWith('砖')).length;
            const oppWins = winners.filter(c => c.id.startsWith('专')).length;
            
            const threshold = winners.length > 0 ? winners[winners.length - 1].votes : 0;
            const minOurVotes = ourResults.length > 0 ? Math.min(...ourResults.map(c => c.votes)) : 0;
            const maxOurVotes = ourResults.length > 0 ? Math.max(...ourResults.map(c => c.votes)) : 0;
            const minOppVotes = oppResults.length > 0 ? Math.min(...oppResults.map(c => c.votes)) : 0;
            const maxOppVotes = oppResults.length > 0 ? Math.max(...oppResults.map(c => c.votes)) : 0;

            return {
                ourWins,
                oppWins,
                threshold,
                minOurVotes,
                maxOurVotes,
                minOppVotes,
                maxOppVotes,
                listRecommendation: ourSplit.lists,
                fullResults: [...winners, ...losers]
            };
        }


        // --- 驻 专注 (Handlers) ---

        /**
         * 驻 爪 注 "砖   爪注  爪专" (驻爪)
         */
        function handleCalculateMinVoters() {
            // 1. 住祝 拽
            const ourCandidatesToWin = parseInt(document.getElementById('ourCandidatesToWin').value);
            const oppVoters = parseInt(document.getElementById('oppVotersOpt').value);
            const oppCandidates = parseInt(document.getElementById('oppCandidatesOpt').value);

            if (isNaN(ourCandidatesToWin) || isNaN(oppVoters) || isNaN(oppCandidates)) {
                alert("  转  砖转 注专 住驻专.");
                return;
            }
            
            if (ourCandidatesToWin > TOTAL_SEATS) {
                alert(` 转 住 ${ourCandidatesToWin} 注, 砖 专拽 ${TOTAL_SEATS} 拽转.`);
                return;
            }

            // 2. 砖 拽转 专
            //  专祝 砖专 爪?  拽  砖注 砖 拽 驻爪 驻.
            const oppSplit = calculateOptimalSplit(oppCandidates, VOTES_PER_VOTER, oppVoters);
            const oppMinVotes = oppSplit.candidateVotes.length > 0 ? Math.min(...oppSplit.candidateVotes.map(c => c.votes)) : 0;
            
            // 专 砖: 砖 拽  转专 拽  砖 专
            // ( 拽  转专 注 -19 专砖, 砖 专 0   专 专)
            // 转拽 专 砖.
            const targetVotes = oppMinVotes + 1;

            // 3. 砖 转专 砖  爪注 ** 爪专
            let totalVotesNeeded = targetVotes * ourCandidatesToWin;
            let minVoters = Math.ceil(totalVotesNeeded / VOTES_PER_VOTER);

            // 4. 爪:  注 minVoters, 驻爪 *砖* 转 转  targetVotes?
            let simulationResult;
            let actualMinOurVotes;
            
            // 专抓    砖驻爪 注. 驻注 爪专 注 拽   砖  注.
            while (true) {
                simulationResult = runFullSimulation(minVoters, ourCandidatesToWin, oppVoters, oppCandidates);
                actualMinOurVotes = simulationResult.minOurVotes;
                
                if (actualMinOurVotes > oppMinVotes) {
                    // 爪! 注  砖 砖 注专 转 注  砖 砖 专
                    // ( 砖-ourCandidatesToWin + oppCandidates > TOTAL_SEATS,  专 砖注专 拽 )
                    // 拽 住驻转:  转 住 转 ?
                    if (simulationResult.ourWins === ourCandidatesToWin) {
                         break; // 爪 
                    }
                }
                
                minVoters++; //  , 住 注 注 爪注
                
                if (minVoters > (oppVoters * 10)) {
                    //     住驻转
                    minVotersResultEl.innerHTML = `<p class="text-red-600 font-bold">砖 砖. 转 砖转  驻砖专 爪.</p>`;
                    minVotersResultEl.classList.remove('hidden');
                    return;
                }
            }

            // 5. 爪转 转爪转
            minVotersResultEl.innerHTML = `
                <p class="text-lg mb-2">
                      住 砖 <strong>${ourCandidatesToWin} 注</strong> ( 专 注 ${oppVoters} 拽转):
                </p>
                <p class="text-4xl font-bold text-blue-700 text-center my-4">${minVoters}</p>
                <p class="text-lg text-center mb-4">爪注 (驻转)</p>
                <hr class="my-3">
                <h4 class="font-bold">转 (爪 ):</h4>
                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1 mt-2">
                    <li> 注 砖 专 拽 -<strong>${oppMinVotes}</strong> 拽转.</li>
                    <li>注 砖  <strong>${targetVotes}</strong> 拽转  注 砖.</li>
                    <li>注 <strong>${minVoters}</strong> 爪注 驻爪 ,  注 砖 拽  <strong>${simulationResult.minOurVotes}</strong> -<strong>${simulationResult.maxOurVotes}</strong> 拽转.</li>
                    <li><strong>转爪 住驻转: <span class="text-blue-700 font-bold">${simulationResult.ourWins} 拽转 </span>  <span class="text-red-700 font-bold">${simulationResult.oppWins} 拽转 专</span>.</strong></li>
                    <li>住祝 住 (拽 砖 拽 -${TOTAL_SEATS})  <strong>${simulationResult.threshold}</strong> 拽转.</li>
                </ul>
            `;
            minVotersResultEl.classList.remove('hidden');
            
            // 爪 爪转 驻爪
            displayListRecommendation(simulationResult.listRecommendation, minVoters, ourCandidatesToWin);
            // 住转专 转爪转 转 (驻转 专 驻爪)
            fullResultsEl.classList.add('hidden');
        }
        
        /**
         * 驻 爪 注 "专抓 住爪"
         */
        function handleRunSimulation() {
            // 1. 住祝 拽
            const ourVoters = parseInt(document.getElementById('ourVotersSim').value);
            const ourCandidates = parseInt(document.getElementById('ourCandidatesSim').value);
            const oppVoters = parseInt(document.getElementById('oppVotersSim').value);
            const oppCandidates = parseInt(document.getElementById('oppCandidatesSim').value);
            
            if (isNaN(ourVoters) || isNaN(ourCandidates) || isNaN(oppVoters) || isNaN(oppCandidates)) {
                alert("  转  砖转 注专 住驻专.");
                return;
            }

            // 2. 专爪转 住爪
            const result = runFullSimulation(ourVoters, ourCandidates, oppVoters, oppCandidates);

            // 3. 爪转 转爪转
            simulationResultEl.innerHTML = `
                <p class="text-lg mb-2">
                    转 <strong>${ourVoters}</strong> 爪注 砖 -<strong>${oppVoters}</strong> 专:
                </p>
                <div class="text-center my-4">
                    <span class="text-4xl font-bold text-green-700">${result.ourWins}</span>
                    <span class="text-3xl text-gray-600 mx-2">/</span>
                    <span class="text-4xl font-bold text-red-700">${result.oppWins}</span>
                    <br>
                    <span class="text-sm text-green-700 font-medium">拽转 </span>
                    <span class="text-sm text-gray-500 mx-4">转 ${TOTAL_SEATS}</span>
                    <span class="text-sm text-red-700 font-medium">拽转 专</span>
                </div>
                <hr class="my-3">
                <h4 class="font-bold">转 (爪 ):</h4>
                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1 mt-2">
                    <li>注 砖 拽  <strong>${result.minOurVotes}</strong> -<strong>${result.maxOurVotes}</strong> 拽转 (注 驻爪 驻).</li>
                    <li>注 砖 专 拽  <strong>${result.minOppVotes}</strong> -<strong>${result.maxOppVotes}</strong> 拽转.</li>
                    <li>住祝 住 (拽 砖 拽 -${TOTAL_SEATS})  <strong>${result.threshold}</strong> 拽转.</li>
                </ul>
            `;
            simulationResultEl.classList.remove('hidden');

            // 4. 爪转 爪转 驻爪 转爪转 转
            displayListRecommendation(result.listRecommendation, ourVoters, ourCandidates);
            displayFullResults(result.fullResults);
        }
        
        
        // --- 驻拽爪转 转爪 ---

        /**
         * 爪 转 爪 驻爪 专砖转
         * @param {array} lists - 注专 专砖转 -calculateOptimalSplit
         * @param {number} totalVoters - 住 爪注 砖
         * @param {number} totalCandidates - 住 注 砖
         */
        function displayListRecommendation(lists, totalVoters, totalCandidates) {
            if (!lists || lists.length === 0 || lists.length === 1 && lists[0].omits.length === 0) {
                listRecommendationContentEl.innerHTML = '<p> 爪专 驻爪 专砖转 .  爪注  爪注 转 专砖 砖  注.</p>';
                listRecommendationEl.classList.remove('hidden');
                return;
            }

            let html = `<p class="text-sm text-gray-600 mb-4">砖 拽 转 <strong>${totalVoters}</strong> 爪注 砖 -<strong>${lists.length}</strong> 拽爪转:</p>`;
            
            html += '<div class="space-y-3">';
            
            lists.forEach((list, index) => {
                html += `<div class="p-3 bg-gray-50 border border-gray-200 rounded-md">`;
                html += `<h4 class="font-bold text-gray-800">拽爪 ${index + 1}: (${list.voters} 爪注)</h4>`;
                
                if (list.omits.length > 0) {
                    html += `<p class="text-sm text-red-700"><strong>砖</strong> 转 注: <span class="font-mono">${list.omits.join(', ')}</span></p>`;
                    html += `<p class="text-sm text-green-700">爪注  ${list.includes.length} 转专: <span class="font-mono text-xs">${list.includes.join(', ')}</span></p>`;
                } else {
                     html += `<p class="text-sm text-green-700">爪注  ${list.includes.length} 注: <span class="font-mono text-xs">${list.includes.join(', ')}</span></p>`;
                }
                
                html += `</div>`;
            });
            
            html += '</div>';
            
            listRecommendationContentEl.innerHTML = html;
            listRecommendationEl.classList.remove('hidden');
        }

        /**
         * 爪 转 转 转爪转 
         * @param {array} fullResults - 注专  注 -runFullSimulation
         */
        function displayFullResults(fullResults) {
            let html = '';
            
            fullResults.forEach(candidate => {
                let statusClass = candidate.status === '专' ? 'text-green-600 font-bold' : 'text-red-600';
                let rowClass = candidate.status === '专' ? 'bg-green-50' : 'bg-red-50';
                if (candidate.rank > TOTAL_SEATS) {
                    rowClass = ''; //  爪注   砖抓 -19
                }
                
                let candidateClass = candidate.id.startsWith('砖') ? 'text-blue-800' : 'text-gray-700';
                
                html += `
                    <tr class="${rowClass}">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${candidate.rank}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm ${candidateClass} font-medium">${candidate.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 font-mono">${candidate.votes}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm ${statusClass}">${candidate.status}</td>
                    </tr>
                `;
            });
            
            fullResultsBodyEl.innerHTML = html;
            fullResultsEl.classList.remove('hidden');
        }

    </script>
</body>
</html>
